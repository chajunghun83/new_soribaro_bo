<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로세스 테스트 - 번역 작업관리</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            padding: 10px;
            min-height: 100vh;
            margin: 0;
            width: 100%;
            box-sizing: border-box;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .back-button {
            background: #6b7280;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: #4b5563;
        }
        
        /* 정보 섹션 */
        .info-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .basic-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .info-label {
            font-weight: 500;
            color: #6b7280;
            font-size: 14px;
        }

        .info-value {
            color: #374151;
            font-size: 16px;
            font-weight: 500;
            padding: 12px 15px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        
        /* 파일 리스트 테이블 */
        .file-list-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .section-title {
            margin: 0 0 20px 0;
            color: #374151;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed;
        }
        
        .file-table th,
        .file-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-size: 14px;
            vertical-align: middle;
        }
        
        /* 파일 리스트 테이블 컬럼 너비 설정 - 메인 파일 리스트용 - 최고 우선순위 - v2.0 */
        body table.file-table.main-file-table {
            table-layout: fixed !important;
            width: 100% !important;
        }
        
        body table.file-table.main-file-table th,
        body table.file-table.main-file-table td {
            box-sizing: border-box !important;
        }
        
        body table.file-table.main-file-table th:nth-child(1),
        body table.file-table.main-file-table td:nth-child(1) {
            width: 4% !important;
            max-width: 4% !important;
            min-width: 4% !important;
            text-align: center !important;
        }
        
        body table.file-table.main-file-table th:nth-child(2),
        body table.file-table.main-file-table td:nth-child(2) {
            width: 35% !important;
            max-width: 35% !important;
            min-width: 35% !important;
        }
        
        body table.file-table.main-file-table th:nth-child(3),
        body table.file-table.main-file-table td:nth-child(3) {
            width: 8% !important;
            max-width: 8% !important;
            min-width: 8% !important;
        }
        
        body table.file-table.main-file-table th:nth-child(4),
        body table.file-table.main-file-table td:nth-child(4) {
            width: 18% !important;
            max-width: 18% !important;
            min-width: 18% !important;
        }
        
        body table.file-table.main-file-table th:nth-child(5),
        body table.file-table.main-file-table td:nth-child(5) {
            width: 12% !important;
            max-width: 12% !important;
            min-width: 12% !important;
        }
        
        body table.file-table.main-file-table th:nth-child(6),
        body table.file-table.main-file-table td:nth-child(6) {
            width: 10% !important;
            max-width: 10% !important;
            min-width: 10% !important;
        }
        
        body table.file-table.main-file-table th:nth-child(7),
        body table.file-table.main-file-table td:nth-child(7) {
            width: 13% !important;
            max-width: 13% !important;
            min-width: 13% !important;
        }
        
        .file-table td:first-child input[type="checkbox"] {
            margin: 0 auto;
            display: block;
        }
        
        .file-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #374151;
        }
        
        .file-table tbody tr:hover {
            background: #f9fafb;
        }
        
        /* 선택된 파일 행 스타일 */
        .file-table tbody tr.selected-file-row {
            background: #dbeafe !important;
            border-left: 4px solid #3b82f6 !important;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1) !important;
        }
        
        .file-table tbody tr.selected-file-row:hover {
            background: #bfdbfe !important;
        }
        
        .file-table tbody tr.selected-file-row td {
            border-color: #93c5fd !important;
        }
        
        /* 분할된 파일이 선택되었을 때 스타일 */
        .file-table tbody tr.tree-child.selected-file-row {
            background: #dbeafe !important;
            border-left: 4px solid #3b82f6 !important;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1) !important;
        }
        
        .file-table tbody tr.tree-child.selected-file-row:hover {
            background: #bfdbfe !important;
        }
        
        /* 원본 파일이 선택되었을 때 스타일 강화 */
        .file-table tbody tr.tree-parent.selected-file-row {
            background: #dbeafe !important;
            border-left: 4px solid #3b82f6 !important;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1) !important;
            font-weight: 600 !important;
        }
        
        .file-name {
            text-align: left;
            color: #3b82f6;
            font-weight: 500;
            min-width: 250px;
            padding-left: 16px !important;
            word-wrap: break-word;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* 버튼 스타일 */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        /* 모달 스타일 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .modal-container {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-content {
            padding: 24px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-top: 1px solid #e5e7eb;
        }
        
        /* 화살표 버튼 */
        .arrow-button {
            background: #6b7280;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .arrow-button:hover {
            background: #4b5563;
        }
        
        /* 파일 이동 애니메이션 */
        .file-moving {
            animation: moveDown 0.5s ease-in-out;
        }
        
        @keyframes moveDown {
            0% { transform: translateY(0); opacity: 1; }
            50% { transform: translateY(10px); opacity: 0.5; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        /* 불필요한 트리 스타일 제거됨 */
        
        /* 이전 CSS 규칙들은 아래 더 구체적인 규칙으로 대체됨 */
        
        /* 원본 파일(부모) 스타일 */
        tr.tree-parent td:nth-child(1) {
            font-weight: 600 !important;
            color: #374151 !important;
            background: #fff !important;
        }
        
        tr.tree-parent td {
            background: #fff !important;
        }
        
        /* 불필요한 스타일 제거됨 */
        
        /* 분할된 파일의 모든 컬럼 스타일 */
        tr.tree-child td {
            background: #f8f9fa !important;
            color: #6b7280 !important;
            font-size: 13px !important;
            text-align: center !important;
            vertical-align: middle !important;
            padding: 12px !important;
        }
        
        /* 분할된 파일의 체크박스 컬럼은 중앙정렬 유지 */
        tr.tree-child td:nth-child(1) {
            text-align: center !important;
        }
        
        /* 분할된 파일의 파일명 컬럼 - 중앙정렬 + 볼드 화살표 */
        /* 분할된 파일의 파일명 컬럼에 화살표 표시 (영역별 구분) */
        
        /* 메인 파일 리스트: 2번째 컬럼이 파일명 */
        .file-table tbody tr.tree-child td:nth-child(2) {
            text-align: center !important;
            background: #f8f9fa !important;
            padding: 12px !important;
        }
        
        .file-table tbody tr.tree-child td:nth-child(2)::before {
            content: "→ " !important;
            color: #6b7280 !important;
            font-weight: bold !important;
            margin-right: 4px !important;
        }
        
        /* 파일 세팅 모달 (target-file-list): 3번째 컬럼이 파일명 */
        #target-file-list tr.tree-child td:nth-child(3) {
            text-align: center !important;
            background: #f8f9fa !important;
            padding: 12px !important;
        }
        
        #target-file-list tr.tree-child td:nth-child(3)::before {
            content: "→ " !important;
            color: #6b7280 !important;
            font-weight: bold !important;
            margin-right: 4px !important;
        }
        
        /* 출발어 영역 (detail-tbody): 1번째 컬럼이 파일명 */
        #detail-tbody tr.tree-child td:nth-child(1) {
            text-align: center !important;
            background: #f8f9fa !important;
            padding: 12px !important;
        }
        
        #detail-tbody tr.tree-child td:nth-child(1)::before {
            content: "→ " !important;
            color: #6b7280 !important;
            font-weight: bold !important;
            margin-right: 4px !important;
        }
        
        /* 출발어 컬럼(2번째)에는 화살표 표시 안함 */
        #detail-tbody tr.tree-child td:nth-child(2) {
            background: #f8f9fa !important;
            text-align: center !important;
            padding: 12px !important;
        }
        
        #detail-tbody tr.tree-child td:nth-child(2)::before {
            content: none !important;
        }
        
        /* 웍스파이 상세 영역의 출발어 컬럼에도 화살표 표시 안함 */
        #worksby-detail-area #detail-tbody tr.tree-child td:nth-child(2) {
            background: #f8f9fa !important;
            text-align: center !important;
            padding: 12px !important;
        }
        
        #worksby-detail-area #detail-tbody tr.tree-child td:nth-child(2)::before {
            content: none !important;
        }
        
        /* 중간어 영역 (intermediate-tbody): 1번째 컬럼이 파일명 */
        #intermediate-tbody tr.tree-child td:nth-child(1) {
            text-align: center !important;
            background: #f8f9fa !important;
            padding: 12px !important;
        }
        
        #intermediate-tbody tr.tree-child td:nth-child(2)::before {
            content: "→ " !important;
            color: #6b7280 !important;
            font-weight: bold !important;
            margin-right: 4px !important;
        }
        
        /* 중간어 영역 출발어 컬럼(3번째)에는 화살표 표시 안함 */
        #intermediate-tbody tr.tree-child td:nth-child(3) {
            background: #f8f9fa !important;
            text-align: center !important;
            padding: 12px !important;
        }
        
        #intermediate-tbody tr.tree-child td:nth-child(3)::before {
            content: none !important;
        }
        
        /* 도착어 영역 (destination-tbody-*): 2번째 컬럼이 파일명 */
        [id^="destination-tbody-"] tr.tree-child td:nth-child(2) {
            text-align: center !important;
            background: #f8f9fa !important;
            padding: 12px !important;
        }
        
        [id^="destination-tbody-"] tr.tree-child td:nth-child(2)::before {
            content: "→ " !important;
            color: #6b7280 !important;
            font-weight: bold !important;
            margin-right: 4px !important;
        }
        
        /* 원본 파일(부모) 스타일 - 간단하게 */
        tr.tree-parent td {
            background: #fff !important;
        }
        
        tr.tree-parent td:nth-child(1) {
            font-weight: 600 !important;
            color: #374151 !important;
        }
        
        /* 상태 배지 스타일 */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-align: center;
        }
        
        .status-ready {
            background: #e5e7eb;
            color: #374151;
        }
        
        .status-moved {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        /* 프로젝트 그룹 스타일 */
        .project-group {
            margin-bottom: 25px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }
        
        .project-group-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .project-group-title {
            font-size: 16px;
            font-weight: 600;
            color: #3b82f6;
            margin: 0;
        }
        
        .project-group-count {
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .project-group .file-table {
            margin-bottom: 0;
        }
        
        /* 템플릿 행 스타일 */
        .template-row {
            transition: all 0.2s ease;
        }
        
        .template-row:hover {
            background-color: #f3f4f6 !important;
        }
        
        .template-row.selected {
            background-color: #dbeafe !important;
            color: #1e40af !important;
        }
        
        /* 작업 영역 구분 스타일 */
        .work-area-container {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin: 20px 0;
            padding: 20px;
            background: #fafafa;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .work-area-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            margin: -20px -20px 20px -20px;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .work-area-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .work-area-content {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* 웍스파이 프로젝트 테이블 컬럼 너비 */
        .worksby-projects-table th:nth-child(1),
        .worksby-projects-table td:nth-child(1) {
            width: 45% !important;
        }
        
        .worksby-projects-table th:nth-child(2),
        .worksby-projects-table td:nth-child(2) {
            width: 10% !important;
        }
        
        .worksby-projects-table th:nth-child(3),
        .worksby-projects-table td:nth-child(3) {
            width: 20% !important;
        }
        
        .worksby-projects-table th:nth-child(4),
        .worksby-projects-table td:nth-child(4) {
            width: 10% !important;
        }
        
        .worksby-projects-table th:nth-child(5),
        .worksby-projects-table td:nth-child(5) {
            width: 10% !important;
        }
        
        .worksby-projects-table th:nth-child(6),
        .worksby-projects-table td:nth-child(6) {
            width: 5% !important;
            text-align: center !important;
            vertical-align: middle !important;
        }
        
        /* 출발어 영역 테이블 컬럼 너비 (웍스파이 등록 확인 컬럼 포함) */
        #worksby-detail-area .file-table th:nth-child(1),
        #worksby-detail-area .file-table td:nth-child(1) {
            width: 30% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(2),
        #worksby-detail-area .file-table td:nth-child(2) {
            width: 8% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(3),
        #worksby-detail-area .file-table td:nth-child(3) {
            width: 10% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(4),
        #worksby-detail-area .file-table td:nth-child(4) {
            width: 12% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(5),
        #worksby-detail-area .file-table td:nth-child(5) {
            width: 10% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(6),
        #worksby-detail-area .file-table td:nth-child(6) {
            width: 10% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(7),
        #worksby-detail-area .file-table td:nth-child(7) {
            width: 12% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(8),
        #worksby-detail-area .file-table td:nth-child(8) {
            width: 8% !important;
        }
        
        #worksby-detail-area .file-table th:nth-child(9),
        #worksby-detail-area .file-table td:nth-child(9) {
            width: 8% !important;
        }
        
        /* 중간어 영역 테이블 컬럼 너비 */
        #intermediate-language-area .file-table th:nth-child(1),
        #intermediate-language-area .file-table td:nth-child(1) {
            width: 22% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(2),
        #intermediate-language-area .file-table td:nth-child(2) {
            width: 8% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(3),
        #intermediate-language-area .file-table td:nth-child(3) {
            width: 8% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(4),
        #intermediate-language-area .file-table td:nth-child(4) {
            width: 8% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(5),
        #intermediate-language-area .file-table td:nth-child(5) {
            width: 8% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(6),
        #intermediate-language-area .file-table td:nth-child(6) {
            width: 8% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(7),
        #intermediate-language-area .file-table td:nth-child(7) {
            width: 10% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(8),
        #intermediate-language-area .file-table td:nth-child(8) {
            width: 12% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(9),
        #intermediate-language-area .file-table td:nth-child(9) {
            width: 11% !important;
        }
        
        #intermediate-language-area .file-table th:nth-child(10),
        #intermediate-language-area .file-table td:nth-child(10) {
            width: 7% !important;
        }
        
        /* 출발어 영역 테이블 컬럼 강제 설정 */
        [id^="worksby-detail-area-"] .file-table th:nth-child(1),
        [id^="worksby-detail-area-"] .file-table td:nth-child(1) { width: 16% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(2),
        [id^="worksby-detail-area-"] .file-table td:nth-child(2) { width: 26% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(3),
        [id^="worksby-detail-area-"] .file-table td:nth-child(3) { width: 5% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(4),
        [id^="worksby-detail-area-"] .file-table td:nth-child(4) { width: 7% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(5),
        [id^="worksby-detail-area-"] .file-table td:nth-child(5) { width: 7% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(6),
        [id^="worksby-detail-area-"] .file-table td:nth-child(6) { width: 10% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(7),
        [id^="worksby-detail-area-"] .file-table td:nth-child(7) { width: 7% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(8),
        [id^="worksby-detail-area-"] .file-table td:nth-child(8) { width: 10% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(9),
        [id^="worksby-detail-area-"] .file-table td:nth-child(9) { width: 7% !important; }
        [id^="worksby-detail-area-"] .file-table th:nth-child(10),
        [id^="worksby-detail-area-"] .file-table td:nth-child(10) { width: 5% !important; }
        
        /* 중간어 영역 테이블 컬럼 강제 설정 */
        [id^="intermediate-language-area-"] .file-table th:nth-child(1),
        [id^="intermediate-language-area-"] .file-table td:nth-child(1) { width: 16% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(2),
        [id^="intermediate-language-area-"] .file-table td:nth-child(2) { width: 21% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(3),
        [id^="intermediate-language-area-"] .file-table td:nth-child(3) { width: 5% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(4),
        [id^="intermediate-language-area-"] .file-table td:nth-child(4) { width: 5% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(5),
        [id^="intermediate-language-area-"] .file-table td:nth-child(5) { width: 7% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(6),
        [id^="intermediate-language-area-"] .file-table td:nth-child(6) { width: 7% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(7),
        [id^="intermediate-language-area-"] .file-table td:nth-child(7) { width: 10% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(8),
        [id^="intermediate-language-area-"] .file-table td:nth-child(8) { width: 7% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(9),
        [id^="intermediate-language-area-"] .file-table td:nth-child(9) { width: 10% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(10),
        [id^="intermediate-language-area-"] .file-table td:nth-child(10) { width: 7% !important; }
        [id^="intermediate-language-area-"] .file-table th:nth-child(11),
        [id^="intermediate-language-area-"] .file-table td:nth-child(11) { width: 5% !important; }
        
        /* 도착어 영역 테이블 컬럼 강제 설정 */
        [id^="destination-container-"] .file-table th:nth-child(1),
        [id^="destination-container-"] .file-table td:nth-child(1) { width: 13% !important; }
        [id^="destination-container-"] .file-table th:nth-child(2),
        [id^="destination-container-"] .file-table td:nth-child(2) { width: 19% !important; }
        [id^="destination-container-"] .file-table th:nth-child(3),
        [id^="destination-container-"] .file-table td:nth-child(3) { width: 5% !important; }
        [id^="destination-container-"] .file-table th:nth-child(4),
        [id^="destination-container-"] .file-table td:nth-child(4) { width: 10% !important; }
        [id^="destination-container-"] .file-table th:nth-child(5),
        [id^="destination-container-"] .file-table td:nth-child(5) { width: 7% !important; }
        [id^="destination-container-"] .file-table th:nth-child(6),
        [id^="destination-container-"] .file-table td:nth-child(6) { width: 7% !important; }
        [id^="destination-container-"] .file-table th:nth-child(7),
        [id^="destination-container-"] .file-table td:nth-child(7) { width: 10% !important; }
        [id^="destination-container-"] .file-table th:nth-child(8),
        [id^="destination-container-"] .file-table td:nth-child(8) { width: 7% !important; }
        [id^="destination-container-"] .file-table th:nth-child(9),
        [id^="destination-container-"] .file-table td:nth-child(9) { width: 10% !important; }
        [id^="destination-container-"] .file-table th:nth-child(10),
        [id^="destination-container-"] .file-table td:nth-child(10) { width: 7% !important; }
        [id^="destination-container-"] .file-table th:nth-child(11),
        [id^="destination-container-"] .file-table td:nth-child(11) { width: 5% !important; }
        
        /* 파일 업로드 모달 스타일 */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .form-group.full-width {
            flex: 1 1 100%;
        }

        .form-group label {
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.2s;
            background: #f9fafb;
            height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .file-upload-area:hover {
            border-color: #9ca3af;
        }

        .file-upload-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
            transition: background-color 0.2s;
        }

        .file-upload-btn:hover {
            background: #2563eb;
        }

        .file-preview {
            position: relative;
            display: inline-block;
        }

        .file-remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- 페이지 헤더 -->
    <div class="page-header">
        <h1 class="page-title">
            <span>🌐</span>
            번역 작업 상세정보
        </h1>
        <button class="back-button" onclick="goBack()">
            <span>←</span>
            목록으로 돌아가기
        </button>
    </div>
    
    <!-- 기본 정보 섹션 -->
    <div class="info-section">
        <h2 class="section-title">
            <span>📋</span>
            기본 정보
        </h2>
        <div class="basic-info-grid">
            <div class="info-item">
                <span class="info-label">프로젝트 제목</span>
                <div class="info-value" id="project-title">2025년 국제회의 번역 문서</div>
            </div>
            <div class="info-item">
                <span class="info-label">업체명</span>
                <div class="info-value" id="company-name">외교부</div>
            </div>
            <div class="info-item">
                <span class="info-label">의뢰자명</span>
                <div class="info-value" id="client-name">김민수</div>
            </div>
        </div>
    </div>
    
    <!-- 파일 리스트 섹션 -->
    <div class="file-list-section">
        <h2 class="section-title">
            <span>📁</span>
            파일 리스트
        </h2>
        
        <table class="file-table main-file-table" style="table-layout: fixed !important; width: 100% !important;">
            <thead>
                <tr>
                    <th style="width: 4% !important; text-align: center;"><input type="checkbox" id="selectAllFiles" onclick="handleSelectAllClick(event, this);"></th>
                    <th style="width: 35% !important;">파일 이름</th>
                    <th style="width: 8% !important;">원본 언어</th>
                    <th style="width: 18% !important;">도착 언어</th>
                    <th style="width: 12% !important;">파일 길이</th>
                    <th style="width: 10% !important;">프롬프트</th>
                    <th style="width: 13% !important;">웍스파이 등록</th>
                </tr>
            </thead>
            <tbody>
                <tr onclick="selectFileRow(this)" style="cursor: pointer;" data-file-id="1">
                    <td style="text-align: center;"><input type="checkbox" class="file-select-checkbox" value="1" onclick="handleCheckboxClick(event, this);"></td>
                    <td class="file-name">국제회의_번역영상_2025_01.mp4</td>
                    <td>한글</td>
                    <td>영어, 일본어, 중국어(간체)</td>
                    <td>00:45:30</td>
                    <td style="text-align: center;"><span class="prompt-badge" style="background: #e5e7eb; color: #374151; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">기본</span></td>
                    <td style="text-align: center;"><span class="worksby-status-badge" style="background: #fef2f2; color: #991b1b; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">미등록</span></td>
                </tr>
                <tr onclick="selectFileRow(this)" style="cursor: pointer;" data-file-id="2">
                    <td style="text-align: center;"><input type="checkbox" class="file-select-checkbox" value="2" onclick="handleCheckboxClick(event, this);"></td>
                    <td class="file-name">의료진_대화영상_2025_02.avi</td>
                    <td>한글</td>
                    <td>영어, 일본어, 중국어(간체)</td>
                    <td>01:20:15</td>
                    <td style="text-align: center;"><span class="prompt-badge" style="background: #e5e7eb; color: #374151; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">기본</span></td>
                    <td style="text-align: center;"><span class="worksby-status-badge" style="background: #fef2f2; color: #991b1b; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">미등록</span></td>
                </tr>
                <tr onclick="selectFileRow(this)" style="cursor: pointer;" data-file-id="3">
                    <td style="text-align: center;"><input type="checkbox" class="file-select-checkbox" value="3" onclick="handleCheckboxClick(event, this);"></td>
                    <td class="file-name">기술세미나_영상_2025_03.mov</td>
                    <td>한글</td>
                    <td>영어, 일본어, 중국어(간체)</td>
                    <td>00:35:45</td>
                    <td style="text-align: center;"><span class="prompt-badge" style="background: #e5e7eb; color: #374151; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">기본</span></td>
                    <td style="text-align: center;"><span class="worksby-status-badge" style="background: #fef2f2; color: #991b1b; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">미등록</span></td>
                </tr>
                <tr onclick="selectFileRow(this)" style="cursor: pointer;" data-file-id="4">
                    <td style="text-align: center;"><input type="checkbox" class="file-select-checkbox" value="4" onclick="handleCheckboxClick(event, this);"></td>
                    <td class="file-name">법률계약회의_영상_2025_04.mkv</td>
                    <td>한글</td>
                    <td>영어, 일본어, 중국어(간체)</td>
                    <td>02:10:20</td>
                    <td style="text-align: center;"><span class="prompt-badge" style="background: #e5e7eb; color: #374151; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">기본</span></td>
                    <td style="text-align: center;"><span class="worksby-status-badge" style="background: #fef2f2; color: #991b1b; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">미등록</span></td>
                </tr>
            </tbody>
        </table>
        
        <!-- 파일 리스트 컨트롤 버튼 영역 -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding: 15px 0;">
            <!-- 왼쪽 버튼 그룹 -->
            <div style="display: flex; align-items: center; gap: 15px;">
                <select id="defaultPromptSelect" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; min-width: 120px;">
                    <option value="기본" selected>기본</option>
                    <option value="옵션1">옵션1</option>
                    <option value="옵션2">옵션2</option>
                    <option value="옵션3">옵션3</option>
                    <option value="옵션4">옵션4</option>
                    <option value="옵션5">옵션5</option>
                </select>
                <button class="btn" onclick="changeSelectedPrompt()" style="background: #8b5cf6; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                    <span>🔄</span>
                    선택 프롬프트 변경
                </button>
                <button class="btn" onclick="openBatchWorkerAssignmentModal()" style="background: #5b6bc0; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                    <span>👥</span>
                    작업자 일괄 배정
                </button>
            </div>
            
            <!-- 오른쪽 버튼 그룹 -->
            <div style="display: flex; align-items: center; gap: 10px;">
                <button class="btn" onclick="addRequestFile()" style="background: #10b981; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                    <span>📁</span>
                    의뢰파일 추가
                </button>
                <button class="btn" onclick="splitSelectedFiles()" style="background: #f59e0b; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                    <span>✂️</span>
                    파일 분할
                </button>
                <button class="btn" onclick="createWorksbyProject()" style="background: #8b5cf6; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                    <span>🚀</span>
                    웍스파이 프로젝트 생성
                </button>
                <button class="btn" onclick="downloadSelectedFiles()" style="background: #6b7280; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                    <span>⬇️</span>
                    선택 파일 다운로드
                </button>
            </div>
        </div>
    </div>


    <!-- 웍스파이 등록 모달 -->
    <div id="worksbyRegistrationModal" class="modal-overlay" style="z-index: 1200;">
        <div class="modal-container" style="max-width: 800px; width: 90%;">
            <div class="modal-header">
                <h2>🚀 웍스파이 프로젝트 등록</h2>
                <button class="modal-close" onclick="closeWorksbyRegistrationModal()">&times;</button>
            </div>
            
            <div class="modal-content" style="max-height: 70vh; overflow-y: auto;">
                <!-- 서비스 -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                        서비스 <span style="color: red;">*</span>
                    </label>
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <input type="text" value="소리바로" readonly
                               style="flex: 1; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: #f9fafb;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="urgentToggle" onchange="toggleUrgent()">
                                <span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 20px; font-size: 12px;">신청버튼</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="importantToggle">
                                <span>중요</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 선택된 파일 목록 (다중 파일일 때만 표시) -->
                <div id="selectedFilesInfo" style="margin-bottom: 20px; display: none;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                        선택된 파일 목록
                    </label>
                    <div id="selectedFilesList" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px; max-height: 120px; overflow-y: auto;">
                        <!-- 선택된 파일들이 동적으로 표시됩니다 -->
                    </div>
                    <div style="margin-top: 8px; font-size: 12px; color: #6b7280;">
                        각 파일마다 별도의 웍스파이 프로젝트가 생성됩니다.
                    </div>
                </div>

                <!-- 프로젝트명 -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                        프로젝트명 <span style="color: red;">*</span>
                    </label>
                    <input type="text" id="worksbyProjectName" placeholder="프로젝트명을 입력하세요"
                           style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                    <div id="projectNameHint" style="margin-top: 6px; font-size: 12px; color: #6b7280; display: none;">
                        다중 파일의 경우 프로젝트명 뒤에 "_1", "_2" 등이 자동으로 추가됩니다.
                    </div>
                </div>

                <!-- 모집기간 -->
                <div style="margin-bottom: 20px; display: flex; gap: 20px; align-items: end;">
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                            모집기간 <span style="color: red;">*</span>
                        </label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="datetime-local" id="recruitStartDate"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                            <span>~</span>
                            <input type="datetime-local" id="recruitEndDate"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #6b7280;">작업자 수</label>
                            <input type="number" value="5" min="1"
                                   style="width: 60px; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; text-align: center;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #6b7280;">급액</label>
                            <input type="number" value="500000" min="0"
                                   style="width: 100px; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; text-align: right;">
                        </div>
                    </div>
                </div>

                <!-- 작업기간 -->
                <div style="margin-bottom: 20px; display: flex; gap: 20px; align-items: end;">
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                            작업기간 <span style="color: red;">*</span>
                        </label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="date" id="workStartDate"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                            <span>~</span>
                            <input type="date" id="workEndDate"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #6b7280;">지원자격</label>
                        <select style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; min-width: 100px;">
                            <option>누구나</option>
                            <option>초급</option>
                            <option>중급</option>
                            <option>고급</option>
                        </select>
                    </div>
                </div>

                <!-- 프로젝트 설명 -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">프로젝트 설명</label>
                    <div style="border: 1px solid #d1d5db; border-radius: 6px; min-height: 120px; padding: 12px; background: white;">
                        <div style="margin-bottom: 10px;">
                            <button type="button" style="padding: 4px 8px; margin-right: 5px; border: 1px solid #d1d5db; background: white; border-radius: 3px; cursor: pointer;"><strong>B</strong></button>
                            <button type="button" style="padding: 4px 8px; margin-right: 5px; border: 1px solid #d1d5db; background: white; border-radius: 3px; cursor: pointer;"><em>I</em></button>
                            <button type="button" style="padding: 4px 8px; margin-right: 5px; border: 1px solid #d1d5db; background: white; border-radius: 3px; cursor: pointer;">🔗</button>
                        </div>
                        <textarea id="projectDescription" placeholder="프로젝트에 대한 상세 설명을 입력하세요"
                                  style="width: 100%; height: 80px; border: none; outline: none; resize: vertical;">시급 구함
연습합니다.
구합니다. 구합니다.</textarea>
                    </div>
                </div>

                <!-- 썸네일과 첨부파일 -->
                <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <!-- 썸네일 -->
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">썸네일</label>
                        <div style="border: 2px dashed #d1d5db; border-radius: 8px; padding: 40px; text-align: center; background: #f9fafb;">
                            <div style="margin-bottom: 10px;">🖼️</div>
                            <div style="color: #6b7280; margin-bottom: 10px;">썸네일 이미지를 업로드하세요</div>
                            <div style="font-size: 12px; color: #9ca3af;">JPG, PNG, GIF (최대 5MB)</div>
                            <button type="button" onclick="selectThumbnail()"
                                    style="margin-top: 15px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                파일 선택
                            </button>
                        </div>
                    </div>

                    <!-- 첨부파일 -->
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">첨부파일</label>
                        <div style="border: 2px dashed #d1d5db; border-radius: 8px; padding: 40px; text-align: center; background: #f9fafb;">
                            <div style="margin-bottom: 10px;">📎</div>
                            <div style="color: #6b7280; margin-bottom: 10px;">첨부파일을 업로드하세요</div>
                            <div style="font-size: 12px; color: #9ca3af;">모든 파일 형식 (최대 10MB)</div>
                            <button type="button" onclick="selectAttachment()"
                                    style="margin-top: 15px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                파일 선택
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <div style="color: #6b7280; font-size: 14px;">
                    선택된 파일: <span id="worksby-selected-file-name">1</span>개 | 생성할 프로젝트: <span id="worksby-target-count">1</span>개
                </div>
                <div>
                    <button id="worksbyRegisterBtn" class="btn btn-success" onclick="handleWorksbyRegister()" style="padding: 12px 30px; font-size: 16px; font-weight: 600;">
                        <span>🚀</span>
                        등록
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 프로젝트 제목 입력 모달 -->
    <div id="projectTitleModal" class="modal-overlay" style="z-index: 1100;">
        <div class="modal-container" style="max-width: 400px;">
            <div class="modal-header">
                <h2>📝 분류명 입력</h2>
                <button class="modal-close" onclick="closeProjectTitleModal()">&times;</button>
            </div>
            
            <div class="modal-content">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">분류명</label>
                    <input type="text" id="projectTitleInput" placeholder="분류명을 입력하세요" 
                           style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                </div>
                
                <div style="color: #6b7280; font-size: 13px; margin-bottom: 20px;">
                    선택된 파일들이 이 분류명으로 파일 세팅 영역에 추가됩니다.
                </div>
            </div>
            
            <div class="modal-footer">
                <div></div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="closeProjectTitleModal()" 
                            style="background: #6b7280; color: white; padding: 10px 20px;">
                        취소
                    </button>
                    <button class="btn btn-primary" onclick="confirmProjectTitle()">
                        <span>✅</span>
                        확인
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 선택파일 분할 모달 -->
    <div id="fileSplitModal" class="modal-overlay" style="z-index: 1100;">
        <div class="modal-container" style="max-width: 500px;">
            <div class="modal-header">
                <h2>✂️ 선택파일 분할</h2>
                <button class="modal-close" onclick="closeFileSplitModal()">&times;</button>
            </div>
            
            <div class="modal-content">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">파일명</label>
                    <input type="text" id="splitFileName" value="국제회의_번역영상_2025_01.mp4" 
                           style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; background: #f9fafb;" readonly>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">파일 길이</label>
                    <input type="text" id="splitFileLength" value="00:45:30" 
                           style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; background: #f9fafb;" readonly>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #374151;">구간 설정</label>
                    
                    <div id="timeRanges">
                        <div class="time-range-row" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="text" value="" placeholder="00:00:00" maxlength="8" 
                                   onfocus="clearPlaceholder(this)" 
                                   oninput="formatTimeInput(this)" 
                                   onblur="validateAndFormatTime(this)" 
                                   onkeypress="handleTimeKeypress(event, this)"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; width: 100px; text-align: center; font-family: monospace;">
                            <span style="color: #6b7280;">~</span>
                            <input type="text" value="" placeholder="00:00:00" maxlength="8" 
                                   onfocus="clearPlaceholder(this)" 
                                   oninput="formatTimeInput(this)" 
                                   onblur="handleEndTimeComplete(this)" 
                                   onkeypress="handleTimeKeypress(event, this)"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; width: 100px; text-align: center; font-family: monospace;">
                            <button class="btn" onclick="removeTimeRange(this)" 
                                    style="background: #ef4444; color: white; padding: 6px 10px; font-size: 12px; min-width: auto;">
                                ✕
                            </button>
                        </div>
                        
                        <div class="time-range-row" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="text" value="" placeholder="00:00:00" maxlength="8" 
                                   onfocus="clearPlaceholder(this)" 
                                   oninput="formatTimeInput(this)" 
                                   onblur="validateAndFormatTime(this)" 
                                   onkeypress="handleTimeKeypress(event, this)"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; width: 100px; text-align: center; font-family: monospace;">
                            <span style="color: #6b7280;">~</span>
                            <input type="text" value="" placeholder="00:00:00" maxlength="8" 
                                   onfocus="clearPlaceholder(this)" 
                                   oninput="formatTimeInput(this)" 
                                   onblur="handleEndTimeComplete(this)" 
                                   onkeypress="handleTimeKeypress(event, this)"
                                   style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; width: 100px; text-align: center; font-family: monospace;">
                            <button class="btn" onclick="removeTimeRange(this)" 
                                    style="background: #ef4444; color: white; padding: 6px 10px; font-size: 12px; min-width: auto;">
                                ✕
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="addTimeRange()" 
                            style="background: #6b7280; color: white; padding: 8px 16px; font-size: 13px; margin-top: 10px;">
                        + 구간추가
                    </button>
                </div>
            </div>
            
            <div class="modal-footer">
                <div></div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="closeFileSplitModal()" 
                            style="background: #6b7280; color: white; padding: 10px 20px;">
                        취소
                    </button>
                    <button class="btn btn-success" onclick="confirmFileSplit()">
                        <span>✅</span>
                        분할
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 파일 세팅 모달 -->
    <div id="worksbyModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 1400px; width: 98%;">
            <div class="modal-header">
                <h2>⚙️ 파일 세팅</h2>
                <button class="modal-close" onclick="closeWorksbyModal()">&times;</button>
            </div>
            
            <div class="modal-content">
                <h3 style="margin-bottom: 15px; color: #374151;">파일 선택 및 순서 조정</h3>
                
                <table class="file-table" style="table-layout: fixed; width: 100%;">
                    <thead>
                        <tr>
                            <th style="width: 4%; padding: 8px; text-align: center; font-size: 12px; white-space: nowrap;">선택</th>
                            <th style="width: 40%; padding: 8px; text-align: center; font-size: 12px; white-space: nowrap;">파일 이름</th>
                            <th style="width: 8%; padding: 8px; text-align: center; font-size: 12px; white-space: nowrap;">원본언어</th>
                            <th style="width: 25%; padding: 8px; text-align: center; font-size: 12px; white-space: nowrap;">도착언어</th>
                            <th style="width: 10%; padding: 8px; text-align: center; font-size: 12px; white-space: nowrap;">파일길이</th>
                            <th style="width: 13%; padding: 8px; text-align: center; font-size: 12px; white-space: nowrap;">상태</th>
                        </tr>
                    </thead>
                    <tbody id="modal-file-list">
                        <tr id="modal-file-1">
                            <td style="text-align: center;"><input type="checkbox" class="modal-file-checkbox" value="1"></td>
                            <td class="file-name">국제회의_번역영상_2025_01.mp4</td>
                            <td>한글</td>
                            <td>영어, 일본어, 중국어(간체)</td>
                            <td>00:45:30</td>
                            <td style="text-align: center;"><span class="status-badge status-ready">대기</span></td>
                        </tr>
                        <tr id="modal-file-2">
                            <td style="text-align: center;"><input type="checkbox" class="modal-file-checkbox" value="2"></td>
                            <td class="file-name">의료진_대화영상_2025_02.avi</td>
                            <td>한글</td>
                            <td>영어, 일본어, 중국어(간체)</td>
                            <td>01:20:15</td>
                            <td style="text-align: center;"><span class="status-badge status-ready">대기</span></td>
                        </tr>
                        <tr id="modal-file-3">
                            <td style="text-align: center;"><input type="checkbox" class="modal-file-checkbox" value="3"></td>
                            <td class="file-name">기술세미나_영상_2025_03.mov</td>
                            <td>한글</td>
                            <td>영어, 일본어, 중국어(간체)</td>
                            <td>00:35:45</td>
                            <td style="text-align: center;"><span class="status-badge status-ready">대기</span></td>
                        </tr>
                        <tr id="modal-file-4">
                            <td style="text-align: center;"><input type="checkbox" class="modal-file-checkbox" value="4"></td>
                            <td class="file-name">법률계약회의_영상_2025_04.mkv</td>
                            <td>한글</td>
                            <td>영어, 일본어, 중국어(간체)</td>
                            <td>02:10:20</td>
                            <td style="text-align: center;"><span class="status-badge status-ready">대기</span></td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- 파일 순서 조정 버튼 -->
                <div style="text-align: center; margin: 20px 0;">
                    <button class="arrow-button" onclick="moveSelectedFilesDown()" title="선택된 파일을 아래로 이동">
                        <span>⬇️</span>
                        아래로 이동
                    </button>
                </div>
                
                <!-- 하단 템플릿 영역 -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #374151; margin-bottom: 15px;">📋 웍스파이 등록 대상 파일</h3>
                    
                    <table class="file-table" style="background: #f8f9fa;">
                        <thead>
                            <tr style="background: #e5e7eb;">
                                <th style="width: 4%;">선택</th>
                                <th style="width: 15%;">분류명</th>
                                <th style="width: 40%;">파일 이름</th>
                                <th style="width: 8%;">원본언어</th>
                                <th style="width: 25%;">도착언어</th>
                                <th style="width: 8%;">파일길이</th>
                            </tr>
                        </thead>
                        <tbody id="target-file-list">
                            <tr id="empty-state" style="background: white;">
                                <td colspan="6" style="padding: 40px; text-align: center; color: #9ca3af; font-style: italic;">
                                    위에서 파일을 선택하고 "아래로 이동" 버튼을 눌러주세요
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="modal-footer">
                <div>
                    <span style="color: #6b7280; font-size: 14px;">
                        선택된 파일: <span id="selected-count">0</span>개
                    </span>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-warning" onclick="splitSelectedFiles()">
                        <span>✂️</span>
                        분할
                    </button>
                    <button class="btn btn-success" onclick="registerToWorkspy()">
                        <span>✅</span>
                        완료
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 뒤로 가기 함수 (trans-detail.html에서 가져옴)
        function goBack() {
            try {
                if (window.parent && window.parent !== window && typeof window.parent.loadPage === 'function') {
                    window.parent.loadPage('pages/page_kor/translation/trans-management.html');
                    return;
                }
            } catch (e) {
                console.log('parent.loadPage 실패:', e);
            }
            
            try {
                if (window.history.length > 1) {
                    window.history.back();
                    return;
                }
            } catch (e) {
                console.log('history.back() 실패:', e);
            }
            
            try {
                window.location.href = 'trans-management.html';
            } catch (e) {
                console.log('직접 페이지 이동 실패:', e);
                alert('이전 페이지로 돌아갈 수 없습니다.');
            }
        }
        
        // 메인 파일 테이블 컬럼 너비 강제 설정 함수
        function forceMainTableColumnWidths() {
            const table = document.querySelector('.main-file-table');
            if (table) {
                // 테이블 레이아웃 강제 설정
                table.style.tableLayout = 'fixed';
                table.style.width = '100%';
                
                // 헤더 컬럼 너비 강제 설정
                const headerCells = table.querySelectorAll('thead th');
                const widths = ['4%', '35%', '8%', '18%', '12%', '10%', '13%'];
                headerCells.forEach((cell, index) => {
                    if (widths[index]) {
                        cell.style.width = widths[index];
                        cell.style.minWidth = widths[index];
                        cell.style.maxWidth = widths[index];
                    }
                });
                
                // 데이터 셀 너비도 강제 설정
                const dataCells = table.querySelectorAll('tbody td');
                dataCells.forEach((cell, index) => {
                    const colIndex = index % 7;
                    if (widths[colIndex]) {
                        cell.style.width = widths[colIndex];
                        cell.style.minWidth = widths[colIndex];
                        cell.style.maxWidth = widths[colIndex];
                    }
                });
                
                console.log('메인 파일 테이블 컬럼 너비 강제 설정 완료');
            }
        }
        
        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', function() {
            forceMainTableColumnWidths();
            // 약간의 지연 후 한 번 더 실행 (브라우저 렌더링 완료 후)
            setTimeout(forceMainTableColumnWidths, 100);
        });
        
        // 웍스파이 모달 열기
        function openWorksbyModal() {
            document.getElementById('worksbyModal').style.display = 'flex';
            updateSelectedCount();
        }
        
        // 웍스파이 모달 닫기
        function closeWorksbyModal() {
            document.getElementById('worksbyModal').style.display = 'none';
            // 체크박스 초기화
            document.querySelectorAll('.modal-file-checkbox').forEach(cb => {
                cb.checked = false;
            });
            
            // 하단 템플릿 초기화
            const targetTbody = document.getElementById('target-file-list');
            targetTbody.innerHTML = `
                <tr id="empty-state" style="background: white;">
                    <td colspan="6" style="padding: 40px; text-align: center; color: #9ca3af; font-style: italic;">
                        위에서 파일을 선택하고 "아래로 이동" 버튼을 눌러주세요
                    </td>
                </tr>
            `;
            
            updateSelectedCount();
        }
        
        // 선택된 파일 개수 업데이트
        function updateSelectedCount() {
            const checkedBoxes = document.querySelectorAll('.modal-file-checkbox:checked');
            const targetRows = document.querySelectorAll('#target-file-list tr:not(#empty-state)');
            const footerText = document.querySelector('.modal-footer span');
            
            if (footerText) {
                footerText.innerHTML = `선택된 파일: ${checkedBoxes.length}개 | 등록 대상: ${targetRows.length}개`;
            }
        }
        
        // 체크박스 변경 시 카운트 업데이트
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('modal-file-checkbox')) {
                updateSelectedCount();
            } else if (e.target.classList.contains('file-select-checkbox') && !e.target.disabled) {
                // 원본 파일의 체크박스가 변경된 경우, 분할된 파일들도 연동
                const parentRow = e.target.closest('tr');
                if (parentRow && parentRow.classList.contains('tree-parent')) {
                    toggleSplitFilesCheckbox(parentRow, e.target.checked);
                }
                
                updateSelectAllCheckbox();
            }
        });
        
        // 선택된 파일들을 하단 템플릿으로 이동 (프로젝트 제목 입력 후)
        function moveSelectedFilesDown() {
            const checkedBoxes = document.querySelectorAll('.modal-file-checkbox:checked');
            
            if (checkedBoxes.length === 0) {
                alert('이동할 파일을 선택해주세요.');
                return;
            }
            
            // 프로젝트 제목 입력 모달 열기
            const modal = document.getElementById('projectTitleModal');
            if (modal) {
                modal.style.display = 'flex';
                const input = document.getElementById('projectTitleInput');
                if (input) {
                    input.focus();
                }
            }
        }
        
        // 프로젝트 제목 모달 닫기
        function closeProjectTitleModal() {
            document.getElementById('projectTitleModal').style.display = 'none';
            document.getElementById('projectTitleInput').value = '';
        }
        
        // 프로젝트 제목 확인 후 파일 이동
        function confirmProjectTitle() {
            const projectTitle = document.getElementById('projectTitleInput').value.trim();
            
            if (!projectTitle) {
                alert('분류명을 입력해주세요.');
                return;
            }
            
            const checkedBoxes = document.querySelectorAll('.modal-file-checkbox:checked');
            const targetTbody = document.getElementById('target-file-list');
            const emptyState = document.getElementById('empty-state');
            
            // 빈 상태 메시지 제거
            if (emptyState) {
                emptyState.remove();
            }
            
            // 선택된 파일들을 하단 템플릿으로 복사
            checkedBoxes.forEach(checkbox => {
                const originalRow = checkbox.closest('tr');
                
                // 애니메이션 효과
                originalRow.classList.add('file-moving');
                
                // 상태를 '이동됨'으로 변경
                const statusCell = originalRow.querySelector('.status-badge');
                statusCell.textContent = '이동됨';
                statusCell.className = 'status-badge status-moved';
                
                // 새로운 행 생성 (체크박스와 프로젝트 제목 포함)
                const newRow = document.createElement('tr');
                newRow.style.background = 'white';
                newRow.innerHTML = `
                    <td style="text-align: center;"><input type="checkbox" class="target-file-checkbox"></td>
                    <td style="font-weight: 500; color: #3b82f6; text-align: center;">${projectTitle}</td>
                    <td class="file-name" style="text-align: center;">${originalRow.querySelector('.file-name').textContent}</td>
                    <td style="text-align: center;">${originalRow.querySelector('td:nth-child(3)').textContent}</td>
                    <td style="text-align: center;">${originalRow.querySelector('td:nth-child(4)').textContent}</td>
                    <td style="text-align: center;">${originalRow.querySelector('td:nth-child(5)').textContent}</td>
                `;
                
                // 하단 템플릿에 추가
                targetTbody.appendChild(newRow);
                
                // 원본 행에서 체크 해제
                checkbox.checked = false;
                
                // 애니메이션 완료 후 클래스 제거
                setTimeout(() => {
                    originalRow.classList.remove('file-moving');
                }, 500);
            });
            
            // 선택된 파일 개수 업데이트
            updateSelectedCount();
            updateTargetCount();
            
            // 모달 닫기
            closeProjectTitleModal();
            
            alert(`${checkedBoxes.length}개 파일이 "${projectTitle}" 분류로 세팅되었습니다.`);
        }
        
        // 하단 템플릿의 파일 개수 업데이트
        function updateTargetCount() {
            const targetRows = document.querySelectorAll('#target-file-list tr:not(#empty-state)');
            const footerText = document.querySelector('.modal-footer span');
            if (footerText) {
                const selectedCount = document.querySelectorAll('.modal-file-checkbox:checked').length;
                const targetCount = targetRows.length;
                footerText.innerHTML = `선택된 파일: ${selectedCount}개 | 등록 대상: ${targetCount}개`;
            }
        }
        
        // 선택된 파일들 분할
        function splitSelectedFiles() {
            const targetRows = document.querySelectorAll('#target-file-list tr:not(#empty-state)');
            
            if (targetRows.length === 0) {
                alert('분할할 파일이 없습니다. 먼저 파일을 등록 대상으로 이동해주세요.');
                return;
            }
            
            // 첫 번째 파일을 기준으로 분할 모달 열기
            const firstFile = targetRows[0];
            const fileName = firstFile.querySelector('.file-name').textContent;
            const fileLength = firstFile.querySelector('td:nth-child(6)').textContent; // 파일 길이 컬럼
            
            document.getElementById('splitFileName').value = fileName;
            document.getElementById('splitFileLength').value = fileLength;
            document.getElementById('fileSplitModal').style.display = 'flex';
        }
        
        // 파일 분할 모달 닫기
        function closeFileSplitModal() {
            document.getElementById('fileSplitModal').style.display = 'none';
        }
        
        // 시간 구간 추가
        function addTimeRange() {
            const timeRanges = document.getElementById('timeRanges');
            const existingRanges = timeRanges.querySelectorAll('.time-range-row');
            
            // 마지막 구간의 종료 시간을 새 구간의 시작 시간으로 설정
            let newStartTime = "";
            if (existingRanges.length > 0) {
                const lastRange = existingRanges[existingRanges.length - 1];
                const lastEndTimeInput = lastRange.querySelectorAll('input')[1];
                newStartTime = lastEndTimeInput.value || "";
            }
            
            const newRange = document.createElement('div');
            newRange.className = 'time-range-row';
            newRange.style.cssText = 'display: flex; align-items: center; gap: 10px; margin-bottom: 10px;';
            
            newRange.innerHTML = `
                <input type="text" value="${newStartTime}" placeholder="00:00:00" maxlength="8" 
                       onfocus="clearPlaceholder(this)" 
                       oninput="formatTimeInput(this)" 
                       onblur="validateAndFormatTime(this)" 
                       onkeypress="handleTimeKeypress(event, this)"
                       style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; width: 100px; text-align: center; font-family: monospace;">
                <span style="color: #6b7280;">~</span>
                <input type="text" value="" placeholder="00:00:00" maxlength="8" 
                       onfocus="clearPlaceholder(this)" 
                       oninput="formatTimeInput(this)" 
                       onblur="handleEndTimeComplete(this)" 
                       onkeypress="handleTimeKeypress(event, this)"
                       style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; width: 100px; text-align: center; font-family: monospace;">
                <button class="btn" onclick="removeTimeRange(this)" 
                        style="background: #ef4444; color: white; padding: 6px 10px; font-size: 12px; min-width: auto;">
                    ✕
                </button>
            `;
            
            timeRanges.appendChild(newRange);
        }
        
        // 시간 구간 제거
        function removeTimeRange(button) {
            const timeRanges = document.getElementById('timeRanges');
            if (timeRanges.children.length > 1) {
                button.closest('.time-range-row').remove();
                // 구간 제거 후 시간 연결 업데이트
                updateTimeRangeConnections();
            } else {
                alert('최소 1개의 구간은 필요합니다.');
            }
        }
        
        // 플레이스홀더 지우기 (포커스 시)
        function clearPlaceholder(input) {
            // 포커스 시 값이 비어있으면 그대로 두고, 사용자가 입력할 수 있도록 함
            input.select(); // 전체 선택하여 쉽게 덮어쓸 수 있도록
        }
        
        // 시간 입력 자동 포맷팅 (실시간)
        function formatTimeInput(input) {
            let value = input.value.replace(/[^0-9]/g, ''); // 숫자만 남기기
            
            if (value.length >= 6) {
                // 6자리 숫자를 HH:MM:SS 형식으로 변환
                const hours = value.substring(0, 2);
                const minutes = value.substring(2, 4);
                const seconds = value.substring(4, 6);
                input.value = `${hours}:${minutes}:${seconds}`;
            } else if (value.length >= 4) {
                // 4자리 이상일 때 HH:MM: 형식으로 변환
                const hours = value.substring(0, 2);
                const minutes = value.substring(2, 4);
                const seconds = value.substring(4);
                input.value = `${hours}:${minutes}${seconds ? ':' + seconds : ''}`;
            } else if (value.length >= 2) {
                // 2자리 이상일 때 HH: 형식으로 변환
                const hours = value.substring(0, 2);
                const minutes = value.substring(2);
                input.value = `${hours}${minutes ? ':' + minutes : ''}`;
            } else {
                input.value = value;
            }
        }
        
        // 엔터키 처리
        function handleTimeKeypress(event, input) {
            if (event.key === 'Enter') {
                event.preventDefault();
                input.blur(); // 포커스 해제하여 완료 처리
            }
        }
        
        // 시간 입력 완료 시 검증 및 포맷팅
        function validateAndFormatTime(input) {
            let value = input.value.trim();
            
            if (value === '') {
                input.value = '00:00:00'; // 빈 값이면 기본값 설정
                return true;
            }
            
            // 숫자만 입력된 경우 자동 포맷팅
            if (/^\d{6}$/.test(value)) {
                const hours = value.substring(0, 2);
                const minutes = value.substring(2, 4);
                const seconds = value.substring(4, 6);
                value = `${hours}:${minutes}:${seconds}`;
                input.value = value;
            }
            
            // 시간 형식 검증
            const timeRegex = /^([0-1]?[0-9]|2[0-3]):([0-5]?[0-9]):([0-5]?[0-9])$/;
            
            if (!timeRegex.test(value)) {
                alert('올바른 시간 형식을 입력해주세요.\n예시: 123045 → 12:30:45');
                input.focus();
                return false;
            }
            
            // 시간 형식 정규화 (예: 1:5:30 → 01:05:30)
            const timeParts = value.split(':');
            const normalizedTime = timeParts.map(part => part.padStart(2, '0')).join(':');
            input.value = normalizedTime;
            
            return true;
        }
        
        // 종료 시간 입력 완료 시 다음 구간 시작 시간 자동 설정
        function handleEndTimeComplete(endTimeInput) {
            if (!validateAndFormatTime(endTimeInput)) {
                return;
            }
            
            const currentRow = endTimeInput.closest('.time-range-row');
            const timeRanges = document.getElementById('timeRanges');
            const allRows = timeRanges.querySelectorAll('.time-range-row');
            
            // 현재 행의 인덱스 찾기
            let currentIndex = -1;
            allRows.forEach((row, index) => {
                if (row === currentRow) {
                    currentIndex = index;
                }
            });
            
            // 다음 구간이 있다면 시작 시간 업데이트
            if (currentIndex >= 0 && currentIndex < allRows.length - 1) {
                const nextRow = allRows[currentIndex + 1];
                const nextStartTimeInput = nextRow.querySelectorAll('input')[0];
                nextStartTimeInput.value = endTimeInput.value;
            }
        }
        
        // 모든 시간 구간 연결 업데이트
        function updateTimeRangeConnections() {
            const timeRanges = document.getElementById('timeRanges');
            const allRows = timeRanges.querySelectorAll('.time-range-row');
            
            allRows.forEach((row, index) => {
                if (index > 0) {
                    const prevRow = allRows[index - 1];
                    const prevEndTimeInput = prevRow.querySelectorAll('input')[1];
                    const currentStartTimeInput = row.querySelectorAll('input')[0];
                    
                    // 이전 구간의 종료 시간을 현재 구간의 시작 시간으로 설정
                    currentStartTimeInput.value = prevEndTimeInput.value;
                }
            });
        }
        
        // 파일 분할 확인
        function confirmFileSplit() {
            const fileName = document.getElementById('splitFileName').value;
            const timeRangeRows = document.querySelectorAll('.time-range-row');
            
            if (timeRangeRows.length === 0) {
                alert('분할할 구간을 설정해주세요.');
                return;
            }
            
            // 시간 구간 수집
            const timeRanges = [];
            let hasInvalidTime = false;
            
            timeRangeRows.forEach((row, index) => {
                const inputs = row.querySelectorAll('input[type="text"]');
                let startTime = inputs[0].value.trim();
                let endTime = inputs[1].value.trim();
                
                // 빈 값 처리
                if (startTime === '') {
                    startTime = '00:00:00';
                    inputs[0].value = startTime;
                }
                if (endTime === '') {
                    endTime = '00:00:00';
                    inputs[1].value = endTime;
                }
                
                // 시간 형식 검증
                if (!validateAndFormatTime(inputs[0]) || !validateAndFormatTime(inputs[1])) {
                    hasInvalidTime = true;
                    return;
                }
                
                // 최종 값 다시 가져오기 (정규화된 값)
                startTime = inputs[0].value;
                endTime = inputs[1].value;
                
                const rangeName = `${fileName.replace(/\.[^/.]+$/, "")}_구간${index + 1}.${fileName.split('.').pop()}`;
                
                timeRanges.push({
                    start: startTime,
                    end: endTime,
                    name: rangeName
                });
            });
            
            if (hasInvalidTime) {
                alert('모든 시간을 올바르게 입력해주세요.');
                return;
            }
            
            if (timeRanges.length === 0) {
                alert('유효한 시간 구간이 없습니다.');
                return;
            }
            
            // 분할 컨텍스트 확인
            const splitContext = window.currentSplitContext;
            
            if (splitContext && splitContext.area === 'main') {
                // 메인 파일 리스트에서의 분할 처리
                updateMainFileListWithSplits(fileName, timeRanges);
            } else if (splitContext && splitContext.area === 'intermediate') {
                // 중간어 영역에서의 분할 처리
                updateIntermediateAreaWithSplits(fileName, timeRanges, splitContext.projectTitle);
            } else if (splitContext && splitContext.area === 'destination') {
                // 도착어 영역에서의 분할 처리
                updateDestinationAreaWithSplits(fileName, timeRanges, splitContext.projectTitle);
            } else {
                // 기존 파일 세팅 모달에서의 분할 처리
                updateTargetListWithSplits(fileName, timeRanges);
            }
            
            alert(`파일이 ${timeRanges.length}개 구간으로 분할되었습니다.`);
            closeFileSplitModal();
        }
        
        // 메인 파일 리스트 분할 업데이트 함수
        function updateMainFileListWithSplits(fileName, timeRanges) {
            console.log('메인 파일 리스트 분할 업데이트:', fileName, timeRanges);
            
            // 메인 파일 리스트에서 원본 파일 찾기
            const mainTbody = document.querySelector('.file-table tbody');
            if (!mainTbody) return;
            
            const rows = mainTbody.querySelectorAll('tr');
            let originalRow = null;
            
            rows.forEach(row => {
                const fileNameCell = row.querySelector('.file-name');
                if (fileNameCell && fileNameCell.textContent.trim() === fileName) {
                    originalRow = row;
                }
            });
            
            if (originalRow) {
                // 원본 파일에 분할 표시 추가
                const originalFileNameCell = originalRow.querySelector('.file-name');
                if (!originalFileNameCell.textContent.includes('[분할됨]')) {
                    originalFileNameCell.textContent += '[분할됨]';
                }
                
                // 원본 파일에 tree-parent 클래스 추가
                originalRow.classList.add('tree-parent');
                
                // 원본 파일의 체크박스는 활성화 상태 유지
                const originalCheckbox = originalRow.querySelector('.file-select-checkbox');
                if (originalCheckbox) {
                    originalCheckbox.checked = false; // 체크만 해제
                }
                
                // 분할된 파일들을 트리 구조로 추가
                timeRanges.forEach((range, index) => {
                    const splitRow = document.createElement('tr');
                    splitRow.className = 'tree-child';
                    splitRow.style.cursor = 'pointer';
                    splitRow.style.backgroundColor = '#f8f9fa';
                    splitRow.onclick = () => selectFileRow(splitRow);
                    // 분할된 파일도 원본 파일과 같은 data-file-id 사용 (그룹으로 인식)
                    splitRow.setAttribute('data-file-id', originalRow.getAttribute('data-file-id'));
                    splitRow.innerHTML = `
                        <td style="text-align: center;"><input type="checkbox" class="file-select-checkbox split-file-checkbox" value="${fileName}-split-${index + 1}" disabled style="opacity: 0.6;"></td>
                        <td class="file-name">${range.name}</td>
                        <td style="text-align: center;">${originalRow.querySelector('td:nth-child(3)').textContent}</td>
                        <td style="text-align: center;">${originalRow.querySelector('td:nth-child(4)').textContent}</td>
                        <td style="text-align: center;">${range.start} ~ ${range.end}</td>
                        <td style="text-align: center;">
                            <span class="prompt-badge" style="background: #e5e7eb; color: #374151; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">기본</span>
                        </td>
                        <td style="text-align: center;"><span class="worksby-status-badge" style="background: #fef2f2; color: #991b1b; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">미등록</span></td>
                    `;
                    
                    // 원본 파일 다음에 삽입
                    mainTbody.insertBefore(splitRow, originalRow.nextSibling);
                });
                
                console.log(`메인 파일 리스트에 ${timeRanges.length}개의 분할 파일이 추가되었습니다.`);
            }
        }
        
        // 중간어 영역 분할 업데이트 함수
        function updateIntermediateAreaWithSplits(fileName, timeRanges, projectTitle) {
            console.log('중간어 영역 분할 업데이트:', fileName, timeRanges);
            
            // 분할 컨텍스트에서 프로젝트 ID 가져오기
            const splitContext = window.currentSplitContext;
            const projectId = splitContext?.projectId;
            
            if (!projectId) {
                console.log('프로젝트 ID를 찾을 수 없습니다.');
                return;
            }
            
            console.log(`중간어 영역 분할 - 프로젝트 ID: ${projectId}`);
            
            const intermediateTbody = document.getElementById(`intermediate-tbody-${projectId}`);
            if (!intermediateTbody) {
                console.log(`중간어 영역 테이블을 찾을 수 없습니다: intermediate-tbody-${projectId}`);
                return;
            }
            
            // 기존 원본 파일 행 찾기
            const rows = intermediateTbody.querySelectorAll('tr');
            let originalRow = null;
            
            rows.forEach(row => {
                const fileNameCell = row.querySelector('.file-name');
                if (fileNameCell && fileNameCell.textContent.trim() === fileName) {
                    originalRow = row;
                }
            });
            
            if (originalRow) {
                // 원본 파일에 분할 표시 추가
                const originalFileNameCell = originalRow.querySelector('.file-name');
                if (!originalFileNameCell.textContent.includes('[분할됨]')) {
                    originalFileNameCell.textContent += '[분할됨]';
                }
                
                // 원본 파일에 tree-parent 클래스 추가
                originalRow.classList.add('tree-parent');
                
                // 원본 파일의 버튼들 숨기기 (웍스파이 등록, 작업자(상태), 새 작업자 배정, 산출물)
                originalRow.innerHTML = `
                    <td style="text-align: center;" id="intermediate-project-parent"></td>
                    <td class="file-name">${fileName}[분할됨]</td>
                    <td style="text-align: center;">한글</td>
                    <td style="text-align: center;">영어</td>
                    <td style="text-align: center;">00:45:30</td>
                    <td style="text-align: center; color: #9ca3af;">-</td>
                    <td style="text-align: center; color: #9ca3af;">-</td>
                    <td style="text-align: center; color: #9ca3af;">-</td>
                    <td style="text-align: center;">
                        <button class="btn" onclick="mergeIntermediateFiles('${fileName}', '${projectTitle}')" 
                                style="background: #f97316; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                            검수툴 실행(파일 합치기)
                        </button>
                    </td>
                    <td style="text-align: center; color: #9ca3af;">-</td>
                    <td style="text-align: center; color: #9ca3af;">-</td>
                `;
                
                // 분할된 파일들을 트리 구조로 추가
                timeRanges.forEach((range, index) => {
                    const splitRow = document.createElement('tr');
                    splitRow.className = 'tree-child';
                    splitRow.innerHTML = `
                        <td style="text-align: center;" id="intermediate-project-split-${index}"></td>
                        <td class="file-name">${range.name}</td>
                        <td style="text-align: center;">한글</td>
                        <td style="text-align: center;">영어</td>
                        <td style="text-align: center;">${range.start} ~ ${range.end}</td>
                        <td style="text-align: center;" id="intermediate-register-split-${index}">
                            <span style="color: #9ca3af;">-</span>
                        </td>
                        <td style="text-align: center; font-size: 12px; color: #6b7280;">
                            - (대기)
                        </td>
                        <td style="text-align: center;">
                            <button class="btn" onclick="assignNewWorker('${range.name}', '${projectTitle}')" 
                                    style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                작업자 배정
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;">
                                <button class="btn" onclick="executeTranscription('${range.name}')" 
                                        style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                    전사툴 실행
                                </button>
                                <button class="btn" onclick="executeReview('${range.name}')" 
                                        style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                    검수툴 실행
                                </button>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn" onclick="downloadOutput('${range.name}')" 
                                    style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                산출물 다운로드
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                대기
                            </span>
                        </td>
                    `;
                    
                    // 원본 파일 다음에 삽입
                    intermediateTbody.insertBefore(splitRow, originalRow.nextSibling);
                });
            }
        }
        
        // 기존 파일 세팅 모달에서의 분할 처리 (기존 로직)
        function updateTargetListWithSplits(fileName, timeRanges) {
            // 하단 템플릿에서 원본 파일 찾기
            const targetTbody = document.getElementById('target-file-list');
            const targetRows = Array.from(targetTbody.querySelectorAll('tr:not(#empty-state)'));
            
            let originalRowIndex = -1;
            targetRows.forEach((row, index) => {
                if (row.querySelector('.file-name').textContent === fileName) {
                    originalRowIndex = index;
                }
            });
            
            if (originalRowIndex !== -1) {
                const originalRow = targetRows[originalRowIndex];
                const originalData = {
                    projectTitle: originalRow.querySelector('td:nth-child(2)').textContent,
                    fileName: originalRow.querySelector('td:nth-child(3)').textContent,
                    sourceLanguage: originalRow.querySelector('td:nth-child(4)').textContent,
                    targetLanguage: originalRow.querySelector('td:nth-child(5)').textContent,
                    totalDuration: originalRow.querySelector('td:nth-child(6)').textContent
                };
                
                // 원본 파일에 분할 표시 추가
                const originalFileNameCell = originalRow.querySelector('.file-name');
                if (!originalFileNameCell.querySelector('.split-file-indicator')) {
                    originalFileNameCell.innerHTML += '<span class="split-file-indicator">[분할됨]</span>';
                }
                
                // 원본 파일에 tree-parent 클래스 추가
                originalRow.classList.add('tree-parent');
                
                // 분할된 파일들을 트리 구조로 추가
                timeRanges.forEach((range, index) => {
                    const splitRow = document.createElement('tr');
                    splitRow.className = 'tree-child';
                    splitRow.innerHTML = `
                        <td style="text-align: center;"><input type="checkbox" class="target-file-checkbox"></td>
                        <td style="font-weight: 500; color: #3b82f6;">${originalData.projectTitle || '미지정'}</td>
                        <td class="file-name">${range.name}</td>
                        <td>${originalData.sourceLanguage}</td>
                        <td>${originalData.targetLanguage}</td>
                        <td>${range.start} ~ ${range.end}</td>
                    `;
                    
                    // 원본 파일 다음에 삽입
                    const insertAfter = originalRowIndex + index + 1;
                    if (insertAfter < targetTbody.children.length) {
                        targetTbody.insertBefore(splitRow, targetTbody.children[insertAfter]);
                    } else {
                        targetTbody.appendChild(splitRow);
                    }
                });
            }
        }
        
        // 중간어 영역 진행상태 업데이트 함수
        function updateIntermediateAreaProgressStatus(fileName, status) {
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                return;
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`중간어 진행상태 업데이트 - 현재 프로젝트 ID: ${currentProjectId}`);
            
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            if (!intermediateTbody) {
                console.log(`중간어 영역 테이블을 찾을 수 없습니다: intermediate-tbody-${currentProjectId}`);
                return;
            }
            
            const rows = intermediateTbody.querySelectorAll('tr');
            rows.forEach(row => {
                // 프로젝트명 컬럼이 추가되어 파일명은 두 번째 셀
                const fileNameCell = row.querySelector('td:nth-child(2)') || row.querySelector('.file-name');
                if (fileNameCell) {
                    const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                    if (currentFileName === fileName) {
                        // 진행상태 컬럼 찾기 (마지막 컬럼)
                        const progressCell = row.querySelector('td:last-child');
                        if (progressCell) {
                            // 배지 스타일로 업데이트
                            const badgeColor = status === '검수완료' ? '#10b981' : '#6b7280';
                            progressCell.innerHTML = `<span style="background: ${badgeColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">${status}</span>`;
                        }
                    }
                }
            });
        }
        
        // 중간어 영역 파일 합치기 함수
        function mergeIntermediateFiles(fileName, projectTitle) {
            console.log('중간어 영역 파일 합치기 실행:', fileName, projectTitle);
            
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                alert('현재 프로젝트 영역을 찾을 수 없습니다.');
                return;
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`중간어 파일 합치기 - 현재 프로젝트 ID: ${currentProjectId}`);
            
            // 먼저 중간어 영역의 모든 웍스파이 등록 상태 확인
            if (!checkIntermediateRegistrationComplete()) {
                alert('⚠️ 중간어 영역의 모든 파일의 웍스파이 등록을 완료해주세요.\n\n등록이 완료되지 않은 파일이 있습니다.');
                return;
            }
            
            if (confirm(`${fileName} 파일의 중간어 영역 분할된 구간들을 합치는 검수툴을 실행하시겠습니까?`)) {
                // 중간어 영역의 진행상태를 "검수완료"로 변경
                updateIntermediateAreaProgressStatus(fileName, '검수완료');
                
                // 모든 도착 언어별로 도착어 영역 생성
                createDestinationLanguageAreaFromIntermediate(fileName, projectTitle, currentProjectId);
                alert(`${fileName} 파일의 검수툴이 실행되었습니다.\n중간어 영역 진행상태가 "검수완료"로 변경되었습니다.\n모든 도착 언어별 도착어 영역이 생성되었습니다.`);
            }
        }
        
        // 중간어 영역에서 도착어 영역 생성 함수
        function createDestinationLanguageAreaFromIntermediate(fileName, projectTitle, projectId) {
            console.log('중간어 영역에서 도착어 영역 생성:', fileName, projectTitle);
            
            // 중간어 영역에서 파일 목록 수집
            const intermediateTbody = document.getElementById(`intermediate-tbody-${projectId}`);
            const allFiles = [];
            
            console.log(`도착어 영역 생성 - 프로젝트 ID: ${projectId}`);
            
            if (intermediateTbody) {
                const rows = intermediateTbody.querySelectorAll('tr');
                rows.forEach(row => {
                    // 원본 파일(tree-parent)과 일반 파일만 수집 (분할된 자식 파일 제외)
                    if (!row.classList.contains('tree-child')) {
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const currentFileName = fileNameCell.textContent.replace('[분할됨]', '').trim();
                            allFiles.push(currentFileName);
                        }
                    }
                });
            }
            
            console.log('중간어 영역에서 수집된 파일들:', allFiles);
            
            // 중간어 영역 하단에 도착어 영역 추가
            const intermediateArea = document.getElementById(`intermediate-language-area-${projectId}`);
            if (!intermediateArea) {
                console.log(`중간어 영역을 찾을 수 없습니다: intermediate-language-area-${projectId}`);
                return;
            }
            
            // 기존 도착어 영역들 제거 (재생성) - 현재 프로젝트 내에서만
            const existingDestinationAreas = intermediateArea.querySelectorAll('.destination-language-area');
            existingDestinationAreas.forEach(area => area.remove());
            
            // 기존 도착어 전체 컨테이너도 제거
            const existingDestinationContainer = document.getElementById(`destination-container-${projectId}`);
            if (existingDestinationContainer) {
                existingDestinationContainer.remove();
            }
            
            // 도착어 전체를 감싸는 큰 컨테이너 생성
            const destinationContainer = document.createElement('div');
            destinationContainer.id = `destination-container-${projectId}`;
            destinationContainer.className = 'work-area-container';
            destinationContainer.style.cssText = 'margin-top: 20px;';
            
            // 도착어 전체 헤더
            destinationContainer.innerHTML = `
                <div class="work-area-header">
                    <h2 class="work-area-title">🎯 도착어 영역</h2>
                </div>
                <div class="work-area-content" id="destination-languages-wrapper-${projectId}">
                    <!-- 각 언어별 영역들이 여기에 추가됩니다 -->
                </div>
            `;
            
            intermediateArea.appendChild(destinationContainer);
            
            // 도착어 목록 (파일 리스트의 도착 언어 기준)
            const destinationLanguages = ["영어", "일본어", "중국어(간체)"];
            const languagesWrapper = document.getElementById(`destination-languages-wrapper-${projectId}`);
            
            // 각 언어별로 별도의 영역 생성
            destinationLanguages.forEach((lang, langIndex) => {
                const destinationArea = document.createElement('div');
                destinationArea.id = `destination-language-area-${langIndex}`;
                destinationArea.className = 'destination-language-area';
                destinationArea.style.cssText = 'margin-top: 20px;';
                
                // 각 언어별 영역 내용을 DOM으로 생성
                const areaContent = document.createElement('div');
                areaContent.style.cssText = 'background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 15px;';
                
                // 헤더 생성 (버튼 없이)
                const header = document.createElement('div');
                header.style.cssText = 'background: #dcfce7; padding: 15px 20px; border-bottom: 1px solid #e5e7eb;';
                
                const title = document.createElement('h3');
                title.style.cssText = 'margin: 0; font-size: 16px; font-weight: 600; color: #10b981;';
                title.textContent = `🎯 ${lang} 번역`;
                
                header.appendChild(title);
                
                // 테이블 생성
                const table = document.createElement('table');
                table.className = 'file-table';
                table.style.cssText = 'table-layout: fixed; width: 100%; margin-bottom: 0;';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width: 13%;">프로젝트명</th>
                            <th style="width: 19%;">파일 이름</th>
                            <th style="width: 5%;">출발어</th>
                            <th style="width: 10%;">도착어</th>
                            <th style="width: 7%;">작업 시간</th>
                            <th style="width: 7%; text-align: center;">웍스파이 등록</th>
                            <th style="width: 10%; text-align: center;">작업자(상태)</th>
                            <th style="width: 7%; text-align: center;">작업자 배정</th>
                            <th style="width: 10%; text-align: center;">전사툴</th>
                            <th style="width: 7%; text-align: center;">산출물</th>
                            <th style="width: 5%; text-align: center;">진행상태</th>
                        </tr>
                    </thead>
                    <tbody id="destination-tbody-${projectId}-${langIndex}">
                        <!-- 도착어 영역 파일들이 동적으로 추가됩니다 -->
                    </tbody>
                `;
                
                // 버튼 영역 생성 (테이블 아래)
                const buttonArea = document.createElement('div');
                buttonArea.style.cssText = 'padding: 15px 20px; border-top: 1px solid #e5e7eb; background: #f8f9fa; display: flex; justify-content: flex-end; gap: 10px;';
                
                // 시나리오 구분: 파일 개수가 2개 이상이면 시나리오 3 (파일 분할 버튼 숨김)
                const isScenario3 = allFiles.length >= 2;
                
                // 시나리오 1,2에서만 파일 분할 버튼 표시
                if (!isScenario3) {
                    const splitBtn = document.createElement('button');
                    splitBtn.className = 'btn btn-warning';
                    splitBtn.style.cssText = 'padding: 8px 16px; font-size: 14px;';
                    splitBtn.innerHTML = '<span>✂️</span> 파일 분할';
                    splitBtn.onclick = () => splitDestinationFile(`${fileName}_${lang}`, projectTitle, lang, langIndex);
                    buttonArea.appendChild(splitBtn);
                }
                
                const worksbyBtn = document.createElement('button');
                worksbyBtn.className = 'btn';
                worksbyBtn.style.cssText = 'background: #8b5cf6; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;';
                worksbyBtn.innerHTML = '<span>🚀</span> 웍스파이 프로젝트 생성';
                worksbyBtn.onclick = () => createDestinationWorksbyProject(`${fileName}_${lang}`, projectTitle, lang, langIndex);
                
                buttonArea.appendChild(worksbyBtn);
                
                areaContent.appendChild(header);
                areaContent.appendChild(table);
                areaContent.appendChild(buttonArea);
                destinationArea.appendChild(areaContent);
                
                languagesWrapper.appendChild(destinationArea);
                
                // 각 언어별 테이블에 파일 행들 동적 추가
                const destinationTbody = document.getElementById(`destination-tbody-${projectId}-${langIndex}`);
                if (destinationTbody) {
                    allFiles.forEach((file, fileIndex) => {
                        const row = document.createElement('tr');
                        
                        // 각 셀을 개별적으로 생성
                        const projectNameCell = document.createElement('td');
                        projectNameCell.style.textAlign = 'center';
                        projectNameCell.textContent = ''; // 초기에는 비어있음, 웍스파이 프로젝트 생성 후 채워짐
                        projectNameCell.id = `destination-project-${langIndex}-${fileIndex}`;
                        
                        const fileNameCell = document.createElement('td');
                        fileNameCell.className = 'file-name';
                        fileNameCell.textContent = `${file}_${lang}`;
                        
                        const sourceCell = document.createElement('td');
                        sourceCell.style.textAlign = 'center';
                        sourceCell.textContent = '한글';
                        
                        const targetCell = document.createElement('td');
                        targetCell.style.textAlign = 'center';
                        targetCell.textContent = lang;
                        
                        const timeCell = document.createElement('td');
                        timeCell.style.textAlign = 'center';
                        timeCell.textContent = '00:45:30';
                        
                        const registerCell = document.createElement('td');
                        registerCell.style.textAlign = 'center';
                        registerCell.id = `destination-register-${langIndex}-${fileIndex}`;
                        registerCell.innerHTML = '<span style="color: #9ca3af;">-</span>';
                        
                        const workerCell = document.createElement('td');
                        workerCell.style.textAlign = 'center';
                        workerCell.style.fontSize = '12px';
                        workerCell.style.color = '#6b7280';
                        workerCell.textContent = '- (대기)';
                        
                        const assignCell = document.createElement('td');
                        assignCell.style.textAlign = 'center';
                        
                        // 첫 번째 파일에만 작업자 배정 버튼 표시 (시나리오 3)
                        if (fileIndex === 0) {
                            assignCell.innerHTML = `<button class="btn" onclick="assignNewWorker('${file}_${lang}', '${projectTitle}')" style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">작업자 배정</button>`;
                        } else {
                            assignCell.innerHTML = `<span style="color: #9ca3af;">-</span>`;
                        }
                        
                        const toolsCell = document.createElement('td');
                        toolsCell.style.textAlign = 'center';
                        toolsCell.innerHTML = `<div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;"><button class="btn" onclick="executeTranscription('${file}_${lang}')" style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">전사툴 실행</button><button class="btn" onclick="executeReview('${file}_${lang}')" style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">검수툴 실행</button></div>`;
                        
                        const outputCell = document.createElement('td');
                        outputCell.style.textAlign = 'center';
                        outputCell.innerHTML = `<button class="btn" onclick="downloadOutput('${file}_${lang}')" style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">산출물 다운로드</button>`;
                        
                        const statusCell = document.createElement('td');
                        statusCell.style.textAlign = 'center';
                        statusCell.innerHTML = '<span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">대기</span>';
                        
                        // 모든 셀을 행에 추가
                        row.appendChild(projectNameCell);
                        row.appendChild(fileNameCell);
                        row.appendChild(sourceCell);
                        row.appendChild(targetCell);
                        row.appendChild(timeCell);
                        row.appendChild(registerCell);
                        row.appendChild(workerCell);
                        row.appendChild(assignCell);
                        row.appendChild(toolsCell);
                        row.appendChild(outputCell);
                        row.appendChild(statusCell);
                        
                        destinationTbody.appendChild(row);
                    });
                }
            });
            
            console.log('도착어 영역이 생성되었습니다.');
            
            // 하단 영역을 최하단으로 이동
            ensureBottomSectionsAtEnd();
        }
        
        // 도착어 영역에서 웍스파이 프로젝트 생성
        function createDestinationWorksbyProject(fileName, projectTitle, language, langIndex) {
            console.log('도착어 영역 웍스파이 프로젝트 생성:', fileName, projectTitle, language, langIndex);
            
            // 현재 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            const currentProjectId = visibleProjectArea ? visibleProjectArea.id.replace('worksby-detail-area-', '') : null;
            
            // 선택된 파일 정보를 전역 변수에 저장
            window.selectedFileInfo = {
                fileName: fileName,
                projectTitle: projectTitle,
                language: language,
                langIndex: langIndex,
                fromDestinationArea: true,  // 도착어 영역에서 호출됨을 표시
                currentProjectId: currentProjectId
            };
            
            console.log('도착어 영역 웍스파이 프로젝트 생성 - 저장된 정보:', window.selectedFileInfo);
            
            // 웍스파이 등록 모달 열기
            openWorksbyRegistrationModal(fileName, projectTitle);
        }
        
        // 도착어 영역 웍스파이 등록 완료 후 버튼 업데이트
        function updateDestinationWorksbyButtons(projectTitle, language, langIndex) {
            // 현재 프로젝트 ID 가져오기
            const currentProjectId = window.selectedFileInfo?.currentProjectId;
            if (!currentProjectId) {
                console.log('현재 프로젝트 ID를 찾을 수 없습니다.');
                return;
            }
            
            console.log(`도착어 웍스파이 버튼 업데이트 - 프로젝트 ID: ${currentProjectId}, 언어 인덱스: ${langIndex}`);
            
            const destinationTbody = document.getElementById(`destination-tbody-${currentProjectId}-${langIndex}`);
            
            if (!destinationTbody) {
                return;
            }
            
            const rows = destinationTbody.querySelectorAll('tr');
            
            rows.forEach((row, index) => {
                // 원본 파일(tree-parent)은 등록 확인 버튼 업데이트 제외
                if (row.classList.contains('tree-parent')) {
                    return;
                }
                
                // 프로젝트명 컬럼 업데이트 (분할된 파일과 일반 파일 구분)
                let projectNameCell;
                if (row.classList.contains('tree-child')) {
                    // 분할된 파일의 경우 split ID로 찾기
                    const splitIndex = Array.from(destinationTbody.querySelectorAll('tr.tree-child')).indexOf(row);
                    projectNameCell = document.getElementById(`destination-project-${langIndex}-split-${splitIndex}`);
                } else {
                    // 일반 파일의 경우 기본 ID로 찾기
                    projectNameCell = document.getElementById(`destination-project-${langIndex}-${index}`);
                }
                
                if (projectNameCell) {
                    projectNameCell.textContent = projectTitle;
                }
                
                // 분할된 파일인 경우와 일반 파일인 경우 ID 구분
                let registerCell;
                if (row.classList.contains('tree-child')) {
                    // 분할된 파일의 경우 split ID로 찾기
                    const splitIndex = Array.from(destinationTbody.querySelectorAll('tr.tree-child')).indexOf(row);
                    registerCell = document.getElementById(`destination-register-split-${langIndex}-${splitIndex}`);
                } else {
                    // 일반 파일의 경우 기본 ID로 찾기
                    registerCell = document.getElementById(`destination-register-${langIndex}-${index}`);
                }
                
                if (registerCell) {
                    const fileName = row.querySelector('.file-name').textContent;
                    
                    registerCell.innerHTML = `
                        <button class="btn btn-success" onclick="openProjectDetailModal('${fileName}', '${projectTitle}')" 
                                style="padding: 6px 12px; font-size: 12px; margin: 0 auto; display: inline-block;">
                            <span>✅</span>
                            등록 확인
                        </button>
                    `;
                }
            });
        }
        
        // 중간어 영역의 모든 웍스파이 등록 완료 여부 확인
        function checkIntermediateRegistrationComplete() {
            console.log('중간어 영역 웍스파이 등록 완료 여부 확인 시작');
            
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                return false;
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`중간어 웍스파이 등록 확인 - 현재 프로젝트 ID: ${currentProjectId}`);
            
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            if (!intermediateTbody) {
                console.log(`중간어 영역을 찾을 수 없습니다: intermediate-tbody-${currentProjectId}`);
                return false;
            }
            
            const rows = intermediateTbody.querySelectorAll('tr');
            console.log('중간어 영역 파일 행 수:', rows.length);
            
            let incompleteFiles = [];
            
            rows.forEach((row, index) => {
                const fileNameCell = row.querySelector('.file-name');
                const registerCell = row.querySelector('td:nth-child(5)'); // 중간어 영역 웍스파이 등록 컬럼
                const button = registerCell ? registerCell.querySelector('button') : null;
                
                if (fileNameCell && button) {
                    const fileName = fileNameCell.textContent.replace('→ ', '').trim();
                    const buttonText = button.textContent.trim();
                    
                    console.log(`중간어 파일 ${index + 1}: ${fileName} - 버튼 상태: ${buttonText}`);
                    
                    // 버튼 텍스트가 "등록"인 경우 (등록 확인이 아닌 경우)
                    if (buttonText.includes('등록') && !buttonText.includes('등록 확인')) {
                        incompleteFiles.push(fileName);
                    }
                }
            });
            
            console.log('중간어 영역 등록 미완료 파일들:', incompleteFiles);
            
            if (incompleteFiles.length > 0) {
                console.log(`중간어 영역에서 등록이 완료되지 않은 파일 ${incompleteFiles.length}개 발견`);
                return false;
            }
            
            console.log('중간어 영역의 모든 파일의 웍스파이 등록이 완료되었습니다.');
            return true;
        }
        
        // 도착어 영역 생성 함수 (언어별 × 파일별 매트릭스)
        function createDestinationLanguageArea(fileName, projectTitle) {
            console.log('도착어 영역 생성:', fileName, projectTitle);
            
            // 중간어 영역에서 파일 목록 수집 및 시나리오 구분
            const intermediateTbody = document.getElementById('intermediate-tbody');
            const allFiles = [];
            let hasTreeStructure = false;
            
            if (intermediateTbody) {
                const rows = intermediateTbody.querySelectorAll('tr');
                rows.forEach(row => {
                    if (row.classList.contains('tree-parent')) {
                        hasTreeStructure = true; // 시나리오 1: 파일 분할
                        // 분할된 파일의 경우 원본 파일명 추가
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const originalFileName = fileNameCell.textContent.replace('[분할됨]', '').trim();
                            allFiles.push(originalFileName);
                        }
                    } else if (!row.classList.contains('tree-child')) {
                        // tree-parent도 tree-child도 아닌 일반 파일들 (시나리오 2, 3)
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                            allFiles.push(currentFileName);
                        }
                    }
                });
            }
            
            console.log('중간어 영역에서 수집된 파일들:', allFiles);
            console.log('중간어 영역 트리 구조 존재 여부:', hasTreeStructure);
            
            // 시나리오 구분
            const isMultipleFiles = allFiles.length > 1 && !hasTreeStructure; // 시나리오 3: 복수 파일 (분할 아님)
            const isSingleFile = allFiles.length === 1 && !hasTreeStructure; // 시나리오 2: 단일 파일
            const isSplitFile = hasTreeStructure; // 시나리오 1: 분할 파일
            
            console.log(`도착어 시나리오 구분: 분할파일=${isSplitFile}, 단일파일=${isSingleFile}, 복수파일=${isMultipleFiles}`);
            
            // 중간어 영역 하단에 도착어 영역 추가
            const detailArea = document.getElementById('template-detail-area');
            if (!detailArea) return;
            
            // 기존 도착어 영역들 제거 (재생성)
            const existingDestinationAreas = document.querySelectorAll('.destination-language-area');
            existingDestinationAreas.forEach(area => area.remove());
            
            // 기존 도착어 전체 컨테이너도 제거
            const existingDestinationContainer = document.getElementById('destination-container');
            if (existingDestinationContainer) {
                existingDestinationContainer.remove();
            }
            
            // 도착어 전체를 감싸는 큰 컨테이너 생성
            const destinationContainer = document.createElement('div');
            destinationContainer.id = 'destination-container';
            destinationContainer.className = 'work-area-container';
            destinationContainer.style.cssText = 'margin-top: 20px;';
            
            // 도착어 전체 헤더
            destinationContainer.innerHTML = `
                <div class="work-area-header">
                    <h2 class="work-area-title">🎯 도착어 영역</h2>
                </div>
                <div class="work-area-content" id="destination-languages-wrapper">
                    <!-- 각 언어별 영역들이 여기에 추가됩니다 -->
                </div>
            `;
            
            detailArea.appendChild(destinationContainer);
            
            // 도착어 목록
            const destinationLanguages = ["영어", "일본어", "중국어(간체)"];
            const languagesWrapper = document.getElementById('destination-languages-wrapper');
            
            // 각 언어별로 별도의 영역 생성
            destinationLanguages.forEach((lang, langIndex) => {
                const destinationArea = document.createElement('div');
                destinationArea.id = `destination-language-area-${langIndex}`;
                destinationArea.className = 'destination-language-area';
                destinationArea.style.cssText = 'margin-top: 20px;';
                
                // 각 언어별 영역 내용 생성 (큰 컨테이너 안의 서브 영역)
                destinationArea.innerHTML = `
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 15px;">
                        <div style="background: #dcfce7; padding: 12px 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0; font-size: 14px; font-weight: 600; color: #10b981;">🎯 ${lang} 번역</h4>
                            ${(isSingleFile || isSplitFile) 
                                ? `<button class="btn btn-warning" onclick="splitDestinationFile('${fileName}_${lang}', '${projectTitle}', '${lang}', ${langIndex})" 
                                          style="padding: 6px 12px; font-size: 12px;">
                                      <span>✂️</span>
                                      파일 분할
                                  </button>`
                                : ''
                            }
                        </div>
                        <table class="file-table" style="table-layout: fixed; width: 100%; margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 20%;">파일 이름</th>
                                    <th style="width: 10%;">출발어</th>
                                    <th style="width: 12%;">도착어</th>
                                    <th style="width: 10%;">작업 시간</th>
                                    <th style="width: 12%; text-align: center;">웍스파이 등록</th>
                                    <th style="width: 12%; text-align: center;">작업자(상태)</th>
                                    <th style="width: 12%; text-align: center;">작업자 배정</th>
                                    <th style="width: 12%; text-align: center;">전사툴</th>
                                    <th style="width: 8%; text-align: center;">산출물</th>
                                    <th style="width: 10%; text-align: center;">진행 상태</th>
                                </tr>
                            </thead>
                            <tbody id="destination-tbody-${langIndex}">
                                ${allFiles.map((file, fileIndex) => `
                                    <tr>
                                        <td class="file-name">${file}_${lang}</td>
                                        <td style="text-align: center;">한글</td>
                                        <td style="text-align: center;">${lang}</td>
                                        <td style="text-align: center;">00:45:30</td>
                                        <td style="text-align: center;">
                                            ${fileIndex === 0 
                                                ? `<button class="btn btn-success" onclick="openWorksbyRegistrationModal('${file}_${lang}', '${projectTitle}')" 
                                                          style="padding: 6px 12px; font-size: 12px; margin: 0 auto; display: inline-block;">
                                                      <span>🚀</span>
                                                      등록
                                                  </button>`
                                                : `<span style="color: #9ca3af;">-</span>`
                                            }
                                        </td>
                                        <td style="text-align: center; font-size: 12px; color: #6b7280;">
                                            - (대기)
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn" onclick="assignNewWorker('${file}_${lang}', '${projectTitle}')" 
                                                    style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                작업자 배정
                                            </button>
                                        </td>
                                        <td style="text-align: center;">
                                            <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;">
                                                <button class="btn" onclick="executeTranscription('${file}_${lang}')" 
                                                        style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                                    전사툴 실행
                                                </button>
                                                <button class="btn" onclick="executeReview('${file}_${lang}')" 
                                                        style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                                    검수툴 실행
                                                </button>
                                            </div>
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn" onclick="downloadOutput('${file}_${lang}')" 
                                                    style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                산출물 다운로드
                                            </button>
                                        </td>
                                        <td style="text-align: center;">
                                            <span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                                대기
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                languagesWrapper.appendChild(destinationArea);
            });
            
            console.log('도착어 영역이 생성되었습니다.');
            
            // 하단 영역을 최하단으로 이동
            ensureBottomSectionsAtEnd();
        }
        
        // 도착어 영역 파일 분할 함수
        function splitDestinationFile(fileName, projectTitle, language, langIndex) {
            console.log('도착어 영역 파일 분할:', fileName, projectTitle, language, langIndex);
            
            // 파일 분할 모달에 파일명과 파일 길이 설정
            const splitFileNameInput = document.getElementById('splitFileName');
            const splitFileLengthInput = document.getElementById('splitFileLength');
            
            if (splitFileNameInput) {
                splitFileNameInput.value = fileName.replace('[분할됨]', '').trim();
            }
            
            if (splitFileLengthInput) {
                splitFileLengthInput.value = '00:45:30'; // 기본값 또는 실제 파일 길이
            }
            
            // 분할 모달 열기
            const modal = document.getElementById('fileSplitModal');
            if (modal) {
                modal.style.display = 'flex';
                
                // 현재 프로젝트 ID 찾기
                const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
                const currentProjectId = visibleProjectArea ? visibleProjectArea.id.replace('worksby-detail-area-', '') : null;
                
                // 도착어 영역 분할임을 표시 (언어별 정보 포함)
                window.currentSplitContext = {
                    area: 'destination',
                    fileName: fileName,
                    projectTitle: projectTitle,
                    language: language,
                    langIndex: langIndex,
                    projectId: currentProjectId
                };
            }
        }
        
        // 도착어 영역 분할 업데이트 함수 (언어별 영역용)
        function updateDestinationAreaWithSplits(fileName, timeRanges, projectTitle) {
            console.log('도착어 영역 분할 업데이트:', fileName, timeRanges);
            
            const splitContext = window.currentSplitContext;
            if (!splitContext || !splitContext.language || splitContext.langIndex === undefined) {
                console.log('분할 컨텍스트 정보가 없습니다.');
                return;
            }
            
            const language = splitContext.language;
            const langIndex = splitContext.langIndex;
            const projectId = splitContext.projectId;
            
            if (!projectId) {
                console.log('프로젝트 ID를 찾을 수 없습니다.');
                return;
            }
            
            console.log(`도착어 영역 분할 - 프로젝트 ID: ${projectId}, 언어 인덱스: ${langIndex}`);
            
            const destinationTbody = document.getElementById(`destination-tbody-${projectId}-${langIndex}`);
            
            if (!destinationTbody) {
                console.log(`도착어 영역 ${language} 테이블을 찾을 수 없습니다.`);
                return;
            }
            
            // 기존 원본 파일 행 찾기
            const rows = destinationTbody.querySelectorAll('tr');
            let originalRow = null;
            
            rows.forEach(row => {
                const fileNameCell = row.querySelector('.file-name');
                if (fileNameCell && fileNameCell.textContent.trim() === fileName) {
                    originalRow = row;
                }
            });
            
            if (originalRow) {
                // 원본 파일에 분할 표시 추가
                const originalFileNameCell = originalRow.querySelector('.file-name');
                if (!originalFileNameCell.textContent.includes('[분할됨]')) {
                    originalFileNameCell.textContent += '[분할됨]';
                }
                
                // 원본 파일에 tree-parent 클래스 추가
                originalRow.classList.add('tree-parent');
                
                // 원본 파일 DOM으로 다시 생성 (웍스파이 프로젝트 생성 버튼 포함)
                originalRow.innerHTML = '';
                
                const projectNameCell = document.createElement('td');
                projectNameCell.style.textAlign = 'center';
                projectNameCell.textContent = ''; // 초기에는 비어있음, 웍스파이 프로젝트 생성 후 채워짐
                projectNameCell.id = `destination-project-${langIndex}-parent`;
                
                const fileNameCell = document.createElement('td');
                fileNameCell.className = 'file-name';
                fileNameCell.textContent = fileName + '[분할됨]';
                
                const sourceCell = document.createElement('td');
                sourceCell.style.textAlign = 'center';
                sourceCell.textContent = '한글';
                
                const targetCell = document.createElement('td');
                targetCell.style.textAlign = 'center';
                targetCell.textContent = language;
                
                const timeCell = document.createElement('td');
                timeCell.style.textAlign = 'center';
                timeCell.textContent = '00:45:30';
                
                const registerCell = document.createElement('td');
                registerCell.style.textAlign = 'center';
                registerCell.style.color = '#9ca3af';
                registerCell.textContent = '-';
                
                const workerCell = document.createElement('td');
                workerCell.style.textAlign = 'center';
                workerCell.style.color = '#9ca3af';
                workerCell.textContent = '-';
                
                const assignCell = document.createElement('td');
                assignCell.style.textAlign = 'center';
                assignCell.style.color = '#9ca3af';
                assignCell.textContent = '-';
                
                const toolsCell = document.createElement('td');
                toolsCell.style.textAlign = 'center';
                
                // 검수툴 실행(파일 합치기) 버튼만 추가
                const mergeBtn = document.createElement('button');
                mergeBtn.className = 'btn';
                mergeBtn.style.cssText = 'background: #f97316; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;';
                mergeBtn.innerHTML = '검수툴 실행(파일 합치기)';
                mergeBtn.onclick = () => mergeDestinationFiles(fileName, projectTitle, language, langIndex);
                
                toolsCell.appendChild(mergeBtn);
                
                const outputCell = document.createElement('td');
                outputCell.style.textAlign = 'center';
                outputCell.style.color = '#9ca3af';
                outputCell.textContent = '-';
                
                const statusCell = document.createElement('td');
                statusCell.style.textAlign = 'center';
                statusCell.style.color = '#9ca3af';
                statusCell.textContent = '-';
                
                // 모든 셀을 원본 행에 추가
                originalRow.appendChild(projectNameCell);
                originalRow.appendChild(fileNameCell);
                originalRow.appendChild(sourceCell);
                originalRow.appendChild(targetCell);
                originalRow.appendChild(timeCell);
                originalRow.appendChild(registerCell);
                originalRow.appendChild(workerCell);
                originalRow.appendChild(assignCell);
                originalRow.appendChild(toolsCell);
                originalRow.appendChild(outputCell);
                originalRow.appendChild(statusCell);
                
                // 분할된 파일들을 트리 구조로 추가
                timeRanges.forEach((range, index) => {
                    const splitRow = document.createElement('tr');
                    splitRow.className = 'tree-child';
                    
                    // 각 셀을 개별적으로 생성
                    const projectNameCell = document.createElement('td');
                    projectNameCell.style.textAlign = 'center';
                    projectNameCell.textContent = ''; // 초기에는 비어있음, 웍스파이 프로젝트 생성 후 채워짐
                    projectNameCell.id = `destination-project-${langIndex}-split-${index}`;
                    
                    const fileNameCell = document.createElement('td');
                    fileNameCell.className = 'file-name';
                    fileNameCell.textContent = range.name;
                    
                    const sourceCell = document.createElement('td');
                    sourceCell.style.textAlign = 'center';
                    sourceCell.textContent = '한글';
                    
                    const targetCell = document.createElement('td');
                    targetCell.style.textAlign = 'center';
                    targetCell.textContent = language;
                    
                    const timeCell = document.createElement('td');
                    timeCell.style.textAlign = 'center';
                    timeCell.textContent = `${range.start} ~ ${range.end}`;
                    
                    const registerCell = document.createElement('td');
                    registerCell.style.textAlign = 'center';
                    registerCell.id = `destination-register-split-${langIndex}-${index}`;
                    registerCell.innerHTML = '<span style="color: #9ca3af;">-</span>';
                    
                    const workerCell = document.createElement('td');
                    workerCell.style.textAlign = 'center';
                    workerCell.style.fontSize = '12px';
                    workerCell.style.color = '#6b7280';
                    workerCell.textContent = '- (대기)';
                    
                    const assignCell = document.createElement('td');
                    assignCell.style.textAlign = 'center';
                    assignCell.innerHTML = `<button class="btn" onclick="assignNewWorker('${range.name}', '${projectTitle}')" style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">작업자 변경</button>`;
                    
                    const toolsCell = document.createElement('td');
                    toolsCell.style.textAlign = 'center';
                    toolsCell.innerHTML = `<div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;"><button class="btn" onclick="executeTranscription('${range.name}')" style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">전사툴 실행</button><button class="btn" onclick="executeReview('${range.name}')" style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">검수툴 실행</button></div>`;
                    
                    const outputCell = document.createElement('td');
                    outputCell.style.textAlign = 'center';
                    outputCell.innerHTML = `<button class="btn" onclick="downloadOutput('${range.name}')" style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">산출물 다운로드</button>`;
                    
                    const statusCell = document.createElement('td');
                    statusCell.style.textAlign = 'center';
                    statusCell.innerHTML = '<span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">대기</span>';
                    
                    // 모든 셀을 행에 추가
                    splitRow.appendChild(projectNameCell);
                    splitRow.appendChild(fileNameCell);
                    splitRow.appendChild(sourceCell);
                    splitRow.appendChild(targetCell);
                    splitRow.appendChild(timeCell);
                    splitRow.appendChild(registerCell);
                    splitRow.appendChild(workerCell);
                    splitRow.appendChild(assignCell);
                    splitRow.appendChild(toolsCell);
                    splitRow.appendChild(outputCell);
                    splitRow.appendChild(statusCell);
                    
                    // 원본 파일 다음에 삽입
                    destinationTbody.insertBefore(splitRow, originalRow.nextSibling);
                });
            }
        }
        
        // 도착어 영역 진행상태 업데이트 함수
        function updateDestinationAreaProgressStatus(fileName, language, langIndex, status) {
            const destinationTbody = document.getElementById(`destination-tbody-${langIndex}`);
            if (!destinationTbody) return;
            
            const rows = destinationTbody.querySelectorAll('tr');
            rows.forEach(row => {
                // 프로젝트명 컬럼이 추가되어 파일명은 두 번째 셀
                const fileNameCell = row.querySelector('td:nth-child(2)') || row.querySelector('.file-name');
                if (fileNameCell) {
                    const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                    if (currentFileName === fileName) {
                        // 진행상태 컬럼 찾기 (마지막 컬럼)
                        const progressCell = row.querySelector('td:last-child');
                        if (progressCell) {
                            // 배지 스타일로 업데이트
                            const badgeColor = status === '검수완료' ? '#10b981' : '#6b7280';
                            progressCell.innerHTML = `<span style="background: ${badgeColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">${status}</span>`;
                        }
                    }
                }
            });
        }
        
        // 도착어 영역 파일 합치기 함수
        function mergeDestinationFiles(fileName, projectTitle, language, langIndex) {
            if (confirm(`${fileName} 파일의 도착어 영역(${language}) 분할된 구간들을 합치는 검수툴을 실행하시겠습니까?`)) {
                // 도착어 영역의 진행상태를 "검수완료"로 변경
                updateDestinationAreaProgressStatus(fileName, language, langIndex, '검수완료');
                
                alert(`${fileName} 파일의 검수툴이 실행되었습니다.\n도착어 영역(${language}) 진행상태가 "검수완료"로 변경되었습니다.\n\n${language} 번역 작업이 완료되었습니다!`);
            }
        }
        
        // 웍스파이 프로젝트 등록
        function registerToWorkspy() {
            console.log('registerToWorkspy 함수 호출됨');
            
            const targetRows = document.querySelectorAll('#target-file-list tr:not(#empty-state)');
            console.log('등록할 대상 파일들:', targetRows);
            console.log('대상 파일 개수:', targetRows.length);
            
            if (targetRows.length === 0) {
                alert('등록할 파일이 없습니다. 먼저 파일을 등록 대상으로 이동해주세요.');
                return;
            }
            
            // 등록 전에 파일 데이터를 미리 저장
            const filesToRegister = [];
            targetRows.forEach(row => {
                const projectTitle = row.querySelector('td:nth-child(2)').textContent;
                const fileName = row.querySelector('td:nth-child(3)').textContent;
                const sourceLanguage = row.querySelector('td:nth-child(4)').textContent;
                const targetLanguage = row.querySelector('td:nth-child(5)').textContent;
                const duration = row.querySelector('td:nth-child(6)').textContent;
                
                filesToRegister.push({
                    projectTitle,
                    fileName,
                    sourceLanguage,
                    targetLanguage,
                    duration,
                    isTreeChild: row.classList.contains('tree-child'),
                    isTreeParent: row.classList.contains('tree-parent')
                });
            });
            
            console.log('저장된 파일 데이터:', filesToRegister);
            
            let fileList = '';
            filesToRegister.forEach(file => {
                fileList += `• [${file.projectTitle}] ${file.fileName} (${file.duration})\n`;
            });
            
            const confirmMessage = `선택된 파일들의 세팅을 완료하시겠습니까?\n\n${fileList}\n파일 세팅이 완료됩니다.`;
            
            if (confirm(confirmMessage)) {
                alert(`✅ 파일 세팅 완료!\n\n${filesToRegister.length}개 파일의 세팅이 완료되었습니다.`);
                
                // 모달 닫기
                closeWorksbyModal();
            }
        }
        
        // 등록된 파일들 표시 함수 (더 이상 사용하지 않음)
        function showRegisteredFiles() {
            console.log('showRegisteredFiles 함수 호출됨 - 파일 세팅 완료 파일 영역 제거로 인해 사용하지 않음');
            // 파일 세팅 완료 파일 영역이 제거되어 이 함수는 더 이상 사용하지 않음
        }
        
        // 저장된 데이터로 등록된 파일들 표시 (더 이상 사용하지 않음)
        function showRegisteredFilesWithData(filesToRegister) {
            console.log('showRegisteredFilesWithData 함수 호출됨 - 파일 세팅 완료 파일 영역 제거로 인해 사용하지 않음');
            // 파일 세팅 완료 파일 영역이 제거되어 이 함수는 더 이상 사용하지 않음
            
        }
        
        // 웍스파이 등록 모달 열기
        function openWorksbyRegistrationModal(fileName, projectTitle) {
            console.log('웍스파이 등록 모달 열기:', fileName, projectTitle);
            
            // 기존 selectedFileInfo가 있으면 보존하고 없으면 새로 생성
            if (!window.selectedFileInfo) {
            window.selectedFileInfo = {
                fileName: fileName,
                projectTitle: projectTitle
            };
            } else {
                // 기존 정보 보존하면서 파일명과 프로젝트명만 업데이트
                window.selectedFileInfo.fileName = fileName;
                window.selectedFileInfo.projectTitle = projectTitle;
            }
            
            // 현재 날짜 기준으로 기본값 설정
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const nextWeek = new Date(now);
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            // 날짜 포맷팅 (YYYY-MM-DDTHH:MM)
            const formatDateTime = (date) => {
                return date.getFullYear() + '-' + 
                       String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                       String(date.getDate()).padStart(2, '0') + 'T' + 
                       String(date.getHours()).padStart(2, '0') + ':' + 
                       String(date.getMinutes()).padStart(2, '0');
            };
            
            const formatDate = (date) => {
                return date.getFullYear() + '-' + 
                       String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                       String(date.getDate()).padStart(2, '0');
            };
            
            // 기본값 설정
            document.getElementById('recruitStartDate').value = formatDateTime(now);
            document.getElementById('recruitEndDate').value = formatDateTime(tomorrow);
            document.getElementById('workStartDate').value = formatDate(tomorrow);
            document.getElementById('workEndDate').value = formatDate(nextWeek);
            
            // 프로젝트명에 기본값 설정 (분류명 사용)
            document.getElementById('worksbyProjectName').value = projectTitle || '';
            
            // 다중 파일 정보 표시
            const fileCount = window.selectedFileInfo?.selectedFiles?.length || 1;
            const isMultiProject = window.selectedFileInfo?.isMultiProject || false;
            
            // 선택된 파일 목록 표시 (다중 파일일 때만)
            const selectedFilesInfo = document.getElementById('selectedFilesInfo');
            const selectedFilesList = document.getElementById('selectedFilesList');
            const projectNameHint = document.getElementById('projectNameHint');
            
            if (isMultiProject && window.selectedFileInfo?.selectedFiles) {
                // 다중 파일 정보 표시
                selectedFilesInfo.style.display = 'block';
                projectNameHint.style.display = 'block';
                
                const filesListHTML = window.selectedFileInfo.selectedFiles.map((file, index) => 
                    `<div style="padding: 6px 0; border-bottom: ${index < window.selectedFileInfo.selectedFiles.length - 1 ? '1px solid #e5e7eb' : 'none'};">
                        <span style="font-weight: 500; color: #3b82f6;">📁 ${file.fileName}</span>
                        <span style="margin-left: 10px; font-size: 11px; color: #6b7280;">→ 프로젝트 ${index + 1}</span>
                    </div>`
                ).join('');
                
                selectedFilesList.innerHTML = filesListHTML;
            } else {
                // 단일 파일인 경우 숨김
                selectedFilesInfo.style.display = 'none';
                projectNameHint.style.display = 'none';
            }
            
            // Footer 정보 업데이트
            const selectedFileSpan = document.getElementById('worksby-selected-file-name');
            const targetCountSpan = document.getElementById('worksby-target-count');
            
            if (selectedFileSpan) selectedFileSpan.textContent = fileCount;
            if (targetCountSpan) {
                if (isMultiProject) {
                    targetCountSpan.textContent = fileCount; // 다중 파일일 때는 각각 별도 프로젝트
                } else {
                    targetCountSpan.textContent = '1'; // 단일 파일일 때는 1개 프로젝트
                }
            }
            
            document.getElementById('worksbyRegistrationModal').style.display = 'flex';
            console.log('웍스파이 등록 모달이 열렸습니다.');
        }
        
        // 웍스파이 등록 모달 닫기
        function closeWorksbyRegistrationModal() {
            console.log('웍스파이 등록 모달 닫기 시작...');
            const modal = document.getElementById('worksbyRegistrationModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('웍스파이 등록 모달이 닫혔습니다.');
                
                // 폼 초기화
                const projectNameInput = document.getElementById('worksbyProjectName');
                if (projectNameInput) {
                    projectNameInput.value = '';
                }
                
                const projectDescInput = document.getElementById('projectDescription');
                if (projectDescInput) {
                    projectDescInput.value = '';
                }
                
                // 다중 파일 정보 숨김
                const selectedFilesInfo = document.getElementById('selectedFilesInfo');
                const projectNameHint = document.getElementById('projectNameHint');
                if (selectedFilesInfo) selectedFilesInfo.style.display = 'none';
                if (projectNameHint) projectNameHint.style.display = 'none';
            } else {
                console.log('웍스파이 등록 모달을 찾을 수 없습니다.');
            }
        }
        
        // 긴급 토글
        function toggleUrgent() {
            const toggle = document.getElementById('urgentToggle');
            const span = toggle.nextElementSibling;
            
            if (toggle.checked) {
                span.style.background = '#ef4444';
                span.textContent = '긴급';
            } else {
                span.style.background = '#3b82f6';
                span.textContent = '신청버튼';
            }
        }
        
        // 썸네일 선택
        function selectThumbnail() {
            alert('썸네일 파일 선택 기능입니다.');
        }
        
        // 첨부파일 선택
        function selectAttachment() {
            alert('첨부파일 선택 기능입니다.');
        }
        
        // 전체 선택 체크박스 클릭 처리
        function handleSelectAllClick(event, selectAllCheckbox) {
            // 이벤트 전파 중단 (필요한 경우)
            event.stopPropagation();
            
            // 전체 파일 선택/해제
            toggleAllFiles(selectAllCheckbox);
        }
        
        // 전체 파일 선택/해제
        function toggleAllFiles(selectAllCheckbox) {
            const checkboxes = document.querySelectorAll('.file-select-checkbox:not(:disabled)');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            console.log('전체 선택 처리 완료:', selectAllCheckbox.checked);
        }
        
        // 파일 행 선택 (배경색 변경 + 출발어 영역 표시, 체크박스는 토글하지 않음)
        function selectFileRow(row) {
            console.log('파일 행 선택됨:', row);
            
            // 모든 파일 행의 선택 상태 초기화
            const allFileRows = document.querySelectorAll('.file-table tbody tr[data-file-id]');
            allFileRows.forEach(fileRow => {
                fileRow.classList.remove('selected-file-row');
            });
            
            // 선택된 행 하이라이트 (CSS 클래스 사용)
            row.classList.add('selected-file-row');
            
            // 원본 파일(tree-parent)인 경우 분할된 파일들도 함께 하이라이트
            if (row.classList.contains('tree-parent')) {
                let nextRow = row.nextElementSibling;
                while (nextRow && nextRow.classList.contains('tree-child')) {
                    nextRow.classList.add('selected-file-row');
                    nextRow = nextRow.nextElementSibling;
                }
                console.log('원본 파일과 분할된 파일들 모두 선택됨');
            }
            
            // 분할된 파일(tree-child)인 경우 원본 파일과 모든 분할 파일들 하이라이트
            if (row.classList.contains('tree-child')) {
                // 원본 파일 찾기
                let parentRow = row.previousElementSibling;
                while (parentRow && !parentRow.classList.contains('tree-parent')) {
                    parentRow = parentRow.previousElementSibling;
                }
                
                if (parentRow && parentRow.classList.contains('tree-parent')) {
                    // 원본 파일 하이라이트
                    parentRow.classList.add('selected-file-row');
                    
                    // 모든 분할된 파일들 하이라이트
                    let nextRow = parentRow.nextElementSibling;
                    while (nextRow && nextRow.classList.contains('tree-child')) {
                        nextRow.classList.add('selected-file-row');
                        nextRow = nextRow.nextElementSibling;
                    }
                    console.log('분할된 파일 선택으로 원본 파일과 모든 분할 파일들 선택됨');
                }
            }
            
            // 선택된 파일 정보 가져오기
            const fileId = row.getAttribute('data-file-id');
            const fileName = row.querySelector('.file-name').textContent;
            
            console.log('선택된 파일:', fileId, fileName);
            
            // 해당 파일의 프로젝트가 있는지 확인하고 출발어 영역 표시
            showSourceAreaForFile(fileId, fileName);
        }
        
        // 특정 파일의 출발어 영역 표시
        function showSourceAreaForFile(fileId, fileName) {
            console.log('파일의 출발어 영역 표시:', fileId, fileName);
            
            // 분할된 파일인 경우 원본 파일명으로 프로젝트 찾기
            let searchFileName = fileName;
            if (fileName.includes('_구간')) {
                // 분할된 파일명에서 원본 파일명 추출 (예: "파일명_구간1.mp4" → "파일명.mp4")
                const parts = fileName.split('_구간');
                if (parts.length > 1) {
                    searchFileName = parts[0] + '.' + fileName.split('.').pop();
                }
            }
            
            console.log('프로젝트 검색용 파일명:', searchFileName);
            
            // 해당 파일로 생성된 프로젝트 찾기
            let targetProjectId = null;
            if (window.allProjectsData) {
                for (const [projectId, projectData] of Object.entries(window.allProjectsData)) {
                    // 원본 파일 ID로 검색 (분할된 파일들은 같은 fileId를 가짐)
                    if (projectData.selectedFiles && projectData.selectedFiles.includes(fileId)) {
                        targetProjectId = projectId;
                        break;
                    }
                    
                    // 파일명으로도 검색 (폴백)
                    if (projectData.fileName && (projectData.fileName === searchFileName || projectData.fileName.includes(searchFileName.replace(/\.[^/.]+$/, "")))) {
                        targetProjectId = projectId;
                        break;
                    }
                }
            }
            
            console.log('찾은 프로젝트 ID:', targetProjectId);
            
            if (targetProjectId) {
                // 모든 출발어 영역 숨기기
                const allProjectAreas = document.querySelectorAll('[id^="worksby-detail-area-"]');
                allProjectAreas.forEach(area => {
                    area.style.display = 'none';
                });
                
                // 해당 파일의 출발어 영역만 표시
                const targetArea = document.getElementById(`worksby-detail-area-${targetProjectId}`);
                if (targetArea) {
                    targetArea.style.display = 'block';
                    
                    // 출발어 영역으로 스크롤
                    setTimeout(() => {
                        targetArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                    
                    console.log(`파일 ${fileName}의 출발어 영역을 표시했습니다.`);
                } else {
                    console.log(`파일 ${fileName}의 출발어 영역을 찾을 수 없습니다.`);
                }
            } else {
                // 해당 파일로 생성된 프로젝트가 없으면 모든 출발어 영역 숨기기
                const allProjectAreas = document.querySelectorAll('[id^="worksby-detail-area-"]');
                allProjectAreas.forEach(area => {
                    area.style.display = 'none';
                });
                console.log(`파일 ${fileName}로 생성된 프로젝트가 없습니다.`);
            }
        }
        
        // 체크박스 직접 클릭 처리 (행 선택 없이 체크만)
        function handleCheckboxClick(event, checkbox) {
            // 행 클릭 이벤트 전파 중단
            event.stopPropagation();
            
            // 체크박스 상태는 자동으로 변경되므로 추가 처리만 수행
            const row = checkbox.closest('tr');
            
            // 원본 파일이면서 분할된 파일이 있는 경우, 분할된 파일들도 함께 체크
            if (row.classList.contains('tree-parent')) {
                toggleSplitFilesCheckbox(row, checkbox.checked);
            }
            
            // 전체 선택 체크박스 상태 업데이트
            updateSelectAllCheckbox();
            
            console.log('체크박스 직접 클릭 처리 완료:', checkbox.value, checkbox.checked);
        }
        
        
        // 분할된 파일들의 체크박스 상태 연동
        function toggleSplitFilesCheckbox(parentRow, isChecked) {
            let nextRow = parentRow.nextElementSibling;
            
            while (nextRow && nextRow.classList.contains('tree-child')) {
                const splitCheckbox = nextRow.querySelector('.split-file-checkbox');
                if (splitCheckbox) {
                    splitCheckbox.checked = isChecked;
                }
                nextRow = nextRow.nextElementSibling;
            }
        }
        
        // 전체 선택 체크박스 상태 업데이트
        function updateSelectAllCheckbox() {
            const allCheckboxes = document.querySelectorAll('.file-select-checkbox:not(:disabled)');
            const checkedCheckboxes = document.querySelectorAll('.file-select-checkbox:not(:disabled):checked');
            const selectAllCheckbox = document.getElementById('selectAllFiles');
            
            if (selectAllCheckbox) {
                if (checkedCheckboxes.length === 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                } else if (checkedCheckboxes.length === allCheckboxes.length) {
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                } else {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = true;
                }
            }
        }
        
        // 선택 프롬프트 변경
        function changeSelectedPrompt() {
            const selectedValue = document.getElementById('defaultPromptSelect').value;
            
            // 1순위: 배경색으로 선택된 파일 찾기
            const selectedRow = document.querySelector('.file-table tbody tr.selected-file-row');
            
            if (selectedRow) {
                // 배경색으로 선택된 파일이 있는 경우
                const fileName = selectedRow.querySelector('.file-name').textContent;
                
                if (confirm(`선택된 파일의 프롬프트를 "${selectedValue}"로 변경하시겠습니까?\n\n파일: ${fileName}`)) {
                    // 프롬프트 변경 로직 - 배지 스타일 적용
                    const promptCell = selectedRow.querySelector('td:nth-child(6)'); // 프롬프트 컬럼
                    if (promptCell) {
                        // 배지 색상 설정
                        let badgeColor = '#e5e7eb';
                        let textColor = '#374151';
                        
                        switch(selectedValue) {
                            case '옵션1':
                                badgeColor = '#dbeafe';
                                textColor = '#1d4ed8';
                                break;
                            case '옵션2':
                                badgeColor = '#dcfce7';
                                textColor = '#166534';
                                break;
                            case '옵션3':
                                badgeColor = '#fef3c7';
                                textColor = '#92400e';
                                break;
                            case '옵션4':
                                badgeColor = '#fce7f3';
                                textColor = '#be185d';
                                break;
                            case '옵션5':
                                badgeColor = '#e0e7ff';
                                textColor = '#5b21b6';
                                break;
                            default: // 기본
                                badgeColor = '#e5e7eb';
                                textColor = '#374151';
                        }
                        
                        promptCell.innerHTML = `<span class="prompt-badge" style="background: ${badgeColor}; color: ${textColor}; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">${selectedValue}</span>`;
                    }
                    
                    alert(`파일의 프롬프트가 "${selectedValue}"로 변경되었습니다.\n\n파일: ${fileName}`);
                }
                return;
            }
            
            // 2순위: 체크된 파일들 찾기 (배경색 선택이 없는 경우)
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:checked');
            const selectedFiles = [];
            
            checkedBoxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const fileName = row.querySelector('.file-name').textContent;
                selectedFiles.push(fileName);
            });
            
            if (selectedFiles.length === 0) {
                alert('변경할 파일을 선택해주세요.\n(파일 행을 클릭하거나 체크박스를 체크해주세요)');
                return;
            }
            
            if (confirm(`선택된 ${selectedFiles.length}개 파일의 프롬프트를 "${selectedValue}"로 변경하시겠습니까?`)) {
                // 프롬프트 변경 로직 - 배지 스타일 적용
                checkedBoxes.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const promptCell = row.querySelector('td:nth-child(6)'); // 프롬프트 컬럼 (체크박스 추가로 인덱스 변경)
                    if (promptCell) {
                        // 배지 색상 설정
                        let badgeColor = '#e5e7eb';
                        let textColor = '#374151';
                        
                        switch(selectedValue) {
                            case '옵션1':
                                badgeColor = '#dbeafe';
                                textColor = '#1d4ed8';
                                break;
                            case '옵션2':
                                badgeColor = '#dcfce7';
                                textColor = '#166534';
                                break;
                            case '옵션3':
                                badgeColor = '#fef3c7';
                                textColor = '#92400e';
                                break;
                            case '옵션4':
                                badgeColor = '#fce7f3';
                                textColor = '#be185d';
                                break;
                            case '옵션5':
                                badgeColor = '#e0e7ff';
                                textColor = '#5b21b6';
                                break;
                            default: // 기본
                                badgeColor = '#e5e7eb';
                                textColor = '#374151';
                        }
                        
                        promptCell.innerHTML = `<span class="prompt-badge" style="background: ${badgeColor}; color: ${textColor}; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">${selectedValue}</span>`;
                    }
                });
                
                alert(`${selectedFiles.length}개 파일의 프롬프트가 "${selectedValue}"로 변경되었습니다.`);
                
                // 체크박스 해제
                checkedBoxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                document.getElementById('selectAllFiles').checked = false;
            }
        }
        
        // 의뢰파일 추가
        function addRequestFile() {
            document.getElementById('fileAddModal').style.display = 'flex';
            
            // 폼 초기화
            document.getElementById('fileAddForm').reset();
            removeNewFile();
        }
        
        // 선택된 파일들 분할 (파일 리스트에서)
        function splitSelectedFiles() {
            // 1순위: 배경색으로 선택된 파일 찾기
            const selectedRow = document.querySelector('.file-table tbody tr.selected-file-row');
            
            if (selectedRow) {
                // 배경색으로 선택된 파일이 있는 경우
                const fileName = selectedRow.querySelector('.file-name').textContent;
                const fileLength = selectedRow.querySelector('td:nth-child(5)').textContent;
                
                document.getElementById('splitFileName').value = fileName;
                document.getElementById('splitFileLength').value = fileLength;
                document.getElementById('fileSplitModal').style.display = 'flex';
                
                // 분할 컨텍스트 설정
                window.currentSplitContext = {
                    area: 'main',
                    fileName: fileName
                };
                
                console.log('배경색 선택된 파일로 분할 모달 열기:', fileName);
                return;
            }
            
            // 2순위: 체크된 파일들 찾기 (배경색 선택이 없는 경우)
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:checked');
            const selectedFiles = [];
            
            checkedBoxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const fileName = row.querySelector('.file-name').textContent;
                selectedFiles.push(fileName);
            });
            
            if (selectedFiles.length === 0) {
                alert('분할할 파일을 선택해주세요.\n(파일 행을 클릭하거나 체크박스를 체크해주세요)');
                return;
            }
            
            if (selectedFiles.length > 1) {
                alert('파일 분할은 한 번에 하나의 파일만 가능합니다.\n하나의 파일만 선택해주세요.');
                return;
            }
            
            // 첫 번째 선택된 파일로 분할 모달 열기
            const selectedFileName = selectedFiles[0];
            const selectedFileRow = checkedBoxes[0].closest('tr');
            const fileLength = selectedFileRow.querySelector('td:nth-child(5)').textContent; // 파일 길이
            
            document.getElementById('splitFileName').value = selectedFileName;
            document.getElementById('splitFileLength').value = fileLength;
            document.getElementById('fileSplitModal').style.display = 'flex';
            
            // 분할 컨텍스트 설정
            window.currentSplitContext = {
                area: 'main',
                fileName: selectedFileName
            };
        }
        
        // 웍스파이 프로젝트 생성 (선택된 파일 기준)
        function createWorksbyProject() {
            // 1순위: 배경색으로 선택된 파일 찾기
            const selectedRow = document.querySelector('.file-table tbody tr.selected-file-row');
            
            if (selectedRow) {
                // 배경색으로 선택된 파일이 있는 경우 (단일 파일 프로젝트)
                const fileName = selectedRow.querySelector('.file-name').textContent;
                const fileId = selectedRow.getAttribute('data-file-id');
                
                const selectedFile = {
                    fileName: fileName,
                    row: selectedRow,
                    fileId: fileId
                };
                
                // 선택된 파일 정보를 전역 변수에 저장
                window.selectedFileInfo = {
                    fileName: selectedFile.fileName,
                    projectTitle: '웍스파이 프로젝트',
                    selectedFiles: [selectedFile],
                    selectedFileIds: [selectedFile.fileId],
                    isMultiProject: false
                };
                
                console.log('배경색 선택된 파일로 단일 프로젝트 생성:', window.selectedFileInfo);
                
                // 웍스파이 등록 모달 열기
                openWorksbyRegistrationModal(selectedFile.fileName, '웍스파이 프로젝트');
                return;
            }
            
            // 2순위: 체크된 파일들 찾기 (배경색 선택이 없는 경우)
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:not(:disabled):checked');
            
            if (checkedBoxes.length === 0) {
                alert('웍스파이 프로젝트로 생성할 파일을 선택해주세요.\n(파일 행을 클릭하거나 체크박스를 체크해주세요)');
                return;
            }
            
            // 체크된 파일 정보 수집
            const selectedFiles = [];
            const selectedFileIds = [];
            
            checkedBoxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const fileName = row.querySelector('.file-name').textContent;
                const fileId = checkbox.value;
                
                selectedFiles.push({
                    fileName: fileName,
                    row: row,
                    fileId: fileId
                });
                selectedFileIds.push(fileId);
            });
            
            if (checkedBoxes.length === 1) {
                // 단일 파일 프로젝트
                window.selectedFileInfo = {
                    fileName: selectedFiles[0].fileName,
                    projectTitle: '웍스파이 프로젝트',
                    selectedFiles: selectedFiles,
                    selectedFileIds: selectedFileIds,
                    isMultiProject: false
                };
                
                console.log('체크된 단일 파일로 프로젝트 생성:', window.selectedFileInfo);
                openWorksbyRegistrationModal(selectedFiles[0].fileName, '웍스파이 프로젝트');
            } else {
                // 다중 파일 프로젝트 (각각 별도 프로젝트로 생성)
                window.selectedFileInfo = {
                    fileName: `${selectedFiles.length}개 파일`,
                    projectTitle: '웍스파이 프로젝트',
                    selectedFiles: selectedFiles,
                    selectedFileIds: selectedFileIds,
                    isMultiProject: true
                };
                
                console.log('체크된 다중 파일로 각각 프로젝트 생성:', window.selectedFileInfo);
                openWorksbyRegistrationModal(`${selectedFiles.length}개 파일`, '웍스파이 프로젝트');
            }
        }
        
        // 선택파일 다운로드
        function downloadSelectedFiles() {
            // 1순위: 배경색으로 선택된 파일 찾기
            const selectedRow = document.querySelector('.file-table tbody tr.selected-file-row');
            
            if (selectedRow) {
                // 배경색으로 선택된 파일이 있는 경우
                const fileName = selectedRow.querySelector('.file-name').textContent;
                
                alert(`선택된 파일을 다운로드합니다.\n\n파일: ${fileName}`);
                console.log('배경색 선택된 파일 다운로드:', fileName);
                return;
            }
            
            // 2순위: 체크된 파일들 찾기 (배경색 선택이 없는 경우)
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:checked');
            const selectedFiles = [];
            
            checkedBoxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const fileName = row.querySelector('.file-name').textContent;
                selectedFiles.push(fileName);
            });
            
            if (selectedFiles.length === 0) {
                alert('다운로드할 파일을 선택해주세요.\n(파일 행을 클릭하거나 체크박스를 체크해주세요)');
                return;
            }
            
            alert(`선택된 ${selectedFiles.length}개 파일을 다운로드합니다.\n\n파일 목록:\n${selectedFiles.join('\n')}`);
            // 추후 구현 예정: 실제 다운로드 기능
        }
        
        // 웍스파이 등록 처리 (새로운 함수)
        function handleWorksbyRegister() {
            console.log('handleWorksbyRegister 함수 호출됨');
            saveWorksbyProject();
        }
        
        // 웍스파이 프로젝트 저장
        function saveWorksbyProject() {
            console.log('=== saveWorksbyProject 함수 호출됨 ===');
            
            // 프로젝트명 입력 요소 확인
            const projectNameElement = document.getElementById('worksbyProjectName');
            const projectName = projectNameElement ? projectNameElement.value.trim() : '';
            
            // 선택된 파일 정보 사용
            const selectedFile = window.selectedFileInfo;
            console.log('선택된 파일 정보:', selectedFile);
            
            if (!selectedFile) {
                alert('등록할 파일 정보가 없습니다.');
                return;
            }
            
            // 중간어 영역에서 호출된 경우 새 프로젝트 생성하지 않고 기존 프로젝트 업데이트만 함
            if (selectedFile.fromIntermediateArea) {
                console.log('중간어 영역에서 웍스파이 프로젝트 생성 - 기존 프로젝트 업데이트만 수행');
                
                // 프로젝트명이 없으면 기본값 사용
                const finalProjectName = projectName || selectedFile.projectTitle || '기본 프로젝트';
                
                // 중간어 영역 웍스파이 버튼 업데이트
                updateIntermediateWorksbyButtons(finalProjectName);
                
                // 모달 닫기
                closeWorksbyRegistrationModal();
                
                alert(`웍스파이 프로젝트 "${finalProjectName}"이 중간어 영역에 등록되었습니다.`);
                return;
            }
            
            // 도착어 영역에서 호출된 경우 새 프로젝트 생성하지 않고 기존 프로젝트 업데이트만 함
            if (selectedFile.fromDestinationArea) {
                console.log('도착어 영역에서 웍스파이 프로젝트 생성 - 기존 프로젝트 업데이트만 수행');
                
                // 프로젝트명이 없으면 기본값 사용
                const finalProjectName = projectName || selectedFile.projectTitle || '기본 프로젝트';
                
                // 도착어 영역 웍스파이 버튼 업데이트
                updateDestinationWorksbyButtons(finalProjectName, selectedFile.language, selectedFile.langIndex);
                
                // 모달 닫기
                closeWorksbyRegistrationModal();
                
                alert(`웍스파이 프로젝트 "${finalProjectName}"이 도착어 영역에 등록되었습니다.`);
                return;
            }
            
            // 프로젝트명이 없으면 기본값 사용
            const finalProjectName = projectName || selectedFile.projectTitle || '기본 프로젝트';
            
            // 다중 프로젝트 생성 여부 확인
            if (selectedFile.isMultiProject) {
                // 다중 파일 각각 별도 프로젝트 생성
                createMultipleProjects(finalProjectName, selectedFile.selectedFiles);
                return;
            }
            
            // 단일 프로젝트 생성
            createSingleProject(finalProjectName, selectedFile);
        }
        
        // 다중 파일을 각각 별도 프로젝트로 생성
        function createMultipleProjects(baseProjectName, selectedFiles) {
            console.log('다중 프로젝트 생성 시작:', baseProjectName, selectedFiles);
            
            // 모달 먼저 닫기
            document.getElementById('worksbyRegistrationModal').style.display = 'none';
            
            // 확인 대화상자
            const fileList = selectedFiles.map(file => `• ${file.fileName}`).join('\n');
            const confirmMessage = `${selectedFiles.length}개 파일을 각각 별도의 웍스파이 프로젝트로 생성하시겠습니까?\n\n${fileList}`;
            
            setTimeout(() => {
                if (confirm(confirmMessage)) {
                    let createdProjects = [];
                    
                    // 각 파일마다 별도 프로젝트 생성
                    selectedFiles.forEach((file, index) => {
                        const projectData = createProjectData(
                            `${baseProjectName}_${index + 1}`,
                            file,
                            [file],
                            [file.fileId]
                        );
                        
                        // 프로젝트 데이터 저장
                        if (!window.allProjectsData) {
                            window.allProjectsData = {};
                        }
                        window.allProjectsData[projectData.projectNo] = projectData;
                        
                        // 출발어 영역 생성
                        createDirectSourceArea(projectData);
                        
                        createdProjects.push(projectData.title);
                        
                        console.log(`프로젝트 ${index + 1} 생성 완료:`, projectData.title);
                    });
                    
                    // 웍스파이 상태 업데이트
                    updateWorksbyStatusToRegistered();
                    
                    alert(`🎉 ${selectedFiles.length}개의 웍스파이 프로젝트가 생성되었습니다!\n\n${createdProjects.join('\n')}`);
                    
                    // 선택된 파일 정보 초기화
                    window.selectedFileInfo = null;
                } else {
                    // 취소한 경우 모달을 다시 열어줌
                    document.getElementById('worksbyRegistrationModal').style.display = 'flex';
                }
            }, 100);
        }
        
        // 프로젝트 데이터 생성 공통 함수
        function createProjectData(projectTitle, selectedFile, selectedFiles, selectedFileIds) {
            // 시나리오 구분 (저장된 정보 기준) - 시나리오 1,2만 사용
            let scenarioType;
            const hasSplitFiles = selectedFiles.some(file => 
                file.row && file.row.classList.contains('tree-parent')
            );
            
            if (hasSplitFiles) {
                scenarioType = 1; // 시나리오 1: 분할된 파일
            } else {
                scenarioType = 2; // 시나리오 2: 단일 파일
            }
            
            return {
                projectNo: 'PJ' + new Date().toISOString().slice(0, 10).replace(/-/g, '') + Math.floor(Math.random() * 1000).toString().padStart(3, '0'),
                title: projectTitle,
                service: '소리바로',
                fileName: selectedFile.fileName,
                projectTitle: selectedFile.projectTitle,
                scenarioType: scenarioType,
                selectedFiles: selectedFileIds,
                selectedFilesData: selectedFiles,
                startDate: document.getElementById('recruitStartDate')?.value || '',
                endDate: document.getElementById('recruitEndDate')?.value || '',
                workStartDate: document.getElementById('workStartDate')?.value || '',
                workEndDate: document.getElementById('workEndDate')?.value || '',
                workerCount: document.querySelector('#worksbyRegistrationModal input[type="number"]')?.value || '5',
                budget: document.querySelector('#worksbyRegistrationModal input[type="number"]:nth-of-type(2)')?.value || '500000',
                qualification: document.querySelector('#worksbyRegistrationModal select')?.value || 'anyone',
                description: document.getElementById('projectDescription')?.value || '',
                regDate: new Date().toISOString().slice(0, 16).replace('T', ' ')
            };
        }
        
        // 단일 프로젝트 생성
        function createSingleProject(finalProjectName, selectedFile) {
            // 프로젝트 데이터 미리 생성 (저장된 선택 정보 사용)
            let projectData;
            try {
                projectData = createProjectData(
                    finalProjectName,
                    selectedFile,
                    selectedFile.selectedFiles,
                    selectedFile.selectedFileIds
                );
                
                console.log('단일 프로젝트 데이터 생성 성공:', projectData);
            } catch (error) {
                console.error('프로젝트 데이터 생성 중 오류:', error);
                alert('프로젝트 데이터 생성 중 오류가 발생했습니다: ' + error.message);
                return;
            }
            
            console.log('모달 닫기 시작...');
            
            // 먼저 모달 닫기
            document.getElementById('worksbyRegistrationModal').style.display = 'none';
            
            // 모달이 완전히 닫힌 후 확인 대화상자 표시
            setTimeout(() => {
                console.log('확인 대화상자 표시 중...');
                if (confirm(`"${finalProjectName}" 프로젝트로 "${selectedFile.fileName}" 파일을 웍스파이에 등록하시겠습니까?`)) {
                    console.log('사용자가 확인을 클릭했습니다.');
                    
                    console.log('생성된 프로젝트 데이터:', projectData);
                    
                    // 전역 변수에 저장
                    window.currentProjectData = projectData;
                    
                    // 프로젝트별 데이터 저장소에 저장
                    if (!window.allProjectsData) {
                        window.allProjectsData = {};
                    }
                    window.allProjectsData[projectData.projectNo] = projectData;
                    
                    console.log('출발어 영역 직접 생성 시작...');
                    // 웍스파이 프로젝트 영역을 건너뛰고 바로 출발어 영역 생성
                    createDirectSourceArea(projectData);
                    
                    // 영역별 버튼 업데이트 처리
                    if (selectedFile.fromIntermediateArea === true) {
                        // 중간어 영역에서 호출된 경우
                        updateIntermediateWorksbyButtons(selectedFile.projectTitle);
                    } else if (selectedFile.fromDestinationArea === true) {
                        // 도착어 영역에서 호출된 경우
                        updateDestinationWorksbyButtons(selectedFile.projectTitle, selectedFile.language, selectedFile.langIndex);
                    }
                    
                    console.log('등록 완료 알림 표시...');
                    alert(`🎉 웍스파이 프로젝트 등록 완료!\n\n프로젝트명: ${finalProjectName}\n등록 파일: ${selectedFile.fileName}`);
                    
                    console.log('선택된 파일 정보 초기화...');
                    window.selectedFileInfo = null;
                } else {
                    console.log('사용자가 취소를 클릭했습니다. 모달을 다시 열어줍니다.');
                    // 취소한 경우 모달을 다시 열어줌
                    document.getElementById('worksbyRegistrationModal').style.display = 'flex';
                }
            }, 100);
        }
        
        // 웍스파이 프로젝트 영역 건너뛰고 바로 출발어 영역 생성
        function createDirectSourceArea(projectData) {
            console.log('바로 출발어 영역 생성:', projectData);
            
            // 프로젝트별 출발어 영역을 바로 생성
            const projectId = projectData.projectNo;
            
            // 출발어 영역 생성
            let detailArea = document.getElementById(`worksby-detail-area-${projectId}`);
            if (!detailArea) {
                detailArea = document.createElement('div');
                detailArea.id = `worksby-detail-area-${projectId}`;
                detailArea.className = 'worksby-detail-area';
                detailArea.style.cssText = 'display: block; margin-top: 20px;';
                
                // 파일 리스트 섹션 다음에 바로 추가
                const fileListSection = document.querySelector('.file-list-section');
                fileListSection.parentNode.insertBefore(detailArea, fileListSection.nextSibling);
            }
            
            // 시나리오별로 다른 출발어 영역 생성 (시나리오 1,2만 사용)
            if (projectData.scenarioType === 1) {
                createScenario1SourceArea(projectData, detailArea);
            } else {
                createScenario2SourceArea(projectData, detailArea);
            }
            
            // 선택된 파일들의 웍스파이 상태를 "등록"으로 변경
            updateWorksbyStatusToRegistered();
            
            // 생성된 출발어 영역으로 스크롤
            setTimeout(() => {
                const createdArea = document.getElementById(`worksby-detail-area-${projectId}`);
                if (createdArea) {
                    createdArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    console.log('출발어 영역으로 스크롤 완료');
                }
            }, 500);
            
            console.log('바로 출발어 영역이 생성되었습니다.');
        }
        
        // 웍스파이 프로젝트 항목 생성
        function createWorksbyProjectItem(projectData) {
            console.log('웍스파이 프로젝트 항목 생성:', projectData);
            
            // 웍스파이 프로젝트 섹션이 없으면 생성
            let worksbySection = document.getElementById('worksby-projects-section');
            if (!worksbySection) {
                worksbySection = document.createElement('div');
                worksbySection.id = 'worksby-projects-section';
                worksbySection.className = 'file-list-section';
                worksbySection.style.marginTop = '20px';
                
                worksbySection.innerHTML = `
                    <h2 class="section-title">
                        <span>🚀</span>
                        웍스파이 프로젝트
                    </h2>
                    <div id="worksby-projects-container">
                        <!-- 웍스파이 프로젝트 테이블이 여기에 표시됩니다 -->
                    </div>
                `;
                
                // 파일 리스트 섹션 다음에 추가
                const fileListSection = document.querySelector('.file-list-section');
                fileListSection.parentNode.insertBefore(worksbySection, fileListSection.nextSibling);
            }
            
            // 웍스파이 프로젝트 테이블 생성
            const projectsContainer = document.getElementById('worksby-projects-container');
            if (!projectsContainer.querySelector('.worksby-projects-table')) {
                const projectTable = document.createElement('table');
                projectTable.className = 'file-table worksby-projects-table';
                projectTable.style.cssText = 'table-layout: fixed; width: 100%; margin-bottom: 20px;';
                projectTable.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width: 45%;">프로젝트명</th>
                            <th style="width: 10%;">원본 언어</th>
                            <th style="width: 20%;">도착 언어</th>
                            <th style="width: 10%;">파일 길이</th>
                            <th style="width: 10%;">진행상태</th>
                            <th style="width: 5%; text-align: center;">프로젝트 삭제</th>
                        </tr>
                    </thead>
                    <tbody id="worksby-projects-tbody"></tbody>
                `;
                
                projectsContainer.appendChild(projectTable);
                
                // 상세 영역도 생성
                const detailArea = document.createElement('div');
                detailArea.id = 'worksby-detail-area';
                detailArea.style.cssText = 'display: none; margin-top: 20px;';
                projectsContainer.appendChild(detailArea);
            }
            
            // 프로젝트 행 추가
            const projectsTbody = document.getElementById('worksby-projects-tbody');
            const projectRow = document.createElement('tr');
            projectRow.className = 'template-row';
            projectRow.setAttribute('data-project-title', projectData.title);
            projectRow.style.cursor = 'pointer';
            projectRow.onclick = () => selectWorksbyProject(projectData);
            
            projectRow.innerHTML = `
                <td style="font-weight: 600; color: #3b82f6; padding-left: 16px;">📁 ${projectData.title}</td>
                <td style="text-align: center;">한글</td>
                <td style="text-align: center;">영어, 일본어, 중국어(간체)</td>
                <td style="text-align: center;">${getSelectedFilesTotalDuration()}</td>
                <td style="text-align: center;">
                    <span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                        진행중
                    </span>
                </td>
                <td style="text-align: center; vertical-align: middle;">
                    <button class="btn" onclick="deleteWorksbyProject('${projectData.projectNo}', event)" 
                            style="background: #ef4444; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; display: inline-block;">
                        삭제
                    </button>
                </td>
            `;
            
            projectsTbody.appendChild(projectRow);
            
            // 웍스파이 프로젝트 섹션 표시
            worksbySection.style.display = 'block';
            
            // 선택된 파일들의 웍스파이 상태를 "등록"으로 변경
            updateWorksbyStatusToRegistered();
            
            console.log('웍스파이 프로젝트 항목이 생성되었습니다.');
        }
        
        // 웍스파이 상태를 "등록"으로 변경
        function updateWorksbyStatusToRegistered() {
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:not(:disabled):checked');
            
            checkedBoxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const worksbyStatusBadge = row.querySelector('.worksby-status-badge');
                
                if (worksbyStatusBadge) {
                    worksbyStatusBadge.textContent = '등록';
                    worksbyStatusBadge.style.background = '#dcfce7';
                    worksbyStatusBadge.style.color = '#166534';
                }
                
                // 분할된 파일들도 함께 업데이트 (tree-parent인 경우)
                if (row.classList.contains('tree-parent')) {
                    let nextRow = row.nextElementSibling;
                    while (nextRow && nextRow.classList.contains('tree-child')) {
                        const splitWorksbyBadge = nextRow.querySelector('.worksby-status-badge');
                        if (splitWorksbyBadge) {
                            splitWorksbyBadge.textContent = '등록';
                            splitWorksbyBadge.style.background = '#dcfce7';
                            splitWorksbyBadge.style.color = '#166534';
                        }
                        nextRow = nextRow.nextElementSibling;
                    }
                }
            });
        }
        
        // 선택된 파일들의 총 길이 계산
        function getSelectedFilesTotalDuration() {
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:not(:disabled):checked');
            if (checkedBoxes.length > 0) {
                const firstRow = checkedBoxes[0].closest('tr');
                const duration = firstRow.querySelector('td:nth-child(5)').textContent;
                return duration;
            }
            return '00:00:00';
        }
        
        // 웍스파이 프로젝트 선택
        function selectWorksbyProject(projectData) {
            console.log('웍스파이 프로젝트 선택됨:', projectData);
            
            // 기존 선택 해제
            document.querySelectorAll('.template-row').forEach(row => {
                row.style.backgroundColor = '';
                row.style.color = '';
            });
            
            // 선택된 프로젝트 하이라이트
            const selectedRow = document.querySelector(`[data-project-title="${projectData.title}"]`);
            if (selectedRow) {
                selectedRow.style.backgroundColor = '#dbeafe';
                selectedRow.style.color = '#1e40af';
            }
            
            // 모든 프로젝트 영역 숨기기
            const allProjectAreas = document.querySelectorAll('[id^="worksby-detail-area-"]');
            allProjectAreas.forEach(area => {
                area.style.display = 'none';
            });
            
            // 선택된 프로젝트의 영역만 표시
            const projectId = projectData.projectNo;
            const targetArea = document.getElementById(`worksby-detail-area-${projectId}`);
            if (targetArea) {
                targetArea.style.display = 'block';
            } else {
                // 영역이 없으면 새로 생성
                createProjectSpecificSourceArea(projectData);
            }
        }
        
        // 프로젝트별 독립적인 출발어 영역 생성
        function createProjectSpecificSourceArea(projectData) {
            console.log('프로젝트별 출발어 영역 생성:', projectData);
            
            // 기존 출발어 영역들을 모두 숨기기
            const existingAreas = document.querySelectorAll('[id^="worksby-detail-area"]');
            existingAreas.forEach(area => {
                area.style.display = 'none';
            });
            
            // 프로젝트별 고유 ID로 새로운 출발어 영역 생성
            const projectId = projectData.projectNo;
            let detailArea = document.getElementById(`worksby-detail-area-${projectId}`);
            
            if (!detailArea) {
                detailArea = document.createElement('div');
                detailArea.id = `worksby-detail-area-${projectId}`;
                detailArea.className = 'worksby-detail-area';
                detailArea.style.cssText = 'display: block; margin-top: 20px;';
                
                // 웍스파이 프로젝트 섹션 다음에 추가
                const worksbySection = document.getElementById('worksby-projects-section');
                worksbySection.parentNode.insertBefore(detailArea, worksbySection.nextSibling);
            }
            
            // 시나리오별로 다른 출발어 영역 생성 (시나리오 1,2만 사용)
            if (projectData.scenarioType === 1) {
                // 시나리오 1: 분할된 파일 기준
                createScenario1SourceArea(projectData, detailArea);
            } else {
                // 시나리오 2: 단일 파일 기준
                createScenario2SourceArea(projectData, detailArea);
            }
        }
        
        // 시나리오 1: 분할된 파일 기준 출발어 영역 생성
        function createScenario1SourceArea(projectData, detailArea) {
            console.log('시나리오 1 출발어 영역 생성:', projectData);
            
            const projectId = projectData.projectNo;
            
            // 저장된 파일 데이터 사용
            const selectedFiles = [];
            
            if (projectData.selectedFilesData && projectData.selectedFilesData.length > 0) {
                // 저장된 파일 데이터 사용
                projectData.selectedFilesData.forEach(fileData => {
                    const isTreeParent = fileData.row && fileData.row.classList.contains('tree-parent');
                    
                    // 원본 파일 추가
                    selectedFiles.push({
                        fileName: fileData.fileName,
                        isTreeParent: isTreeParent,
                        isTreeChild: false
                    });
                    
                    // 분할된 파일들도 추가 (tree-parent인 경우)
                    if (isTreeParent) {
                        let nextRow = fileData.row.nextElementSibling;
                        while (nextRow && nextRow.classList.contains('tree-child')) {
                            const splitFileName = nextRow.querySelector('.file-name').textContent;
                            selectedFiles.push({
                                fileName: splitFileName,
                                isTreeParent: false,
                                isTreeChild: true
                            });
                            nextRow = nextRow.nextElementSibling;
                        }
                    }
                });
            } else {
                // 폴백: 프로젝트 데이터에서 파일 정보 복원
                projectData.selectedFiles.forEach(fileId => {
                    const fileRow = document.querySelector(`[data-file-id="${fileId}"]`);
                    if (fileRow) {
                        const fileName = fileRow.querySelector('.file-name').textContent;
                        
                        // 원본 파일 추가
                        selectedFiles.push({
                            fileName: fileName,
                            isTreeParent: fileRow.classList.contains('tree-parent'),
                            isTreeChild: false
                        });
                        
                        // 분할된 파일들도 추가 (tree-parent인 경우)
                        if (fileRow.classList.contains('tree-parent')) {
                            let nextRow = fileRow.nextElementSibling;
                            while (nextRow && nextRow.classList.contains('tree-child')) {
                                const splitFileName = nextRow.querySelector('.file-name').textContent;
                                selectedFiles.push({
                                    fileName: splitFileName,
                                    isTreeParent: false,
                                    isTreeChild: true
                                });
                                nextRow = nextRow.nextElementSibling;
                            }
                        }
                    }
                });
            }
            
            // 출발어 영역 생성 (시나리오 1용 고유 ID 적용)
            detailArea.innerHTML = `
                <div class="work-area-container">
                    <div class="work-area-header">
                        <h2 class="work-area-title">🚀 출발어 영역 - ${projectData.title} (시나리오 1)</h2>
                    </div>
                    <div class="work-area-content">
                        <div style="background: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #3b82f6;">📝 출발어 영역</h3>
                        </div>
                        <table class="file-table" style="table-layout: fixed; width: 100%; margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 16%;">프로젝트명</th>
                                    <th style="width: 26%;">파일 이름</th>
                                    <th style="width: 5%;">출발어</th>
                                    <th style="width: 7%;">작업 시간</th>
                                    <th style="width: 7%; text-align: center;">웍스파이 등록</th>
                                    <th style="width: 10%; text-align: center;">작업자(상태)</th>
                                    <th style="width: 7%; text-align: center;">작업자 배정</th>
                                    <th style="width: 10%; text-align: center;">전사툴</th>
                                    <th style="width: 7%; text-align: center;">산출물</th>
                                    <th style="width: 5%; text-align: center;">진행상태</th>
                                </tr>
                            </thead>
                            <tbody id="detail-tbody-${projectId}">
                                <!-- 파일들이 동적으로 추가됩니다 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // 파일들을 동적으로 추가
            const tbody = document.getElementById(`detail-tbody-${projectId}`);
            if (tbody) {
                selectedFiles.forEach((file, index) => {
                    const row = document.createElement('tr');
                    row.className = file.isTreeParent ? 'tree-parent' : file.isTreeChild ? 'tree-child' : '';
                    
                    // 프로젝트명 셀
                    const projectCell = document.createElement('td');
                    projectCell.style.textAlign = 'center';
                    projectCell.textContent = projectData.title;
                    
                    // 파일명 셀
                    const fileNameCell = document.createElement('td');
                    fileNameCell.className = 'file-name';
                    fileNameCell.textContent = file.fileName;
                    
                    // 출발어 셀
                    const sourceCell = document.createElement('td');
                    sourceCell.style.textAlign = 'center';
                    sourceCell.textContent = '한글';
                    
                    // 작업 시간 셀
                    const timeCell = document.createElement('td');
                    timeCell.style.textAlign = 'center';
                    timeCell.textContent = file.isTreeChild ? '00:00:00 ~ 00:00:00' : '00:45:30';
                    
                    // 웍스파이 등록 셀
                    const registerCell = document.createElement('td');
                    registerCell.style.textAlign = 'center';
                    if (file.isTreeChild || (index === 0 && !file.isTreeParent)) {
                        registerCell.innerHTML = `<button class="btn btn-success" onclick="openProjectDetailModal('${file.fileName}', '${projectData.title}')" 
                                                          style="padding: 6px 12px; font-size: 12px; margin: 0 auto; display: inline-block;">
                                                      <span>✅</span>
                                                      등록 확인
                                                  </button>`;
                    } else {
                        registerCell.innerHTML = `<span style="color: #9ca3af;">-</span>`;
                    }
                    
                    // 작업자(상태) 셀
                    const workerStatusCell = document.createElement('td');
                    workerStatusCell.style.textAlign = 'center';
                    workerStatusCell.style.fontSize = '12px';
                    workerStatusCell.style.color = '#6b7280';
                    workerStatusCell.textContent = file.isTreeParent ? '-' : '- (대기)';
                    
                    // 작업자 배정 셀
                    const assignCell = document.createElement('td');
                    assignCell.style.textAlign = 'center';
                    if (file.isTreeParent) {
                        assignCell.innerHTML = `<span style="color: #9ca3af;">-</span>`;
                    } else if (file.isTreeChild) {
                        assignCell.innerHTML = `<button class="btn" onclick="assignNewWorker('${file.fileName}', '${projectData.title}')" 
                                                      style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                  작업자 배정
                                              </button>`;
                    } else if (index === 0) {
                        assignCell.innerHTML = `<button class="btn" onclick="assignNewWorker('${file.fileName}', '${projectData.title}')" 
                                                      style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                  작업자 배정
                                              </button>`;
                    } else {
                        assignCell.innerHTML = `<span style="color: #9ca3af;">-</span>`;
                    }
                    
                    // 전사툴 셀
                    const toolsCell = document.createElement('td');
                    toolsCell.style.textAlign = 'center';
                    if (file.isTreeParent) {
                        toolsCell.innerHTML = `<button class="btn" onclick="mergeFiles('${file.fileName}', '${projectData.title}')" 
                                                      style="background: #f97316; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                  검수툴 실행(파일 합치기)
                                              </button>`;
                    } else {
                        toolsCell.innerHTML = `<div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;">
                                                  <button class="btn" onclick="executeTranscription('${file.fileName}')" 
                                                          style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                                      전사툴 실행
                                                  </button>
                                                  <button class="btn" onclick="executeReview('${file.fileName}')" 
                                                          style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                                      검수툴 실행
                                                  </button>
                                              </div>`;
                    }
                    
                    // 산출물 셀
                    const outputCell = document.createElement('td');
                    outputCell.style.textAlign = 'center';
                    if (file.isTreeParent) {
                        outputCell.innerHTML = `<span style="color: #9ca3af;">-</span>`;
                    } else {
                        outputCell.innerHTML = `<button class="btn" onclick="downloadOutput('${file.fileName}')" 
                                                      style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                  산출물 다운로드
                                              </button>`;
                    }
                    
                    // 진행상태 셀
                    const statusCell = document.createElement('td');
                    statusCell.style.textAlign = 'center';
                    statusCell.innerHTML = `<span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                                대기
                                            </span>`;
                    
                    // 모든 셀을 행에 추가
                    row.appendChild(projectCell);
                    row.appendChild(fileNameCell);
                    row.appendChild(sourceCell);
                    row.appendChild(timeCell);
                    row.appendChild(registerCell);
                    row.appendChild(workerStatusCell);
                    row.appendChild(assignCell);
                    row.appendChild(toolsCell);
                    row.appendChild(outputCell);
                    row.appendChild(statusCell);
                    
                    tbody.appendChild(row);
                });
            }
            
            console.log(`시나리오 ${projectData.scenarioType} 출발어 영역이 생성되었습니다.`);
        }
        
        // 시나리오 2: 단일/다중 파일 기준 출발어 영역 생성
        function createScenario2SourceArea(projectData, detailArea) {
            console.log('시나리오 2 출발어 영역 생성:', projectData);
            
            const projectId = projectData.projectNo;
            
            // 저장된 파일 데이터 사용
            const selectedFiles = [];
            
            if (projectData.selectedFilesData && projectData.selectedFilesData.length > 0) {
                // 저장된 파일 데이터 사용
                projectData.selectedFilesData.forEach(fileData => {
                    selectedFiles.push({
                        fileName: fileData.fileName,
                        isTreeParent: false,
                        isTreeChild: false
                    });
                });
            } else {
                // 폴백: 프로젝트 데이터에서 파일 정보 복원
                projectData.selectedFiles.forEach(fileId => {
                    const fileRow = document.querySelector(`[data-file-id="${fileId}"]`);
                    if (fileRow) {
                        const fileName = fileRow.querySelector('.file-name').textContent;
                        
                        selectedFiles.push({
                            fileName: fileName,
                            isTreeParent: false,
                            isTreeChild: false
                        });
                    }
                });
            }
            
            // 출발어 영역 생성 (시나리오 2: 단일/다중 파일, 작업자 배정 버튼 표시)
            detailArea.innerHTML = `
                <div class="work-area-container">
                    <div class="work-area-header">
                        <h2 class="work-area-title">🚀 출발어 영역 - ${projectData.title}</h2>
                    </div>
                    <div class="work-area-content">
                        <div style="background: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #3b82f6;">📝 출발어 영역</h3>
                        </div>
                        <table class="file-table" style="table-layout: fixed; width: 100%; margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 16%;">프로젝트명</th>
                                    <th style="width: 26%;">파일 이름</th>
                                    <th style="width: 5%;">출발어</th>
                                    <th style="width: 7%;">작업 시간</th>
                                    <th style="width: 7%; text-align: center;">웍스파이 등록</th>
                                    <th style="width: 10%; text-align: center;">작업자(상태)</th>
                                    <th style="width: 7%; text-align: center;">작업자 배정</th>
                                    <th style="width: 10%; text-align: center;">전사툴</th>
                                    <th style="width: 7%; text-align: center;">산출물</th>
                                    <th style="width: 5%; text-align: center;">진행상태</th>
                                </tr>
                            </thead>
                            <tbody id="detail-tbody-${projectId}">
                                <!-- 파일들이 동적으로 추가됩니다 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // 선택된 파일들을 동적으로 추가
            const tbody = document.getElementById(`detail-tbody-${projectId}`);
            if (tbody && selectedFiles.length > 0) {
                selectedFiles.forEach((file, index) => {
                    const row = document.createElement('tr');
                
                // 프로젝트명 셀
                const projectCell = document.createElement('td');
                projectCell.style.textAlign = 'center';
                projectCell.textContent = projectData.title;
                
                // 파일명 셀
                const fileNameCell = document.createElement('td');
                fileNameCell.className = 'file-name';
                fileNameCell.textContent = file.fileName;
                
                // 출발어 셀
                const sourceCell = document.createElement('td');
                sourceCell.style.textAlign = 'center';
                sourceCell.textContent = '한글';
                
                // 작업 시간 셀
                const timeCell = document.createElement('td');
                timeCell.style.textAlign = 'center';
                timeCell.textContent = '00:45:30';
                
                // 웍스파이 등록 셀
                const registerCell = document.createElement('td');
                registerCell.style.textAlign = 'center';
                registerCell.innerHTML = `<button class="btn btn-success" onclick="openProjectDetailModal('${file.fileName}', '${projectData.title}')" 
                                                  style="padding: 6px 12px; font-size: 12px; margin: 0 auto; display: inline-block;">
                                              <span>✅</span>
                                              등록 확인
                                          </button>`;
                
                // 작업자(상태) 셀
                const workerStatusCell = document.createElement('td');
                workerStatusCell.style.textAlign = 'center';
                workerStatusCell.style.fontSize = '12px';
                workerStatusCell.style.color = '#6b7280';
                workerStatusCell.textContent = '- (대기)';
                
                // 작업자 배정 셀 (첫 번째 파일에만 작업자 배정 버튼 표시)
                const assignCell = document.createElement('td');
                assignCell.style.textAlign = 'center';
                if (index === 0) {
                    assignCell.innerHTML = `<button class="btn" onclick="assignNewWorker('${file.fileName}', '${projectData.title}')" 
                                                  style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                              작업자 배정
                                          </button>`;
                } else {
                    assignCell.innerHTML = `<span style="color: #9ca3af;">-</span>`;
                }
                
                // 전사툴 셀
                const toolsCell = document.createElement('td');
                toolsCell.style.textAlign = 'center';
                toolsCell.innerHTML = `<div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;">
                                          <button class="btn" onclick="executeTranscription('${file.fileName}')" 
                                                  style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                              전사툴 실행
                                          </button>
                                          <button class="btn" onclick="executeReview('${file.fileName}')" 
                                                  style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                              검수툴 실행
                                          </button>
                                      </div>`;
                
                // 산출물 셀
                const outputCell = document.createElement('td');
                outputCell.style.textAlign = 'center';
                outputCell.innerHTML = `<button class="btn" onclick="downloadOutput('${file.fileName}')" 
                                              style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                          산출물 다운로드
                                      </button>`;
                
                // 진행상태 셀
                const statusCell = document.createElement('td');
                statusCell.style.textAlign = 'center';
                statusCell.innerHTML = `<span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            대기
                                        </span>`;
                
                // 모든 셀을 행에 추가
                row.appendChild(projectCell);
                row.appendChild(fileNameCell);
                row.appendChild(sourceCell);
                row.appendChild(timeCell);
                row.appendChild(registerCell);
                row.appendChild(workerStatusCell);
                row.appendChild(assignCell);
                row.appendChild(toolsCell);
                row.appendChild(outputCell);
                row.appendChild(statusCell);
                
                tbody.appendChild(row);
                });
            }
            
            console.log(`시나리오 2 출발어 영역이 생성되었습니다.`);
        }
        
        
        // 분할된 파일 기준으로 출발어 영역 생성
        function createSourceAreaWithSplitFiles(projectData) {
            console.log('분할된 파일 기준 출발어 영역 생성:', projectData);
            
            const detailArea = document.getElementById('worksby-detail-area');
            detailArea.style.display = 'block';
            
            // 선택된 파일에서 분할된 파일들 수집
            const selectedFiles = [];
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:not(:disabled):checked');
            
            checkedBoxes.forEach(checkbox => {
                const parentRow = checkbox.closest('tr');
                const fileName = parentRow.querySelector('.file-name').textContent;
                
                // 원본 파일 추가
                selectedFiles.push({
                    fileName: fileName,
                    isTreeParent: parentRow.classList.contains('tree-parent'),
                    isTreeChild: false
                });
                
                // 분할된 파일들도 추가 (tree-parent인 경우)
                if (parentRow.classList.contains('tree-parent')) {
                    let nextRow = parentRow.nextElementSibling;
                    while (nextRow && nextRow.classList.contains('tree-child')) {
                        const splitFileName = nextRow.querySelector('.file-name').textContent;
                        selectedFiles.push({
                            fileName: splitFileName,
                            isTreeParent: false,
                            isTreeChild: true
                        });
                        nextRow = nextRow.nextElementSibling;
                    }
                }
            });
            
            // 출발어 영역 생성
            detailArea.innerHTML = `
                <div class="work-area-container">
                    <div class="work-area-header">
                        <h2 class="work-area-title">🚀 출발어 영역</h2>
                    </div>
                    <div class="work-area-content">
                        <div style="background: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #3b82f6;">📝 출발어 영역</h3>
                        </div>
                        <table class="file-table" style="table-layout: fixed; width: 100%; margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 16%;">프로젝트명</th>
                                    <th style="width: 26%;">파일 이름</th>
                                    <th style="width: 5%;">출발어</th>
                                    <th style="width: 7%;">작업 시간</th>
                                    <th style="width: 7%; text-align: center;">웍스파이 등록</th>
                                    <th style="width: 10%; text-align: center;">작업자(상태)</th>
                                    <th style="width: 7%; text-align: center;">작업자 배정</th>
                                    <th style="width: 10%; text-align: center;">전사툴</th>
                                    <th style="width: 7%; text-align: center;">산출물</th>
                                    <th style="width: 5%; text-align: center;">진행상태</th>
                                </tr>
                            </thead>
                            <tbody id="detail-tbody">
                                ${selectedFiles.map((file, index) => `
                                    <tr class="${file.isTreeParent ? 'tree-parent' : file.isTreeChild ? 'tree-child' : ''}">
                                        <td style="text-align: center;">${projectData.title}</td>
                                        <td class="file-name">${file.fileName}</td>
                                        <td style="text-align: center;">한글</td>
                                        <td style="text-align: center;">${file.isTreeChild ? '00:00:00 ~ 00:00:00' : '00:45:30'}</td>
                                        <td style="text-align: center;">
                                            ${file.isTreeChild || (index === 0 && !file.isTreeParent)
                                                ? `<button class="btn btn-success" onclick="openProjectDetailModal('${file.fileName}', '${projectData.title}')" 
                                                          style="padding: 6px 12px; font-size: 12px; margin: 0 auto; display: inline-block;">
                                                      <span>✅</span>
                                                      등록 확인
                                                  </button>`
                                                : `<span style="color: #9ca3af;">-</span>`
                                            }
                                        </td>
                                        <td style="text-align: center; font-size: 12px; color: #6b7280;">
                                            ${file.isTreeParent ? '-' : '- (대기)'}
                                        </td>
                                        <td style="text-align: center;">
                                            ${file.isTreeParent 
                                                ? `<span style="color: #9ca3af;">-</span>`
                                                : file.isTreeChild
                                                    ? `<button class="btn" onclick="assignNewWorker('${file.fileName}', '${projectData.title}')" 
                                                              style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                          작업자 배정
                                                      </button>`
                                                    : (index === 0)
                                                        ? `<button class="btn" onclick="assignNewWorker('${file.fileName}', '${projectData.title}')" 
                                                                  style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                              작업자 배정
                                                          </button>`
                                                        : `<span style="color: #9ca3af;">-</span>`
                                            }
                                        </td>
                                        <td style="text-align: center;">
                                            ${file.isTreeParent 
                                                ? `<button class="btn" onclick="mergeFiles('${file.fileName}', '${projectData.title}')" 
                                                          style="background: #f97316; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                      검수툴 실행(파일 합치기)
                                                  </button>`
                                                : `<div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;">
                                                      <button class="btn" onclick="executeTranscription('${file.fileName}')" 
                                                              style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                                          전사툴 실행
                                                      </button>
                                                      <button class="btn" onclick="executeReview('${file.fileName}')" 
                                                              style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">
                                                          검수툴 실행
                                                      </button>
                                                  </div>`
                                            }
                                        </td>
                                        <td style="text-align: center;">
                                            ${file.isTreeParent 
                                                ? `<span style="color: #9ca3af;">-</span>`
                                                : `<button class="btn" onclick="downloadOutput('${file.fileName}')" 
                                                          style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">
                                                      산출물 다운로드
                                                  </button>`
                                            }
                                        </td>
                                        <td style="text-align: center;">
                                            <span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                                대기
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            console.log('출발어 영역이 생성되었습니다.');
        }
        
        // 웍스파이 버튼 업데이트 (출발어 영역 + 중간어 영역 + 도착어 영역)
        function updateWorksbyButton(fileName, projectTitle) {
            console.log('updateWorksbyButton 호출됨:', fileName, projectTitle);
            
            let buttonFound = false;
            
            // 1. 출발어 영역에서 버튼 찾기
            const detailTbody = document.getElementById('detail-tbody');
            if (detailTbody) {
                buttonFound = updateButtonInArea(detailTbody, fileName, projectTitle, '출발어 영역') || buttonFound;
            }
            
            // 2. 중간어 영역에서 버튼 찾기
            const intermediateTbody = document.getElementById('intermediate-tbody');
            if (intermediateTbody) {
                buttonFound = updateButtonInArea(intermediateTbody, fileName, projectTitle, '중간어 영역') || buttonFound;
            }
            
            // 3. 도착어 영역에서 버튼 찾기 (모든 언어별 영역)
            for (let i = 0; i < 3; i++) {
                const destinationTbody = document.getElementById(`destination-tbody-${i}`);
                if (destinationTbody) {
                    buttonFound = updateButtonInArea(destinationTbody, fileName, projectTitle, '도착어 영역') || buttonFound;
                }
            }
            
            if (!buttonFound) {
                console.log('버튼을 찾지 못했습니다. 파일명과 프로젝트 제목을 확인하세요.');
            }
        }
        
        // 특정 영역에서 버튼 업데이트 헬퍼 함수
        function updateButtonInArea(tbody, fileName, projectTitle, areaName) {
            console.log(`=== ${areaName}에서 버튼 찾기 시작 ===`);
            console.log(`찾는 파일명: "${fileName}"`);
            
            const rows = tbody.querySelectorAll('tr');
            console.log(`${areaName} 파일 행 수:`, rows.length);
            
            let buttonFound = false;
            
            rows.forEach((row, rowIndex) => {
                const fileNameCell = row.querySelector('.file-name');
                if (fileNameCell) {
                    const currentFileName = fileNameCell.textContent.replace('→ ', '').trim();
                    console.log(`${areaName} 행 ${rowIndex + 1} 파일명: "${currentFileName}"`);
                    console.log(`파일명 비교: "${currentFileName}" === "${fileName}" ?`, currentFileName === fileName);
                    
                    if (currentFileName === fileName) {
                        console.log(`${areaName}에서 일치하는 파일 찾음!`);
                        
                        // 모든 컬럼 확인
                        const allCells = row.querySelectorAll('td');
                        console.log(`${areaName} 전체 컬럼 수:`, allCells.length);
                        
                        // 웍스파이 등록 컬럼 위치 결정
                        let registerColumnIndex;
                        if (areaName === '출발어 영역') {
                            registerColumnIndex = 4; // 출발어 영역: 4번째
                        } else if (areaName === '중간어 영역' || areaName === '도착어 영역') {
                            registerColumnIndex = 5; // 중간어/도착어 영역: 5번째
                        }
                        const registerCell = row.querySelector(`td:nth-child(${registerColumnIndex})`);
                        console.log(`${areaName} 웍스파이 등록 셀 (${registerColumnIndex}번째):`, registerCell);
                        
                        const button = registerCell ? registerCell.querySelector('button') : null;
                        console.log(`${areaName} 웍스파이 등록 버튼:`, button);
                        
                        if (button) {
                            console.log(`${areaName}에서 버튼 찾음! 업데이트 중...`);
                            button.innerHTML = '<span>✅</span>등록 확인';
                            button.onclick = () => openProjectDetailModal(fileName, projectTitle);
                            button.style.background = '#10b981';
                            button.className = 'btn btn-success';
                            buttonFound = true;
                            console.log(`${areaName} 버튼 업데이트 완료!`);
                        } else {
                            console.log(`${areaName}에서 웍스파이 등록 버튼을 찾을 수 없음`);
                            if (registerCell) {
                                console.log(`${areaName} 웍스파이 등록 셀 내용:`, registerCell.innerHTML);
                            }
                        }
                    }
                }
            });
            
            console.log(`=== ${areaName} 버튼 찾기 완료: ${buttonFound} ===`);
            return buttonFound;
        }
        
        // 프로젝트 상세정보 모달 열기
        function openProjectDetailModal(fileName, projectTitle) {
            console.log('openProjectDetailModal 호출됨:', fileName, projectTitle);
            
            const projectData = window.currentProjectData;
            if (!projectData) {
                alert('프로젝트 데이터를 찾을 수 없습니다.');
                return;
            }
            
            console.log('프로젝트 데이터:', projectData);
            
            // 모달 표시
            document.getElementById('projectDetailModal').style.display = 'flex';
            
            // 프로젝트 정보 탭을 기본으로 활성화
            showDetailTab('info');
            
            // 프로젝트 정보 설정
            document.getElementById('detailNo').textContent = projectData.projectNo;
            document.getElementById('detailService').textContent = projectData.service;
            document.getElementById('detailRegDate').textContent = projectData.regDate.replace('T', ' ');
            document.getElementById('detailTitle').textContent = projectData.title;
            document.getElementById('detailSelectedFilesBox').textContent = `${fileName} (01:20:15)`;
            
            // 날짜 형식 변환 후 설정
            const startDateTime = formatDateTime(projectData.startDate);
            const endDateTime = formatDateTime(projectData.endDate);
            const workStartDate = formatDisplayDate(projectData.workStartDate);
            const workEndDate = formatDisplayDate(projectData.workEndDate);
            
            document.getElementById('detailProjectPeriod').textContent = `${startDateTime} ~ ${endDateTime}`;
            document.getElementById('detailWorkPeriod').textContent = `${workStartDate} ~ ${workEndDate}`;
            document.getElementById('detailWorkerCount').textContent = `0 / ${projectData.workerCount}명`;
            document.getElementById('detailBudget').textContent = formatBudget(projectData.budget);
            document.getElementById('detailQualification').textContent = projectData.qualification === 'anyone' ? '누구나' : '속기사';
            document.getElementById('detailContent').innerHTML = projectData.description.replace(/\n/g, '<br>');
            
            console.log('프로젝트 상세정보 모달 설정 완료');
        }
        
        // 프로젝트 상세정보 모달 닫기
        function closeProjectDetailModal() {
            document.getElementById('projectDetailModal').style.display = 'none';
        }
        
        // 상세 모달 탭 전환
        function showDetailTab(tabName) {
            // 모든 탭 버튼 비활성화
            document.querySelectorAll('.detail-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = '#f8fafc';
                btn.style.color = '#6b7280';
                btn.style.borderBottom = 'none';
            });
            
            // 모든 탭 패널 숨기기
            document.querySelectorAll('.detail-tab-panel').forEach(panel => {
                panel.classList.remove('active');
                panel.style.display = 'none';
            });
            
            // 선택된 탭 활성화
            const activeBtn = document.querySelector(`[onclick="showDetailTab('${tabName}')"]`);
            const activePanel = document.getElementById(`detail-tab-${tabName}`);
            
            if (activeBtn && activePanel) {
                activeBtn.classList.add('active');
                activeBtn.style.background = 'white';
                activeBtn.style.color = '#3b82f6';
                activeBtn.style.borderBottom = '3px solid #3b82f6';
                
                activePanel.classList.add('active');
                activePanel.style.display = 'block';
            }
            
            // 하단 버튼 텍스트 및 기능 변경
            const actionBtn = document.querySelector('.btn-edit');
            if (actionBtn) {
                if (tabName === 'info') {
                    actionBtn.textContent = '수정';
                    actionBtn.onclick = editProjectDetail;
                    actionBtn.style.background = '#3b82f6';
                } else if (tabName === 'workers') {
                    actionBtn.textContent = '확정';
                    actionBtn.onclick = confirmWorkers;
                    actionBtn.style.background = '#f59e0b';
                }
            }
        }
        
        // 날짜 표시 형식 변환
        function formatDisplayDate(dateTimeString) {
            if (!dateTimeString) return '';
            const date = new Date(dateTimeString);
            return date.toISOString().slice(0, 10).replace(/-/g, '.');
        }

        // 날짜+시간 표시 형식 변환 (예: 2025.09.19 10:00)
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '';
            const date = new Date(dateTimeString);
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            const hh = String(date.getHours()).padStart(2, '0');
            const mi = String(date.getMinutes()).padStart(2, '0');
            return `${yyyy}.${mm}.${dd} ${hh}:${mi}`;
        }

        // 금액 표시 형식 변환
        function formatBudget(budget) {
            if (!budget) return '0원';
            const number = parseInt(budget.toString().replace(/[^0-9]/g, ''));
            return number.toLocaleString() + '원';
        }
        
        // 프로젝트 수정 함수
        function editProjectDetail() {
            alert('프로젝트 수정 기능은 향후 구현 예정입니다.');
        }
        
        // 프로젝트 마감 함수
        function completeProject() {
            console.log('프로젝트 마감 함수 호출됨');
            
            const projectData = window.currentProjectData;
            if (!projectData) {
                alert('프로젝트 데이터를 찾을 수 없습니다.');
                return;
            }
            
            if (confirm(`"${projectData.title}" 프로젝트를 마감하시겠습니까?\n\n마감된 프로젝트는 더 이상 작업할 수 없습니다.`)) {
                // 프로젝트 상태를 "완료"로 변경
                updateProjectStatus(projectData.projectNo, '완료');
                
                // 모달 닫기
                closeProjectDetailModal();
                
                alert(`"${projectData.title}" 프로젝트가 성공적으로 마감되었습니다.`);
            }
        }
        
        // 프로젝트 삭제 함수
        function deleteProject() {
            console.log('프로젝트 삭제 함수 호출됨');
            
            const projectData = window.currentProjectData;
            if (!projectData) {
                alert('프로젝트 데이터를 찾을 수 없습니다.');
                return;
            }
            
            if (confirm(`"${projectData.title}" 프로젝트를 삭제하시겠습니까?\n\n⚠️ 삭제된 프로젝트는 복구할 수 없습니다.\n모든 작업 데이터가 영구적으로 삭제됩니다.`)) {
                // 프로젝트 삭제 처리 (기존 deleteWorksbyProject 함수 재사용)
                deleteWorksbyProject(projectData.projectNo, { stopPropagation: () => {} });
                
                // 모달 닫기
                closeProjectDetailModal();
            }
        }
        
        // 프로젝트 상태 업데이트 함수
        function updateProjectStatus(projectNo, status) {
            console.log('프로젝트 상태 업데이트:', projectNo, status);
            
            // 웍스파이 프로젝트 테이블에서 상태 업데이트
            const projectsTbody = document.getElementById('worksby-projects-tbody');
            if (projectsTbody) {
                const projectRows = projectsTbody.querySelectorAll('tr');
                projectRows.forEach(row => {
                    const deleteButton = row.querySelector(`button[onclick*="${projectNo}"]`);
                    if (deleteButton) {
                        // 진행상태 컬럼 (5번째 컬럼) 찾기
                        const statusCell = row.querySelector('td:nth-child(5)');
                        if (statusCell) {
                            const statusBadge = statusCell.querySelector('.status-badge');
                            if (statusBadge) {
                                statusBadge.textContent = status;
                                if (status === '완료') {
                                    statusBadge.style.background = '#10b981';
                                    statusBadge.style.color = 'white';
                                } else if (status === '중단') {
                                    statusBadge.style.background = '#ef4444';
                                    statusBadge.style.color = 'white';
                                }
                            }
                        }
                        console.log(`프로젝트 ${projectNo} 상태가 "${status}"로 변경되었습니다.`);
                    }
                });
            }
            
            // 프로젝트 데이터에도 상태 저장
            if (window.allProjectsData && window.allProjectsData[projectNo]) {
                window.allProjectsData[projectNo].status = status;
                window.allProjectsData[projectNo].completedDate = new Date().toISOString().slice(0, 16).replace('T', ' ');
            }
        }
        
        // 작업자 확정 함수
        function confirmWorkers() {
            const assignedWorkers = document.querySelectorAll('.applicant-status.status-approved');
            if (assignedWorkers.length === 0) {
                alert('배정된 작업자가 없습니다.');
                return;
            }
            
            // 배정된 작업자 이름 수집
            const workerNames = [];
            assignedWorkers.forEach(statusSpan => {
                const row = statusSpan.closest('tr');
                const nameCell = row.querySelector('td:nth-child(2)'); // 이름 컬럼
                if (nameCell) {
                    workerNames.push(nameCell.textContent.trim());
                }
            });
            
            if (confirm(`${workerNames.length}명의 작업자를 확정하시겠습니까?\n\n확정 작업자: ${workerNames.join(', ')}`)) {
                // 현재 열린 프로젝트의 파일에 작업자 정보 업데이트
                updateWorkerInfo(workerNames);
                alert(`${workerNames.length}명의 작업자가 확정되었습니다.`);
            }
        }
        
        // 작업자 정보 업데이트 함수 (출발어 영역 + 중간어 영역 + 도착어 영역)
        function updateWorkerInfo(workerNames) {
            if (!window.currentProjectData || !window.currentProjectData.fileName || !window.currentProjectData.projectTitle) return;
            
            const fileName = window.currentProjectData.fileName;
            const projectTitle = window.currentProjectData.projectTitle;
            
            // 1. 출발어 영역에서 작업자 정보 업데이트
            const detailTbody = document.getElementById('detail-tbody');
            if (detailTbody) {
                updateWorkerInArea(detailTbody, fileName, workerNames, '출발어 영역');
            }
            
            // 2. 중간어 영역에서 작업자 정보 업데이트
            const intermediateTbody = document.getElementById('intermediate-tbody');
            if (intermediateTbody) {
                updateWorkerInArea(intermediateTbody, fileName, workerNames, '중간어 영역');
            }
            
            // 3. 도착어 영역에서 작업자 정보 업데이트 (모든 언어별 영역)
            for (let i = 0; i < 3; i++) {
                const destinationTbody = document.getElementById(`destination-tbody-${i}`);
                if (destinationTbody) {
                    updateWorkerInArea(destinationTbody, fileName, workerNames, '도착어 영역');
                }
            }
        }
        
        // 특정 영역에서 작업자 정보 업데이트 헬퍼 함수
        function updateWorkerInArea(tbody, fileName, workerNames, areaName) {
            console.log(`=== ${areaName}에서 작업자 정보 업데이트 시작 ===`);
            console.log(`찾는 파일명: "${fileName}"`);
            
            const rows = tbody.querySelectorAll('tr');
            console.log(`${areaName} 전체 행 수:`, rows.length);
            
            let updateCount = 0;
            
            rows.forEach((row, index) => {
                const fileNameCell = row.querySelector('.file-name');
                if (fileNameCell) {
                    const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                    const targetFileName = fileName.replace('[분할됨]', '').trim();
                    
                    console.log(`${areaName} 행 ${index + 1}: "${currentFileName}" vs "${targetFileName}"`);
                    console.log(`정확한 매칭: ${currentFileName === targetFileName}`);
                    
                    if (currentFileName === targetFileName) {
                        console.log(`${areaName}에서 일치하는 파일 찾음!`);
                        
                        // 작업자(상태) 컬럼 위치 결정
                        let workerColumnIndex;
                        if (areaName === '출발어 영역') {
                            workerColumnIndex = 5; // 출발어 영역: 5번째
                        } else if (areaName === '중간어 영역' || areaName === '도착어 영역') {
                            workerColumnIndex = 6; // 중간어/도착어 영역: 6번째
                        }
                        const workerStatusCell = row.querySelector(`td:nth-child(${workerColumnIndex})`);
                        
                        console.log(`${areaName} 작업자(상태) 컬럼 (${workerColumnIndex}번째):`, workerStatusCell);
                        
                        if (workerStatusCell) {
                            workerStatusCell.innerHTML = `<span style="color: #374151; font-size: 12px;">${workerNames.join(', ')} (작업중)</span>`;
                            updateCount++;
                            console.log(`${areaName} 행 ${index + 1} 작업자 정보 업데이트 완료!`);
                        }
                    }
                }
            });
            
            console.log(`=== ${areaName} 작업자 정보 업데이트 완료: ${updateCount}개 행 업데이트 ===`);
        }
        
        // 체크박스 전체 선택/해제
        function toggleAllWorkers(selectAllCheckbox) {
            const checkboxes = document.querySelectorAll('input[name="workerSelect"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            updateSelectedWorkerCount();
        }
        
        // 선택된 체크박스 개수 업데이트
        function updateSelectedWorkerCount() {
            const checkedBoxes = document.querySelectorAll('input[name="workerSelect"]:checked');
            const countElement = document.getElementById('selectedWorkerCount');
            if (countElement) {
                countElement.textContent = checkedBoxes.length;
            }
        }
        
        // 개별 체크박스 클릭 시 카운트 업데이트
        document.addEventListener('change', function(e) {
            if (e.target.name === 'workerSelect') {
                updateSelectedWorkerCount();
            }
        });
        
        // 작업자 관리 모달 닫기
        function closeWorkerManagementModal() {
            document.getElementById('workerManagementModal').style.display = 'none';
        }
        
        // 작업자 관리 모달에서 작업자 확정
        function confirmWorkersModal() {
            const assignedWorkers = document.querySelectorAll('#workersListModal .applicant-status.status-approved');
            if (assignedWorkers.length === 0) {
                alert('배정된 작업자가 없습니다.');
                return;
            }
            
            // 배정된 작업자 이름 수집
            const workerNames = [];
            assignedWorkers.forEach(statusSpan => {
                const row = statusSpan.closest('tr');
                const nameCell = row.querySelector('td:nth-child(2)'); // 이름 컬럼
                if (nameCell) {
                    workerNames.push(nameCell.textContent.trim());
                }
            });
            
            if (confirm(`${workerNames.length}명의 작업자를 확정하시겠습니까?\n\n확정 작업자: ${workerNames.join(', ')}`)) {
                // 현재 선택된 파일에 작업자 정보 업데이트
                updateWorkerInfoFromModal(workerNames);
                closeWorkerManagementModal();
                alert(`${workerNames.length}명의 작업자가 확정되었습니다.`);
            }
        }
        
        // 작업자 관리 모달에서 작업자 정보 업데이트
        function updateWorkerInfoFromModal(workerNames) {
            const selectedFile = window.selectedFileInfo;
            if (!selectedFile) return;
            
            const fileName = selectedFile.fileName;
            const projectTitle = selectedFile.projectTitle;
            
            // 모든 영역에서 해당 파일의 작업자 정보 업데이트
            updateWorkerInAllAreas(fileName, workerNames);
        }
        
        // 파일 리스트에서 작업자 일괄 배정 모달 열기
        function openBatchWorkerAssignmentModal() {
            console.log('파일 리스트에서 작업자 일괄 배정 모달 열기');
            
            // 1순위: 배경색으로 선택된 파일 찾기
            const selectedRow = document.querySelector('.file-table tbody tr.selected-file-row');
            
            if (selectedRow) {
                // 배경색으로 선택된 파일이 있는 경우
                const fileName = selectedRow.querySelector('.file-name').textContent;
                const fileId = selectedRow.getAttribute('data-file-id');
                
                // 선택된 파일 정보 저장 (일괄 배정용)
                window.batchAssignmentFileInfo = {
                    fileName: fileName,
                    fileId: fileId,
                    fromFileList: true
                };
                
                console.log('배경색 선택된 파일로 일괄 배정:', window.batchAssignmentFileInfo);
                
                // 작업자 수동 배정 모달 열기
                openManualWorkerAssignmentModal();
                return;
            }
            
            // 2순위: 체크된 파일들 찾기
            const checkedBoxes = document.querySelectorAll('.file-select-checkbox:not(:disabled):checked');
            
            if (checkedBoxes.length === 0) {
                alert('작업자를 배정할 파일을 선택해주세요.\n(파일 행을 클릭하거나 체크박스를 체크해주세요)');
                return;
            }
            
            if (checkedBoxes.length > 1) {
                alert('작업자 일괄 배정은 한 번에 하나의 파일만 가능합니다.\n하나의 파일만 선택해주세요.');
                return;
            }
            
            // 체크된 파일 정보
            const checkbox = checkedBoxes[0];
            const row = checkbox.closest('tr');
            const fileName = row.querySelector('.file-name').textContent;
            const fileId = checkbox.value;
            
            // 선택된 파일 정보 저장 (일괄 배정용)
            window.batchAssignmentFileInfo = {
                fileName: fileName,
                fileId: fileId,
                fromFileList: true
            };
            
            console.log('체크된 파일로 일괄 배정:', window.batchAssignmentFileInfo);
            
            // 작업자 수동 배정 모달 열기
            openManualWorkerAssignmentModal();
        }
        
        // 작업자 수동 배정 모달 열기
        function openManualWorkerAssignmentModal() {
            console.log('작업자 수동 배정 모달 열기');
            
            // 검색 초기화
            document.getElementById('searchInput').value = '';
            document.getElementById('searchOption').value = 'name';
            document.getElementById('searchResultCount').textContent = '0';
            
            // 검색 결과 초기화
            const searchResults = document.getElementById('searchResults');
            searchResults.innerHTML = `
                <div id="noSearchResults" style="padding: 60px 20px; text-align: center; color: #9ca3af; font-size: 14px;">
                    검색어를 입력하고 검색 버튼을 눌러주세요
                </div>
            `;
            
            // 배정 버튼 비활성화
            const assignBtn = document.getElementById('assignSelectedWorkerBtn');
            if (assignBtn) {
                assignBtn.disabled = true;
                assignBtn.style.opacity = '0.5';
            }
            
            document.getElementById('manualWorkerAssignmentModal').style.display = 'flex';
        }
        
        // 작업자 수동 배정 모달 닫기
        function closeManualWorkerAssignmentModal() {
            document.getElementById('manualWorkerAssignmentModal').style.display = 'none';
        }
        
        // 검색 키 입력 처리
        function handleSearchKeypress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                searchWorkers();
            }
        }
        
        // 작업자 검색 함수
        function searchWorkers() {
            const searchOption = document.getElementById('searchOption').value;
            const searchInput = document.getElementById('searchInput').value.trim();
            
            if (!searchInput) {
                alert('검색어를 입력해주세요.');
                return;
            }
            
            console.log('작업자 검색:', searchOption, searchInput);
            
            // 시나리오: "차정훈" 검색 시 결과 표시
            let searchResults = [];
            
            if (searchInput.includes('차정훈') || searchInput.includes('정훈')) {
                searchResults = [{
                    id: 'worker_001',
                    name: '차정훈',
                    email: 'jeonghoon@email.com',
                    phone: '010-1234-5678',
                    address: '서울특별시 강남구',
                    certificate: '1급'
                }];
            }
            
            // 검색 결과 표시
            displaySearchResults(searchResults);
        }
        
        // 검색 플레이스홀더 관리 함수
        function clearSearchPlaceholder(input) {
            if (input.value === '' || input.value === '검색어를 입력하세요') {
                input.value = '';
                input.style.color = '#374151';
            }
        }
        
        function restoreSearchPlaceholder(input) {
            if (input.value === '') {
                input.placeholder = '검색어를 입력하세요';
                input.style.color = '#9ca3af';
            }
        }
        
        // 검색 결과 표시 함수 (심플한 디자인)
        function displaySearchResults(results) {
            const searchResultsContainer = document.getElementById('searchResults');
            const searchResultCount = document.getElementById('searchResultCount');
            
            searchResultCount.textContent = results.length;
            
            if (results.length === 0) {
                searchResultsContainer.innerHTML = `
                    <div style="padding: 60px 20px; text-align: center; color: #9ca3af; font-size: 14px;">
                        검색 결과가 없습니다
                    </div>
                `;
                return;
            }
            
            // 검색 결과 HTML 생성 (심플한 디자인)
            let resultsHTML = '';
            results.forEach((worker, index) => {
                resultsHTML += `
                    <div class="worker-result-item" style="padding: 16px 20px; border-bottom: ${index < results.length - 1 ? '1px solid #f3f4f6' : 'none'}; cursor: pointer;" 
                         onclick="selectWorkerRadio('${worker.id}')">
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <input type="radio" name="selectedWorker" value="${worker.id}" 
                                   onchange="handleWorkerSelection()" 
                                   style="width: 16px; height: 16px; cursor: pointer; margin-top: 2px;">
                            <div style="flex: 1;">
                                <div style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 4px;">
                                    ${worker.name}
                                </div>
                                <div style="font-size: 14px; color: #6b7280; margin-bottom: 2px;">
                                    ${worker.email}
                                </div>
                                <div style="display: flex; gap: 15px; font-size: 14px; color: #6b7280;">
                                    <span>📞 ${worker.phone}</span>
                                    <span>📍 ${worker.address}</span>
                                    <span style="background: #f3f4f6; color: #374151; padding: 2px 6px; border-radius: 8px; font-size: 12px;">
                                        🏆 ${worker.certificate}급
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            searchResultsContainer.innerHTML = resultsHTML;
        }
        
        // 작업자 라디오 버튼 선택 헬퍼 함수
        function selectWorkerRadio(workerId) {
            const radio = document.querySelector(`input[name="selectedWorker"][value="${workerId}"]`);
            if (radio) {
                radio.checked = true;
                handleWorkerSelection();
            }
        }
        
        // 작업자 선택 처리
        function handleWorkerSelection() {
            const selectedRadio = document.querySelector('input[name="selectedWorker"]:checked');
            const assignBtn = document.getElementById('assignSelectedWorkerBtn');
            
            if (selectedRadio && assignBtn) {
                assignBtn.disabled = false;
                assignBtn.style.opacity = '1';
            }
        }
        
        // 선택한 작업자 배정
        function assignSelectedWorker() {
            const selectedRadio = document.querySelector('input[name="selectedWorker"]:checked');
            
            if (!selectedRadio) {
                alert('배정할 작업자를 선택해주세요.');
                return;
            }
            
            // 선택된 작업자 정보 찾기
            const workerId = selectedRadio.value;
            const workerItem = selectedRadio.closest('.worker-result-item');
            const workerName = workerItem.querySelector('div[style*="font-weight: 600"]').textContent;
            
            console.log('선택된 작업자:', workerId, workerName);
            
            // 파일 리스트에서 호출된 경우와 출발어 영역에서 호출된 경우 구분
            const batchFileInfo = window.batchAssignmentFileInfo;
            const selectedFile = window.selectedFileInfo;
            
            let targetFileName = '';
            let confirmMessage = '';
            
            if (batchFileInfo && batchFileInfo.fromFileList) {
                // 파일 리스트에서 일괄 배정 호출된 경우
                targetFileName = batchFileInfo.fileName;
                confirmMessage = `"${workerName}" 작업자를 "${targetFileName}" 파일의 모든 작업 영역에 일괄 배정하시겠습니까?\n\n배정 대상: 출발어/중간어/도착어 영역 전체`;
            } else if (selectedFile) {
                // 출발어 영역에서 호출된 경우
                targetFileName = selectedFile.fileName;
                confirmMessage = `"${workerName}" 작업자를 배정하시겠습니까?`;
            } else {
                alert('배정할 파일 정보를 찾을 수 없습니다.');
                return;
            }
            
            if (confirm(confirmMessage)) {
                if (batchFileInfo && batchFileInfo.fromFileList) {
                    // 파일 리스트에서 일괄 배정: 해당 파일의 모든 영역에 작업자 배정
                    updateWorkerInAllAreasForFile(targetFileName, [workerName]);
                    
                    // 모달 닫기
                    closeManualWorkerAssignmentModal();
                    
                    // 일괄 배정 정보 초기화
                    window.batchAssignmentFileInfo = null;
                    
                    alert(`"${workerName}" 작업자가 "${targetFileName}" 파일의 모든 작업 영역에 일괄 배정되었습니다.`);
                } else {
                    // 출발어 영역에서 개별 배정: 기존 로직 사용
                    updateWorkerInAllAreas(targetFileName, [workerName]);
                    
                    // 모달들 닫기
                    closeManualWorkerAssignmentModal();
                    closeWorkerManagementModal();
                    
                    alert(`"${workerName}" 작업자가 성공적으로 배정되었습니다.`);
                }
            }
        }
        
        // 특정 파일의 모든 영역에 작업자 일괄 배정
        function updateWorkerInAllAreasForFile(fileName, workerNames) {
            console.log(`파일 "${fileName}"의 모든 영역에 작업자 일괄 배정:`, workerNames);
            
            // 해당 파일로 생성된 모든 프로젝트 찾기
            const targetProjects = [];
            if (window.allProjectsData) {
                for (const [projectId, projectData] of Object.entries(window.allProjectsData)) {
                    if (projectData.fileName && projectData.fileName.includes(fileName.replace(/\.[^/.]+$/, ""))) {
                        targetProjects.push(projectId);
                    }
                }
            }
            
            console.log('작업자 배정 대상 프로젝트들:', targetProjects);
            
            // 각 프로젝트의 모든 영역에 작업자 배정
            targetProjects.forEach(projectId => {
                // 출발어 영역
                const detailTbody = document.getElementById(`detail-tbody-${projectId}`);
                if (detailTbody) {
                    updateWorkerInAllFilesInArea(detailTbody, workerNames, `출발어 영역(${projectId})`);
                }
                
                // 중간어 영역
                const intermediateTbody = document.getElementById(`intermediate-tbody-${projectId}`);
                if (intermediateTbody) {
                    updateWorkerInAllFilesInArea(intermediateTbody, workerNames, `중간어 영역(${projectId})`);
                }
                
                // 도착어 영역 (모든 언어)
                for (let i = 0; i < 3; i++) {
                    const destinationTbody = document.getElementById(`destination-tbody-${projectId}-${i}`);
                    if (destinationTbody) {
                        const destinationLanguages = ["영어", "일본어", "중국어(간체)"];
                        updateWorkerInAllFilesInArea(destinationTbody, workerNames, `도착어 영역(${destinationLanguages[i]}, ${projectId})`);
                    }
                }
            });
            
            console.log(`파일 "${fileName}"의 모든 영역에 작업자 일괄 배정 완료`);
        }
        
        // 하단 영역을 항상 최하단으로 이동시키는 함수
        function moveBottomSectionsToEnd() {
            const bottomSectionsContainer = document.getElementById('bottom-sections-container');
            const body = document.querySelector('body');
            
            if (bottomSectionsContainer && body) {
                // 하단 영역을 body의 마지막 자식으로 이동 (모달들 제외)
                const modals = document.querySelectorAll('.modal-overlay');
                const lastModal = modals[modals.length - 1];
                
                if (lastModal) {
                    // 마지막 모달 앞에 삽입
                    body.insertBefore(bottomSectionsContainer, lastModal);
                } else {
                    // 모달이 없으면 body 마지막에 추가
                    body.appendChild(bottomSectionsContainer);
                }
                
                console.log('하단 영역이 최하단으로 이동되었습니다.');
            }
        }
        
        // 페이지 로드 시 하단 영역 위치 조정
        document.addEventListener('DOMContentLoaded', function() {
            moveBottomSectionsToEnd();
        });
        
        // 새로운 영역이 생성될 때마다 하단 영역을 최하단으로 이동
        function ensureBottomSectionsAtEnd() {
            setTimeout(moveBottomSectionsToEnd, 100);
        }
        
        // 파일공유 기능들 (trans-detail.html에서 가져옴)
        function addSharedFile() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.multiple = true;
            fileInput.accept = '.hwp,.doc,.docx,.pdf,.txt,.zip';
            fileInput.onchange = function(e) {
                if (e.target.files.length > 0) {
                    const filesList = document.getElementById('shared-files-list');
                    
                    for (let i = 0; i < e.target.files.length; i++) {
                        const fileName = e.target.files[i].name;
                        
                        // 새 파일 항목 생성
                        const fileItem = document.createElement('div');
                        fileItem.style.cssText = 'display: flex; align-items: center; padding: 6px 0; border-bottom: 1px solid #e5e7eb;';
                        fileItem.innerHTML = `
                            <input type="checkbox" style="margin-right: 18px;">
                            <span style="color: #3b82f6; cursor: pointer; text-decoration: none; font-size: 12px;">${fileName}</span>
                        `;
                        
                        filesList.appendChild(fileItem);
                    }
                    
                    alert(`${e.target.files.length}개의 파일이 공유 목록에 추가되었습니다.`);
                }
            }
            fileInput.click();
        }

        function deleteSharedFile() {
            const checkboxes = document.querySelectorAll('#shared-files-list input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert('삭제할 파일을 선택해주세요.');
                return;
            }
            
            if (confirm(`선택된 ${checkboxes.length}개의 파일을 삭제하시겠습니까?`)) {
                checkboxes.forEach(checkbox => {
                    checkbox.parentElement.remove();
                });
                alert(`${checkboxes.length}개의 파일이 삭제되었습니다.`);
            }
        }

        // 고객 세부 요청사항 관련 함수들 (trans-detail.html에서 가져옴)
        function shareCustomerRequest() {
            const shareBtn = document.getElementById('share-request-btn');
            const currentStatus = shareBtn.getAttribute('data-status');
            
            if (currentStatus === 'idle') {
                // 공유 실행
                const shareText = document.getElementById('customer-request-share').value;
                
                if (!shareText.trim()) {
                    alert('공유할 요청사항이 없습니다.');
                    return;
                }
                
                // 실제 환경에서는 공유 API 호출
                alert('고객 세부 요청사항이 작업자에게 공유되었습니다.');
                
                // 버튼 상태를 "공유중"으로 변경
                shareBtn.setAttribute('data-status', 'sharing');
                shareBtn.textContent = '공유중';
                shareBtn.style.background = '#f59e0b'; // 주황색
                
            } else if (currentStatus === 'sharing') {
                // 공유 취소 확인
                if (confirm('공유를 취소하시겠습니까?')) {
                    // 버튼 상태를 "공유"로 되돌리기
                    shareBtn.setAttribute('data-status', 'idle');
                    shareBtn.textContent = '공유';
                    shareBtn.style.background = '#3b82f6'; // 원래 파란색
                    
                    alert('공유가 취소되었습니다.');
                }
            }
        }

        // 작업 특이사항 기능들 (trans-detail.html에서 가져옴)
        let notesModified = false;
        
        function markNotesAsModified() {
            notesModified = true;
        }

        function saveWorkNotes() {
            const notes = document.getElementById('work-notes').value;
            
            if (!notes.trim()) {
                alert('작업 특이사항을 입력해주세요.');
                return;
            }
            
            // 실제 환경에서는 서버로 데이터 전송
            setTimeout(() => {
                notesModified = false;
                alert('작업 특이사항이 저장되었습니다.');
            }, 500);
        }
        
        // 파일추가 모달 관련 함수들 (trans-detail.html에서 가져옴)
        function closeFileAddModal() {
            document.getElementById('fileAddModal').style.display = 'none';
            document.getElementById('fileAddForm').reset();
            removeNewFile();
        }
        
        function handleNewFileUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // 파일 크기 체크 (100MB)
                if (file.size > 100 * 1024 * 1024) {
                    alert('파일 크기는 100MB를 초과할 수 없습니다.');
                    input.value = '';
                    return;
                }
                
                // 파일 정보 표시
                document.getElementById('newFileName').textContent = file.name;
                document.getElementById('newFileSize').textContent = (file.size / 1024 / 1024).toFixed(1) + ' MB';
                
                // 업로드 영역 숨기고 미리보기 표시
                document.querySelector('#fileAddModal .file-upload-content').style.display = 'none';
                document.getElementById('newFilePreview').style.display = 'flex';
            }
        }
        
        function removeNewFile() {
            document.getElementById('newFileInput').value = '';
            document.getElementById('newFileName').textContent = '';
            document.getElementById('newFileSize').textContent = '';
            document.querySelector('#fileAddModal .file-upload-content').style.display = 'flex';
            document.getElementById('newFilePreview').style.display = 'none';
        }
        
        function addNewFile() {
            // 파일이 선택되었는지 확인
            const fileInput = document.getElementById('newFileInput');
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('파일을 선택해주세요.');
                return;
            }
            
            const file = fileInput.files[0];
            
            // 시연용 임의 데이터 생성
            const sampleDurations = ['00:25:30', '00:45:15', '01:12:45', '00:38:20', '00:52:10'];
            
            // 랜덤 데이터 선택
            const randomIndex = Math.floor(Math.random() * sampleDurations.length);
            const duration = sampleDurations[randomIndex];
            
            // 새 파일 데이터 생성 (시연용)
            const newFileData = {
                file: { name: file.name },
                duration: duration
            };
            
            // 파일 리스트에 추가
            addFileToMainList(newFileData);
            
            // 모달 닫기
            closeFileAddModal();
            
            alert('의뢰파일이 성공적으로 추가되었습니다.');
        }
        
        function addFileToMainList(fileData) {
            const tbody = document.querySelector('#main-file-list-table tbody');
            if (!tbody) return;
            
            // 새 파일 ID 생성 (기존 파일 수 + 1)
            const existingRows = tbody.querySelectorAll('tr').length;
            const newFileId = existingRows + 1;
            
            // 새 행 생성
            const newRow = document.createElement('tr');
            newRow.onclick = () => selectFileRow(newRow);
            newRow.style.cursor = 'pointer';
            newRow.setAttribute('data-file-id', newFileId);
            
            newRow.innerHTML = `
                <td style="text-align: center; padding: 12px 8px; border: 1px solid #e5e7eb; vertical-align: middle;">
                    <input type="checkbox" class="file-select-checkbox" value="${newFileId}" onclick="handleCheckboxClick(event, this);">
                </td>
                <td style="text-align: left; padding: 12px 8px; border: 1px solid #e5e7eb; vertical-align: middle;" class="file-name">
                    ${fileData.file.name}
                </td>
                <td style="text-align: center; padding: 12px 8px; border: 1px solid #e5e7eb; vertical-align: middle;">
                    한글
                </td>
                <td style="text-align: center; padding: 12px 8px; border: 1px solid #e5e7eb; vertical-align: middle;">
                    영어, 일본어, 중국어(간체)
                </td>
                <td style="text-align: center; padding: 12px 8px; border: 1px solid #e5e7eb; vertical-align: middle;">
                    ${fileData.duration}
                </td>
                <td style="text-align: center; padding: 12px 8px; border: 1px solid #e5e7eb; vertical-align: middle;">
                    <span style="background: #e5e7eb; color: #374151; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">기본</span>
                </td>
                <td style="text-align: center; padding: 12px 8px; border: 1px solid #e5e7eb; vertical-align: middle;">
                    <span class="worksby-status-badge" style="background: #fef2f2; color: #991b1b; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">미등록</span>
                </td>
            `;
            
            tbody.appendChild(newRow);
        }
        
        // 산출물 다운로드 모달 관련 함수들 (trans-detail.html에서 가져옴)
        function closeOutputDownloadModal() {
            document.getElementById('outputDownloadModal').style.display = 'none';
            currentDownloadFileName = '';
        }
        
        // SMI tag 옵션 활성화/비활성화 토글
        function toggleSmiTagOptions() {
            const ansiSelected = document.querySelector('input[name="smi-encoding"][value="ansi"]').checked;
            const tagSection = document.getElementById('smi-tag-section');
            const tagRadios = document.querySelectorAll('input[name="smi-tag"]');
            
            if (ansiSelected) {
                // ANSI 선택 시 활성화
                tagSection.style.opacity = '1';
                tagSection.style.pointerEvents = 'auto';
                tagRadios.forEach(radio => radio.disabled = false);
            } else {
                // UTF-8 선택 시 비활성화
                tagSection.style.opacity = '0.5';
                tagSection.style.pointerEvents = 'none';
                tagRadios.forEach(radio => radio.disabled = true);
            }
        }
        
        // 특정 파일 형식 다운로드
        function downloadFile(fileType) {
            const fileBaseName = currentDownloadFileName.replace(/\.[^/.]+$/, ""); // 확장자 제거
            let downloadFileName = '';
            let options = {};
            
            // 각 파일 형식별로 옵션 수집
            switch(fileType) {
                case 'txt':
                    const txtBlank = document.querySelector('input[name="txt-blank"]:checked').value;
                    downloadFileName = `${fileBaseName}.txt`;
                    options.blankLines = txtBlank;
                    break;
                    
                case 'smi':
                    const smiPosition = document.querySelector('input[name="smi-position"]:checked').value;
                    const smiNbsp = document.querySelector('input[name="smi-nbsp"]:checked').value;
                    const smiEncoding = document.querySelector('input[name="smi-encoding"]:checked').value;
                    const smiTag = document.querySelector('input[name="smi-tag"]:checked').value;
                    downloadFileName = `${fileBaseName}.smi`;
                    options = { position: smiPosition, nbsp: smiNbsp, encoding: smiEncoding, tag: smiTag };
                    break;
                    
                case 'srt':
                    const srtPosition = document.querySelector('input[name="srt-position"]:checked').value;
                    const srtSync = document.querySelector('input[name="srt-sync"]:checked').value;
                    const srtBlank = document.querySelector('input[name="srt-blank"]:checked').value;
                    downloadFileName = `${fileBaseName}.srt`;
                    options = { position: srtPosition, sync: srtSync, blankLines: srtBlank };
                    break;
                    
                case 'vtt':
                    downloadFileName = `${fileBaseName}.vtt`;
                    break;
                    
                case 'capt':
                    downloadFileName = `${fileBaseName}.capt`;
                    break;
                    
                case 'hwp':
                    downloadFileName = `${fileBaseName}.hwp`;
                    break;
                    
                default:
                    downloadFileName = `${fileBaseName}.txt`;
                    break;
            }
            
            // 실제 환경에서는 서버에서 파일을 다운로드하는 API 호출
            const optionsText = Object.keys(options).length > 0 
                ? `\n\n설정 옵션: ${JSON.stringify(options, null, 2)}`
                : '';
            
            alert(`${fileType.toUpperCase()} 파일 다운로드를 시작합니다.\n\n파일명: ${downloadFileName}${optionsText}\n\n실제 환경에서는 파일이 다운로드됩니다.`);
            
            // 다운로드 후 모달 닫기
            closeOutputDownloadModal();
            
            // 시연용 - 실제로는 다음과 같은 코드가 사용됩니다:
            // const link = document.createElement('a');
            // link.href = `/api/download/output/${encodeURIComponent(currentDownloadFileName)}/${fileType}?options=${encodeURIComponent(JSON.stringify(options))}`;
            // link.download = downloadFileName;
            // document.body.appendChild(link);
            // link.click();
            // document.body.removeChild(link);
        }
        
        // 모든 영역에서 작업자 정보 업데이트 (시나리오별 구분)
        function updateWorkerInAllAreas(fileName, workerNames) {
            // 시나리오 구분: 분할된 파일명에 → 가 있으면 시나리오 1 (특정 파일만 배정)
            const isScenario1 = fileName.includes('→') || fileName.includes('구간');
            
            if (isScenario1) {
                // 시나리오 1: 특정 분할된 파일에만 작업자 배정
                updateWorkerInSpecificFile(fileName, workerNames);
            } else {
                // 시나리오 2,3: 모든 파일에 작업자 배정
                updateWorkerInAllFilesInAllAreas(workerNames);
            }
        }
        
        // 특정 파일에만 작업자 배정 (시나리오 1용)
        function updateWorkerInSpecificFile(fileName, workerNames) {
            console.log(`=== 특정 파일 "${fileName}"에만 작업자 배정 ===`);
            
            // 현재 프로젝트 ID 가져오기
            const currentProjectId = window.selectedFileInfo?.currentProjectId;
            if (!currentProjectId) {
                console.log('현재 프로젝트 ID를 찾을 수 없습니다.');
                return;
            }
            
            console.log(`현재 프로젝트 ID: ${currentProjectId}`);
            
            // 1. 출발어 영역 (프로젝트별 고유 ID 사용)
            const detailTbody = document.getElementById(`detail-tbody-${currentProjectId}`);
            if (detailTbody) {
                updateWorkerInSpecificFileInArea(detailTbody, fileName, workerNames, '출발어 영역');
            } else {
                console.log(`출발어 영역 테이블을 찾을 수 없습니다: detail-tbody-${currentProjectId}`);
            }
            
            // 2. 중간어 영역 (프로젝트별 고유 ID 사용)
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            if (intermediateTbody) {
                updateWorkerInSpecificFileInArea(intermediateTbody, fileName, workerNames, '중간어 영역');
            }
            
            // 3. 도착어 영역 (프로젝트별 고유 ID 사용)
            for (let i = 0; i < 3; i++) {
                const destinationTbody = document.getElementById(`destination-tbody-${currentProjectId}-${i}`);
                if (destinationTbody) {
                    const destinationLanguages = ["영어", "일본어", "중국어(간체)"];
                    updateWorkerInSpecificFileInArea(destinationTbody, fileName, workerNames, `도착어 영역(${destinationLanguages[i]})`);
                }
            }
        }
        
        // 모든 파일에 작업자 배정 (시나리오 2,3용)
        function updateWorkerInAllFilesInAllAreas(workerNames) {
            console.log('=== 모든 파일에 작업자 배정 (시나리오 2,3) ===');
            
            // 현재 프로젝트 ID 가져오기
            const currentProjectId = window.selectedFileInfo?.currentProjectId;
            if (!currentProjectId) {
                console.log('현재 프로젝트 ID를 찾을 수 없습니다.');
                return;
            }
            
            console.log(`현재 프로젝트 ID: ${currentProjectId}`);
            
            // 1. 출발어 영역 - 모든 파일에 작업자 적용 (프로젝트별 고유 ID 사용)
            const detailTbody = document.getElementById(`detail-tbody-${currentProjectId}`);
            if (detailTbody) {
                updateWorkerInAllFilesInArea(detailTbody, workerNames, '출발어 영역');
            } else {
                console.log(`출발어 영역 테이블을 찾을 수 없습니다: detail-tbody-${currentProjectId}`);
            }
            
            // 2. 중간어 영역 - 모든 파일에 작업자 적용 (프로젝트별 고유 ID 사용)
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            if (intermediateTbody) {
                updateWorkerInAllFilesInArea(intermediateTbody, workerNames, '중간어 영역');
            }
            
            // 3. 도착어 영역 - 모든 언어별 영역의 모든 파일에 작업자 적용 (프로젝트별 고유 ID 사용)
            for (let i = 0; i < 3; i++) {
                const destinationTbody = document.getElementById(`destination-tbody-${currentProjectId}-${i}`);
                if (destinationTbody) {
                    const destinationLanguages = ["영어", "일본어", "중국어(간체)"];
                    updateWorkerInAllFilesInArea(destinationTbody, workerNames, `도착어 영역(${destinationLanguages[i]})`);
                }
            }
        }
        
        // 특정 파일에만 작업자 정보 업데이트 (시나리오 1용)
        function updateWorkerInSpecificFileInArea(tbody, fileName, workerNames, areaName) {
            console.log(`=== ${areaName}에서 특정 파일 "${fileName}"에만 작업자 정보 업데이트 시작 ===`);
            
            const rows = tbody.querySelectorAll('tr');
            console.log(`${areaName} 전체 행 수:`, rows.length);
            
            let updateCount = 0;
            
            rows.forEach((row, index) => {
                const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                if (fileNameCell) {
                    const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                    console.log(`${areaName} 행 ${index + 1}: "${currentFileName}" vs "${fileName}"`);
                    
                    // 정확히 일치하는 파일에만 작업자 배정
                    if (currentFileName === fileName) {
                        console.log(`${areaName}에서 일치하는 파일 찾음: "${currentFileName}"`);
                        
                        // 작업자(상태) 컬럼 찾기 (영역별로 다른 위치)
                        let workerColumnIndex;
                        if (areaName.includes('출발어')) {
                            workerColumnIndex = 6; // 출발어 영역: 프로젝트명(1) → 파일명(2) → 출발어(3) → 작업시간(4) → 웍스파이등록(5) → 작업자(상태)(6)
                        } else if (areaName.includes('중간어')) {
                            workerColumnIndex = 7; // 중간어 영역: 프로젝트명(1) → 파일명(2) → 출발어(3) → 중간어(4) → 작업시간(5) → 웍스파이등록(6) → 작업자(상태)(7)
                        } else if (areaName.includes('도착어')) {
                            workerColumnIndex = 7; // 도착어 영역: 프로젝트명(1) → 파일명(2) → 출발어(3) → 도착어(4) → 작업시간(5) → 웍스파이등록(6) → 작업자(상태)(7)
                        } else {
                            workerColumnIndex = 6; // 기본값
                        }
                        
                        const workerStatusCell = row.querySelector(`td:nth-child(${workerColumnIndex})`);
                        if (workerStatusCell) {
                            const workerDisplayText = workerNames.length > 0 
                                ? `${workerNames[0]} (배정완료)` 
                                : '- (대기)';
                            
                            workerStatusCell.innerHTML = `<span style="color: #10b981; font-weight: 500;">${workerDisplayText}</span>`;
                            updateCount++;
                            console.log(`${areaName} "${currentFileName}" 작업자 정보 업데이트 완료: ${workerDisplayText}`);
                        }
                    }
                }
            });
            
            console.log(`${areaName} 특정 파일 작업자 정보 업데이트 완료: ${updateCount}개 파일`);
        }
        
        // 특정 영역의 모든 파일에 작업자 정보 업데이트 (시나리오 3용)
        function updateWorkerInAllFilesInArea(tbody, workerNames, areaName) {
            console.log(`=== ${areaName}의 모든 파일에 작업자 정보 업데이트 시작 ===`);
            
            const rows = tbody.querySelectorAll('tr');
            console.log(`${areaName} 전체 행 수:`, rows.length);
            
            let updateCount = 0;
            
            rows.forEach((row, index) => {
                // tree-child는 제외하고 원본 파일과 일반 파일만 업데이트
                if (!row.classList.contains('tree-child')) {
                    // 프로젝트명 컬럼이 추가되어 파일명은 두 번째 셀
                    const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                    if (fileNameCell) {
                        const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                        console.log(`${areaName} 행 ${index + 1}: "${currentFileName}" - 작업자 업데이트 중...`);
                        
                        // 작업자(상태) 컬럼 찾기 (영역별로 다른 위치, 프로젝트명 컬럼 추가로 +1)
                        let workerColumnIndex;
                        if (areaName.includes('출발어')) {
                            workerColumnIndex = 6; // 출발어 영역: 프로젝트명(1) → 파일명(2) → 출발어(3) → 작업시간(4) → 웍스파이등록(5) → 작업자(상태)(6)
                        } else if (areaName.includes('중간어')) {
                            workerColumnIndex = 7; // 중간어 영역: 프로젝트명(1) → 파일명(2) → 출발어(3) → 중간어(4) → 작업시간(5) → 웍스파이등록(6) → 작업자(상태)(7)
                        } else if (areaName.includes('도착어')) {
                            workerColumnIndex = 7; // 도착어 영역: 프로젝트명(1) → 파일명(2) → 출발어(3) → 도착어(4) → 작업시간(5) → 웍스파이등록(6) → 작업자(상태)(7)
                        } else {
                            workerColumnIndex = 6; // 기본값
                        }
                        
                        const workerStatusCell = row.querySelector(`td:nth-child(${workerColumnIndex})`);
                        if (workerStatusCell) {
                            const workerDisplayText = workerNames.length > 0 
                                ? `${workerNames[0]} (배정완료)` 
                                : '- (대기)';
                            
                            workerStatusCell.innerHTML = `<span style="color: #10b981; font-weight: 500;">${workerDisplayText}</span>`;
                            updateCount++;
                            console.log(`${areaName} "${currentFileName}" 작업자 정보 업데이트 완료: ${workerDisplayText}`);
                        }
                    }
                }
            });
            
            console.log(`${areaName} 작업자 정보 업데이트 완료: ${updateCount}개 파일`);
        }
        
        // 작업자 관리 모달 일괄 배정/미배정 처리
        function batchUpdateWorkerStatusModal(status) {
            const checkedBoxes = document.querySelectorAll('input[name="workerSelectModal"]:checked');
            if (checkedBoxes.length === 0) {
                alert('선택된 작업자가 없습니다.');
                return;
            }
            
            const statusText = status === 'assigned' ? '배정' : '미배정';
            const confirmMessage = `선택된 ${checkedBoxes.length}명의 작업자를 ${statusText}하시겠습니까?`;
            
            if (confirm(confirmMessage)) {
                checkedBoxes.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const statusCell = row.querySelector('td:nth-child(9)');
                    const statusSpan = statusCell.querySelector('.applicant-status');
                    
                    if (status === 'assigned') {
                        statusSpan.textContent = '배정';
                        statusSpan.className = 'applicant-status status-approved';
                        statusSpan.style.background = '#dcfce7';
                        statusSpan.style.color = '#166534';
                        // 배정일 추가
                        const assignDateCell = row.querySelector('td:nth-child(8)');
                        const today = new Date();
                        assignDateCell.textContent = today.toISOString().slice(0, 10).replace(/-/g, '.');
                    } else if (status === 'unassigned') {
                        statusSpan.textContent = '미배정';
                        statusSpan.className = 'applicant-status status-cancelled';
                        statusSpan.style.background = '#fef2f2';
                        statusSpan.style.color = '#991b1b';
                        // 배정일 제거
                        const assignDateCell = row.querySelector('td:nth-child(8)');
                        assignDateCell.textContent = '-';
                    }
                    
                    // 체크박스 해제
                    checkbox.checked = false;
                });
                
                // 전체 선택 체크박스도 해제
                const selectAllCheckbox = document.getElementById('selectAllWorkersModal');
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = false;
                }
                
                updateSelectedWorkerCountModal();
                
                alert(`${checkedBoxes.length}명의 작업자가 ${statusText}되었습니다.`);
            }
        }
        
        // 작업자 관리 모달 선택된 작업자 수 업데이트
        function updateSelectedWorkerCountModal() {
            const checkedBoxes = document.querySelectorAll('input[name="workerSelectModal"]:checked');
            const countElement = document.getElementById('selectedWorkerCountModal');
            if (countElement) {
                countElement.textContent = checkedBoxes.length + '명';
            }
        }
        
        // 작업자 관리 모달 체크박스 이벤트 리스너
        document.addEventListener('change', function(e) {
            if (e.target.name === 'workerSelectModal') {
                updateSelectedWorkerCountModal();
            }
        });
        
        // 새로운 기능들을 위한 함수들
        function executeTranscription(fileName) {
            alert(`${fileName} 파일의 전사툴을 실행합니다.`);
            // 추후 구현 예정
        }
        
        // 출발어 영역의 모든 파일이 검수완료되었는지 확인하는 함수
        function checkAllSourceFilesReviewComplete() {
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                return false;
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`출발어 검수 완료 체크 - 현재 프로젝트 ID: ${currentProjectId}`);
            
            const detailTbody = document.getElementById(`detail-tbody-${currentProjectId}`);
            if (!detailTbody) {
                console.log(`출발어 영역 테이블을 찾을 수 없습니다: detail-tbody-${currentProjectId}`);
                return false;
            }
            
            const rows = detailTbody.querySelectorAll('tr');
            let totalFiles = 0;
            let completedFiles = 0;
            
            rows.forEach(row => {
                // tree-child는 제외하고 원본 파일과 일반 파일만 체크
                if (!row.classList.contains('tree-child')) {
                    totalFiles++;
                    
                    // 진행상태 컬럼 (마지막 컬럼) 확인
                    const progressCell = row.querySelector('td:last-child');
                    if (progressCell) {
                        const progressText = progressCell.textContent.trim();
                        if (progressText.includes('검수완료')) {
                            completedFiles++;
                        }
                    }
                }
            });
            
            console.log(`출발어 영역 검수 상태: ${completedFiles}/${totalFiles}`);
            return totalFiles > 0 && completedFiles === totalFiles;
        }
        
        // 중간어 영역의 모든 파일이 검수완료되었는지 확인하는 함수
        function checkAllIntermediateFilesReviewComplete() {
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                return false;
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`중간어 검수 완료 체크 - 현재 프로젝트 ID: ${currentProjectId}`);
            
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            if (!intermediateTbody) {
                console.log(`중간어 영역 테이블을 찾을 수 없습니다: intermediate-tbody-${currentProjectId}`);
                return false;
            }
            
            const rows = intermediateTbody.querySelectorAll('tr');
            let totalFiles = 0;
            let completedFiles = 0;
            
            rows.forEach(row => {
                // tree-child는 제외하고 원본 파일과 일반 파일만 체크
                if (!row.classList.contains('tree-child')) {
                    totalFiles++;
                    
                    // 진행상태 컬럼 (마지막 컬럼) 확인
                    const progressCell = row.querySelector('td:last-child');
                    if (progressCell) {
                        const progressText = progressCell.textContent.trim();
                        if (progressText.includes('검수완료')) {
                            completedFiles++;
                        }
                    }
                }
            });
            
            console.log(`중간어 영역 검수 상태: ${completedFiles}/${totalFiles}`);
            return totalFiles > 0 && completedFiles === totalFiles;
        }
        
        // 현재 도착어 영역의 언어 정보를 가져오는 함수
        function getCurrentDestinationLanguageInfo(fileName) {
            // 도착어 영역들을 순회하며 해당 파일이 있는 언어 찾기
            const destinationLanguages = ["영어", "일본어", "중국어(간체)"];
            
            for (let langIndex = 0; langIndex < destinationLanguages.length; langIndex++) {
                const destinationTbody = document.getElementById(`destination-tbody-${langIndex}`);
                if (destinationTbody) {
                    const rows = destinationTbody.querySelectorAll('tr');
                    for (let row of rows) {
                        // 프로젝트명 컬럼이 추가되어 파일명은 두 번째 셀
                        const fileNameCell = row.querySelector('td:nth-child(2)') || row.querySelector('.file-name');
                        if (fileNameCell) {
                            const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                            if (currentFileName === fileName) {
                                return {
                                    language: destinationLanguages[langIndex],
                                    langIndex: langIndex
                                };
                            }
                        }
                    }
                }
            }
            return null;
        }
        
        // 특정 도착어 언어 영역의 모든 파일이 검수완료되었는지 확인하는 함수
        function checkAllDestinationFilesReviewComplete(langIndex) {
            const destinationTbody = document.getElementById(`destination-tbody-${langIndex}`);
            if (!destinationTbody) return false;
            
            const rows = destinationTbody.querySelectorAll('tr');
            let totalFiles = 0;
            let completedFiles = 0;
            
            rows.forEach(row => {
                // tree-child는 제외하고 원본 파일과 일반 파일만 체크
                if (!row.classList.contains('tree-child')) {
                    totalFiles++;
                    
                    // 진행상태 컬럼 (마지막 컬럼) 확인
                    const progressCell = row.querySelector('td:last-child');
                    if (progressCell) {
                        const progressText = progressCell.textContent.trim();
                        if (progressText.includes('검수완료')) {
                            completedFiles++;
                        }
                    }
                }
            });
            
            const destinationLanguages = ["영어", "일본어", "중국어(간체)"];
            console.log(`${destinationLanguages[langIndex]} 영역 검수 상태: ${completedFiles}/${totalFiles}`);
            return totalFiles > 0 && completedFiles === totalFiles;
        }
        
        function executeReview(fileName) {
            // 현재 어느 영역에서 실행되는지 확인
            const currentArea = determineCurrentArea(fileName);
            
            if (currentArea === 'source') {
                // 출발어 영역에서 검수툴 실행
                if (confirm(`${fileName} 파일의 검수툴을 실행하시겠습니까?`)) {
                    // 출발어 영역의 진행상태를 "검수완료"로 변경
                    updateSourceAreaProgressStatus(fileName, '검수완료');
                    
                    // 프로젝트 제목 가져오기
                        const projectTitle = getProjectTitleForFile(fileName);
                    
                    // 출발어 영역의 모든 파일이 검수 완료되었는지 확인
                    if (checkAllSourceFilesReviewComplete()) {
                        // 모든 파일 완료 시에만 중간어 영역 생성
                        createIntermediateLanguageAreaFromWorksby(fileName, projectTitle);
                        alert(`모든 파일의 검수가 완료되었습니다.\n중간어 영역이 생성되었습니다.`);
                    } else {
                        alert(`${fileName} 파일의 검수가 완료되었습니다.\n다른 파일들의 검수도 완료해주세요.`);
                    }
                }
            } else if (currentArea === 'intermediate') {
                // 중간어 영역에서 검수툴 실행
                if (confirm(`${fileName} 파일의 검수툴을 실행하시겠습니까?`)) {
                    // 중간어 영역의 진행상태를 "검수완료"로 변경
                    updateIntermediateAreaProgressStatus(fileName, '검수완료');
                    
                    // 프로젝트 제목 가져오기
                        const projectTitle = getProjectTitleForFile(fileName);
                    
                    // 현재 프로젝트 ID 찾기
                    const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
                    const currentProjectId = visibleProjectArea ? visibleProjectArea.id.replace('worksby-detail-area-', '') : null;
                    
                    if (!currentProjectId) {
                        console.log('현재 프로젝트 ID를 찾을 수 없습니다.');
                        alert('현재 프로젝트를 찾을 수 없습니다.');
                        return;
                    }
                    
                    // 중간어 영역의 모든 파일이 검수 완료되었는지 확인
                    if (checkAllIntermediateFilesReviewComplete()) {
                        // 모든 파일 완료 시에만 도착어 영역 생성 (프로젝트 ID 전달)
                        createDestinationLanguageAreaFromIntermediate(fileName, projectTitle, currentProjectId);
                        alert(`모든 파일의 검수가 완료되었습니다.\n모든 도착 언어별 도착어 영역이 생성되었습니다.`);
                    } else {
                        alert(`${fileName} 파일의 검수가 완료되었습니다.\n다른 파일들의 검수도 완료해주세요.`);
                    }
                }
            } else {
                // 도착어 영역에서 검수툴 실행
                if (confirm(`${fileName} 파일의 검수툴을 실행하시겠습니까?`)) {
                    // 현재 언어와 인덱스 확인
                    const currentLanguageInfo = getCurrentDestinationLanguageInfo(fileName);
                    
                    if (currentLanguageInfo) {
                        // 해당 언어 영역의 진행상태를 "검수완료"로 변경
                        updateDestinationAreaProgressStatus(fileName, currentLanguageInfo.language, currentLanguageInfo.langIndex, '검수완료');
                        
                        // 해당 언어 영역의 모든 파일이 검수 완료되었는지 확인
                        if (checkAllDestinationFilesReviewComplete(currentLanguageInfo.langIndex)) {
                            alert(`${currentLanguageInfo.language} 영역의 모든 파일 검수가 완료되었습니다!\n${currentLanguageInfo.language} 번역 작업이 완료되었습니다.`);
                        } else {
                            alert(`${fileName} 파일의 검수가 완료되었습니다.\n${currentLanguageInfo.language} 영역의 다른 파일들의 검수도 완료해주세요.`);
                        }
                    } else {
                    alert(`${fileName} 파일의 검수가 완료되었습니다.`);
                    }
                }
            }
        }
        
        // 진행 상태 업데이트 함수
        function updateProgressStatus(fileName, status, area) {
            console.log(`진행 상태 업데이트: ${fileName} → ${status} (${area})`);
            
            let tbody;
            let statusColumnIndex;
            
            if (area === 'source') {
                tbody = document.getElementById('detail-tbody');
                statusColumnIndex = 9; // 출발어 영역 진행 상태 컬럼
            } else if (area === 'intermediate') {
                tbody = document.getElementById('intermediate-tbody');
                statusColumnIndex = 10; // 중간어 영역 진행 상태 컬럼
            } else if (area === 'destination') {
                // 도착어 영역은 모든 언어별 영역 확인
                for (let i = 0; i < 3; i++) {
                    const destTbody = document.getElementById(`destination-tbody-${i}`);
                    if (destTbody) {
                        updateStatusInTbody(destTbody, fileName, status, 10);
                    }
                }
                return;
            }
            
            if (tbody) {
                updateStatusInTbody(tbody, fileName, status, statusColumnIndex);
            }
        }
        
        // 특정 테이블에서 상태 업데이트
        function updateStatusInTbody(tbody, fileName, status, columnIndex) {
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const fileNameCell = row.querySelector('.file-name');
                if (fileNameCell) {
                    const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                    
                    if (currentFileName === fileName.replace('→ ', '').replace('[분할됨]', '').trim()) {
                        const statusCell = row.querySelector(`td:nth-child(${columnIndex})`);
                        if (statusCell) {
                            const statusColor = status === '검수완료' ? '#10b981' : '#e5e7eb';
                            const textColor = status === '검수완료' ? 'white' : '#374151';
                            
                            statusCell.innerHTML = `
                                <span class="status-badge" style="background: ${statusColor}; color: ${textColor}; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                    ${status}
                                </span>
                            `;
                        }
                    }
                }
            });
        }
        
        // 특정 영역의 모든 파일이 검수 완료되었는지 확인
        function checkAllFilesReviewComplete(area) {
            console.log(`${area} 영역 검수 완료 여부 확인`);
            
            let tbody;
            let statusColumnIndex;
            
            if (area === 'source') {
                tbody = document.getElementById('detail-tbody');
                statusColumnIndex = 9;
            } else if (area === 'intermediate') {
                tbody = document.getElementById('intermediate-tbody');
                statusColumnIndex = 10;
            } else {
                return false;
            }
            
            if (!tbody) return false;
            
            const rows = tbody.querySelectorAll('tr');
            let totalFiles = 0;
            let completedFiles = 0;
            
            rows.forEach(row => {
                // 원본 파일(tree-parent)이 아닌 실제 작업 파일만 확인
                if (!row.classList.contains('tree-parent')) {
                    const statusCell = row.querySelector(`td:nth-child(${statusColumnIndex})`);
                    if (statusCell) {
                        totalFiles++;
                        const statusText = statusCell.textContent.trim();
                        if (statusText === '검수완료') {
                            completedFiles++;
                        }
                    }
                }
            });
            
            console.log(`${area} 영역: 전체 ${totalFiles}개, 완료 ${completedFiles}개`);
            return totalFiles > 0 && totalFiles === completedFiles;
        }
        
        // 파일명으로 프로젝트 제목 찾기
        function getProjectTitleForFile(fileName) {
            // 현재 선택된 템플릿에서 프로젝트 제목 가져오기
            const selectedTemplate = document.querySelector('.template-row[style*="background-color"]');
            if (selectedTemplate) {
                return selectedTemplate.getAttribute('data-project-title');
            }
            
            // 기본값
            return window.currentProjectData ? window.currentProjectData.projectTitle : '기본 프로젝트';
        }
        
        // 현재 파일이 어느 영역에 있는지 확인하는 함수
        function determineCurrentArea(fileName) {
            const cleanFileName = fileName.replace('→ ', '').replace('[분할됨]', '').trim();
            
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                return 'source'; // 기본값
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`영역 확인 - 현재 프로젝트 ID: ${currentProjectId}`);
            
            // 도착어 영역 먼저 확인 (가장 구체적)
            for (let i = 0; i < 3; i++) {
                const destinationTbody = document.getElementById(`destination-tbody-${currentProjectId}-${i}`);
                if (destinationTbody) {
                    const destinationRows = destinationTbody.querySelectorAll('tr');
                    
                    for (let row of destinationRows) {
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                            
                            if (currentFileName === cleanFileName) {
                                console.log(`파일 "${cleanFileName}"이 도착어 영역에서 발견됨`);
                                return 'destination';
                            }
                        }
                    }
                }
            }
            
            // 중간어 영역 확인 (두 번째로 구체적)
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            if (intermediateTbody) {
                const intermediateRows = intermediateTbody.querySelectorAll('tr');
                
                for (let row of intermediateRows) {
                    const fileNameCell = row.querySelector('.file-name');
                    if (fileNameCell) {
                        const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                        
                        if (currentFileName === cleanFileName) {
                            return 'intermediate';
                        }
                    }
                }
            }
            
            // 출발어 영역 확인 (가장 마지막, 가장 일반적)
            const detailTbody = document.getElementById(`detail-tbody-${currentProjectId}`);
            if (detailTbody) {
                const detailRows = detailTbody.querySelectorAll('tr');
                
                for (let row of detailRows) {
                    const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                    if (fileNameCell) {
                        const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                        
                        if (currentFileName === cleanFileName) {
                            console.log(`파일 "${cleanFileName}"이 출발어 영역에서 발견됨`);
                            return 'source';
                        }
                    }
                }
            }
            
            return 'unknown';
        }
        
        // 산출물 다운로드 모달 열기
        let currentDownloadFileName = '';
        
        function downloadOutput(fileName, outputType) {
            currentDownloadFileName = fileName;
            document.getElementById('outputDownloadModal').style.display = 'flex';
        }
        
        // 작업자 배정 함수 (작업자 관리 모달 열기)
        function assignNewWorker(fileName, projectTitle) {
            console.log('작업자 배정 모달 열기:', fileName, projectTitle);
            
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            let currentProjectId = null;
            
            if (visibleProjectArea) {
                currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            }
            
            // 선택된 파일 정보를 전역 변수에 저장
            window.selectedFileInfo = {
                fileName: fileName,
                projectTitle: projectTitle,
                currentProjectId: currentProjectId
            };
            
            console.log('저장된 파일 정보:', window.selectedFileInfo);
            
            // 작업자 관리 모달 열기
            document.getElementById('workerManagementModal').style.display = 'flex';
        }
        
        // 중간어 영역에서 웍스파이 프로젝트 생성
        function createIntermediateWorksbyProject(fileName, projectTitle) {
            console.log('중간어 영역 웍스파이 프로젝트 생성:', fileName, projectTitle);
            
            // 현재 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            const currentProjectId = visibleProjectArea ? visibleProjectArea.id.replace('worksby-detail-area-', '') : null;
            
            // 선택된 파일 정보를 전역 변수에 저장
            window.selectedFileInfo = {
                fileName: fileName,
                projectTitle: projectTitle,
                fromIntermediateArea: true,  // 중간어 영역에서 호출됨을 표시
                currentProjectId: currentProjectId
            };
            
            console.log('중간어 영역 웍스파이 프로젝트 생성 - 저장된 정보:', window.selectedFileInfo);
            
            // 웍스파이 등록 모달 열기
            openWorksbyRegistrationModal(fileName, projectTitle);
        }
        
        // 중간어 영역 웍스파이 등록 완료 후 버튼 업데이트
        function updateIntermediateWorksbyButtons(projectTitle) {
            // 현재 프로젝트 ID 가져오기
            const currentProjectId = window.selectedFileInfo?.currentProjectId;
            if (!currentProjectId) {
                console.log('현재 프로젝트 ID를 찾을 수 없습니다.');
                return;
            }
            
            console.log(`중간어 웍스파이 버튼 업데이트 - 프로젝트 ID: ${currentProjectId}`);
            
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            
            if (!intermediateTbody) {
                return;
            }
            
            const rows = intermediateTbody.querySelectorAll('tr');
            
            rows.forEach((row, index) => {
                // 원본 파일(tree-parent)은 등록 확인 버튼 업데이트 제외
                if (row.classList.contains('tree-parent')) {
                    return;
                }
                
                // 프로젝트명 컬럼 업데이트 (분할된 파일과 일반 파일 구분)
                let projectNameCell;
                if (row.classList.contains('tree-child')) {
                    // 분할된 파일의 경우 split ID로 찾기
                    const splitIndex = Array.from(intermediateTbody.querySelectorAll('tr.tree-child')).indexOf(row);
                    projectNameCell = document.getElementById(`intermediate-project-split-${splitIndex}`);
                } else {
                    // 일반 파일의 경우 기본 ID로 찾기
                    projectNameCell = document.getElementById(`intermediate-project-${index}`);
                }
                
                if (projectNameCell) {
                    projectNameCell.textContent = projectTitle;
                }
                
                // 분할된 파일인 경우와 일반 파일인 경우 ID 구분
                let registerCell;
                if (row.classList.contains('tree-child')) {
                    // 분할된 파일의 경우 split ID로 찾기
                    const splitIndex = Array.from(intermediateTbody.querySelectorAll('tr.tree-child')).indexOf(row);
                    registerCell = document.getElementById(`intermediate-register-split-${splitIndex}`);
                } else {
                    // 일반 파일의 경우 기본 ID로 찾기
                    registerCell = document.getElementById(`intermediate-register-${index}`);
                }
                
                if (registerCell) {
                    const fileName = row.querySelector('.file-name').textContent;
                    
                    registerCell.innerHTML = `
                        <button class="btn btn-success" onclick="openProjectDetailModal('${fileName}', '${projectTitle}')" 
                                style="padding: 6px 12px; font-size: 12px; margin: 0 auto; display: inline-block;">
                            <span>✅</span>
                            등록 확인
                        </button>
                    `;
                }
            });
        }
        
        // 중간어 영역 건너뛰기 함수 (프로젝트별 고유 ID 사용)
        function skipIntermediateArea(fileName, projectTitle, projectId) {
            console.log('중간어 영역 건너뛰기:', fileName, projectTitle, projectId);
            
            if (confirm('중간어를 건너뛰고 도착어 영역을 엽니다.\n출발어 > 도착어 LLM 번역을 시작합니다.')) {
                console.log('중간어 영역 건너뛰기 확인됨 - 도착어 영역 생성 시작');
                
                // 바로 도착어 영역 생성 (중간어 프로세스 건너뛰기)
                createDestinationLanguageAreaFromIntermediate(fileName, projectTitle, projectId);
                
                alert('중간어 영역을 건너뛰고 도착어 영역이 생성되었습니다.\nLLM 번역이 시작됩니다.');
            }
        }
        
        // 중간어 영역 건너뛰기 함수 (레거시 - 프로젝트 ID 없는 경우)
        function skipIntermediateAreaLegacy(fileName, projectTitle) {
            console.log('중간어 영역 건너뛰기 (레거시):', fileName, projectTitle);
            
            if (confirm('중간어를 건너뛰고 도착어 영역을 엽니다.\n출발어 > 도착어 LLM 번역을 시작합니다.')) {
                console.log('중간어 영역 건너뛰기 확인됨 - 도착어 영역 생성 시작');
                
                // 바로 도착어 영역 생성 (레거시 방식)
                createDestinationLanguageArea(fileName, projectTitle);
                
                alert('중간어 영역을 건너뛰고 도착어 영역이 생성되었습니다.\nLLM 번역이 시작됩니다.');
            }
        }
        
        // 중간어 영역 파일 분할 함수
        function splitIntermediateFile(fileName, projectTitle) {
            console.log('중간어 영역 파일 분할:', fileName, projectTitle);
            
            // 파일 분할 모달에 파일명과 파일 길이 설정
            const splitFileNameInput = document.getElementById('splitFileName');
            const splitFileLengthInput = document.getElementById('splitFileLength');
            
            if (splitFileNameInput) {
                splitFileNameInput.value = fileName.replace('[분할됨]', '').trim();
            }
            
            if (splitFileLengthInput) {
                splitFileLengthInput.value = '00:45:30'; // 기본값 또는 실제 파일 길이
            }
            
            // 분할 모달 열기
            const modal = document.getElementById('fileSplitModal');
            if (modal) {
                modal.style.display = 'flex';
                
                // 현재 프로젝트 ID 찾기
                const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
                const currentProjectId = visibleProjectArea ? visibleProjectArea.id.replace('worksby-detail-area-', '') : null;
                
                // 중간어 영역 분할임을 표시
                window.currentSplitContext = {
                    area: 'intermediate',
                    fileName: fileName,
                    projectTitle: projectTitle,
                    projectId: currentProjectId
                };
            }
        }
        
        // 웍스파이 프로젝트 삭제 함수
        function deleteWorksbyProject(projectNo, event) {
            // 이벤트 버블링 방지 (행 클릭 이벤트와 충돌 방지)
            event.stopPropagation();
            
            if (!confirm('이 웍스파이 프로젝트를 삭제하시겠습니까?\n삭제된 프로젝트는 복구할 수 없습니다.')) {
                return;
            }
            
            console.log('웍스파이 프로젝트 삭제:', projectNo);
            
            // 1. 웍스파이 프로젝트 테이블에서 해당 행 제거
            const projectsTbody = document.getElementById('worksby-projects-tbody');
            if (projectsTbody) {
                const projectRows = projectsTbody.querySelectorAll('tr');
                projectRows.forEach(row => {
                    const deleteButton = row.querySelector(`button[onclick*="${projectNo}"]`);
                    if (deleteButton) {
                        row.remove();
                        console.log('웍스파이 프로젝트 테이블에서 행 삭제됨');
                    }
                });
            }
            
            // 2. 해당 프로젝트의 상세 영역 제거
            const detailArea = document.querySelector(`[id^="worksby-detail-area-${projectNo}"]`);
            if (detailArea) {
                detailArea.remove();
                console.log('웍스파이 프로젝트 상세 영역 삭제됨');
            }
            
            // 3. 중간어 영역 제거
            const intermediateArea = document.querySelector(`[id^="intermediate-language-area-${projectNo}"]`);
            if (intermediateArea) {
                intermediateArea.remove();
                console.log('중간어 영역 삭제됨');
            }
            
            // 4. 도착어 영역 제거
            const destinationContainer = document.querySelector(`[id^="destination-container-${projectNo}"]`);
            if (destinationContainer) {
                destinationContainer.remove();
                console.log('도착어 영역 삭제됨');
            }
            
            // 5. 파일 리스트의 웍스파이 등록 상태를 "미등록"으로 변경
            updateFileListWorksbyStatus(projectNo, '미등록');
            
            // 6. 프로젝트 데이터 저장소에서 제거
            if (window.allProjectsData && window.allProjectsData[projectNo]) {
                delete window.allProjectsData[projectNo];
                console.log('프로젝트 데이터 저장소에서 제거됨:', projectNo);
            }
            
            // 7. 웍스파이 프로젝트가 모두 삭제된 경우 섹션 숨기기
            const remainingProjects = document.querySelectorAll('#worksby-projects-tbody tr');
            if (remainingProjects.length === 0) {
                const worksbySection = document.getElementById('worksby-projects-section');
                if (worksbySection) {
                    worksbySection.style.display = 'none';
                }
                console.log('모든 웍스파이 프로젝트가 삭제되어 섹션을 숨김');
            }
            
            alert('웍스파이 프로젝트가 삭제되었습니다.\n파일 리스트의 웍스파이 등록 상태가 "미등록"으로 변경되었습니다.');
        }
        
        // 파일 리스트의 웍스파이 등록 상태 업데이트 함수
        function updateFileListWorksbyStatus(projectNo, status) {
            console.log('파일 리스트 웍스파이 상태 업데이트:', projectNo, status);
            
            // 해당 프로젝트의 데이터 가져오기
            const projectData = window.allProjectsData?.[projectNo];
            if (!projectData || !projectData.selectedFiles) {
                console.log('프로젝트 데이터 또는 선택된 파일 정보를 찾을 수 없습니다:', projectNo);
                return;
            }
            
            const selectedFileIds = projectData.selectedFiles;
            console.log('삭제할 프로젝트의 선택된 파일 ID들:', selectedFileIds);
            
            // 메인 파일 리스트 테이블 찾기
            const mainFileTable = document.querySelector('.main-file-table tbody');
            if (!mainFileTable) {
                console.log('메인 파일 테이블을 찾을 수 없습니다.');
                return;
            }
            
            const rows = mainFileTable.querySelectorAll('tr');
            console.log(`메인 파일 테이블에서 ${rows.length}개의 행을 찾았습니다.`);
            
            rows.forEach((row, index) => {
                // 각 행의 data-file-id 속성 확인
                const fileId = row.getAttribute('data-file-id');
                
                // 해당 프로젝트에 포함된 파일인지 확인
                if (selectedFileIds.includes(fileId)) {
                    console.log(`프로젝트에 포함된 파일 발견: ID ${fileId}`);
                    
                    // 웍스파이 컬럼 (7번째 컬럼)
                    const worksbyCell = row.querySelector('td:nth-child(7)');
                    if (worksbyCell) {
                        const currentStatus = worksbyCell.textContent.trim();
                        console.log(`파일 ID ${fileId}: 현재 웍스파이 상태 = "${currentStatus}"`);
                        
                        // "등록" 상태인 경우만 "미등록"으로 변경
                        if (currentStatus === '등록') {
                            const statusBadge = worksbyCell.querySelector('.status-badge');
                            if (statusBadge) {
                                statusBadge.textContent = status;
                                statusBadge.style.cssText = 'background: #f3f4f6; color: #6b7280; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;';
                            } else {
                                worksbyCell.innerHTML = `<span class="status-badge" style="background: #f3f4f6; color: #6b7280; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">${status}</span>`;
                            }
                            const fileName = row.querySelector('td:nth-child(2)')?.textContent || '알 수 없는 파일';
                            console.log(`파일 웍스파이 상태 업데이트됨: ${fileName} (ID: ${fileId}) -> ${status}`);
                        }
                    }
                }
            });
        }
        
        // 출발어 영역 진행상태 업데이트 함수
        function updateSourceAreaProgressStatus(fileName, status) {
            console.log('출발어 영역 진행상태 업데이트:', fileName, status);
            
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                return;
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`현재 프로젝트 ID: ${currentProjectId}`);
            
            const detailTbody = document.getElementById(`detail-tbody-${currentProjectId}`);
            if (!detailTbody) {
                console.log(`출발어 영역 테이블을 찾을 수 없습니다: detail-tbody-${currentProjectId}`);
                return;
            }
            
            const rows = detailTbody.querySelectorAll('tr');
            rows.forEach(row => {
                // 프로젝트명 컬럼이 추가되어 파일명은 두 번째 셀
                const fileNameCell = row.querySelector('td:nth-child(2)') || row.querySelector('.file-name');
                if (fileNameCell) {
                    const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                    if (currentFileName === fileName) {
                        // 진행상태 컬럼 찾기 (마지막 컬럼)
                        const progressCell = row.querySelector('td:last-child');
                        if (progressCell) {
                            // 배지 스타일로 업데이트
                            const badgeColor = status === '검수완료' ? '#10b981' : '#6b7280';
                            progressCell.innerHTML = `<span style="background: ${badgeColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">${status}</span>`;
                            console.log(`출발어 영역 "${fileName}" 진행상태 업데이트 완료: ${status}`);
                        }
                    }
                }
            });
        }
        
        // 파일 합치기 함수 (분할된 원본 파일용)
        function mergeFiles(fileName, projectTitle) {
            console.log('파일 합치기 실행:', fileName, projectTitle);
            
            if (confirm(`${fileName} 파일의 분할된 구간들을 합치는 검수툴을 실행하시겠습니까?`)) {
                // 출발어 영역의 진행상태를 "검수완료"로 변경
                updateSourceAreaProgressStatus(fileName, '검수완료');
                
                // 중간어 영역 생성
                createIntermediateLanguageAreaFromWorksby(fileName, projectTitle);
                alert(`${fileName} 파일의 검수툴이 실행되었습니다.\n출발어 영역 진행상태가 "검수완료"로 변경되었습니다.\n중간어 영역이 생성되었습니다.`);
            }
        }
        
        // 웍스파이에서 중간어 영역 생성 함수
        function createIntermediateLanguageAreaFromWorksby(fileName, projectTitle) {
            console.log('웍스파이에서 중간어 영역 생성:', fileName, projectTitle);
            
            // 현재 표시된 프로젝트 ID 찾기
            const visibleProjectArea = document.querySelector('[id^="worksby-detail-area-"][style*="block"]');
            if (!visibleProjectArea) {
                console.log('표시된 프로젝트 영역을 찾을 수 없습니다.');
                return;
            }
            
            const currentProjectId = visibleProjectArea.id.replace('worksby-detail-area-', '');
            console.log(`중간어 영역 생성 - 현재 프로젝트 ID: ${currentProjectId}`);
            
            // 웍스파이 상세 영역에서 파일 목록 수집 (중간어 영역에서는 분할하지 않고 원본 파일만)
            const detailTbody = document.getElementById(`detail-tbody-${currentProjectId}`);
            const allFiles = [];
            let hasTreeStructure = false;
            
            if (detailTbody) {
                const rows = detailTbody.querySelectorAll('tr');
                rows.forEach(row => {
                    if (row.classList.contains('tree-parent')) {
                        hasTreeStructure = true;
                        // 분할된 파일의 경우 원본 파일명만 추가 (중간어에서는 분할하지 않음)
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const originalFileName = fileNameCell.textContent.replace('[분할됨]', '').trim();
                            allFiles.push(originalFileName);
                        }
                    } else if (!row.classList.contains('tree-child')) {
                        // 일반 파일들 (분할된 자식 파일들은 제외)
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                            allFiles.push(currentFileName);
                        }
                    }
                });
            }
            
            console.log('웍스파이 상세 영역에서 수집된 파일들:', allFiles);
            console.log('트리 구조 존재 여부:', hasTreeStructure);
            
            // 시나리오 구분
            const isMultipleFiles = allFiles.length > 1 && !hasTreeStructure;
            const isSingleFile = allFiles.length === 1 && !hasTreeStructure;
            const isSplitFile = hasTreeStructure;
            
            // 현재 프로젝트의 상세 영역 하단에 중간어 영역 추가
            const detailArea = document.getElementById(`worksby-detail-area-${currentProjectId}`);
            if (!detailArea) {
                console.log(`프로젝트 상세 영역을 찾을 수 없습니다: worksby-detail-area-${currentProjectId}`);
                return;
            }
            
            // 중간어 영역이 이미 존재하는지 확인 (프로젝트별 고유 ID)
            let intermediateArea = document.getElementById(`intermediate-language-area-${currentProjectId}`);
            if (!intermediateArea) {
                intermediateArea = document.createElement('div');
                intermediateArea.id = `intermediate-language-area-${currentProjectId}`;
                intermediateArea.style.cssText = 'margin-top: 20px;';
                detailArea.appendChild(intermediateArea);
            }
            
            // 중간어 영역 내용 생성
            intermediateArea.innerHTML = `
                <div class="work-area-container">
                    <div class="work-area-header">
                        <h2 class="work-area-title">🔄 중간어 영역</h2>
                    </div>
                    <div class="work-area-content">
                        <div style="background: #fff3cd; padding: 15px 20px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #f59e0b;">🔄 중간어 영역</h3>
                        </div>
                        <table class="file-table" style="table-layout: fixed; width: 100%; margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 16%;">프로젝트명</th>
                                    <th style="width: 21%;">파일 이름</th>
                                    <th style="width: 5%;">출발어</th>
                                    <th style="width: 5%;">중간어</th>
                                    <th style="width: 7%;">작업 시간</th>
                                    <th style="width: 7%; text-align: center;">웍스파이 등록</th>
                                    <th style="width: 10%; text-align: center;">작업자(상태)</th>
                                    <th style="width: 7%; text-align: center;">작업자 배정</th>
                                    <th style="width: 10%; text-align: center;">전사툴</th>
                                    <th style="width: 7%; text-align: center;">산출물</th>
                                    <th style="width: 5%; text-align: center;">진행상태</th>
                                </tr>
                            </thead>
                            <tbody id="intermediate-tbody-${currentProjectId}">
                                <!-- 중간어 영역 파일들이 동적으로 추가됩니다 -->
                            </tbody>
                        </table>
                        
                        <!-- 중간어 영역 버튼들 (테이블 아래) -->
                        <div style="padding: 15px 20px; border-top: 1px solid #e5e7eb; background: #f8f9fa; display: flex; justify-content: space-between; align-items: center;">
                            <!-- 왼쪽 정렬 버튼 -->
                            <div>
                                <button class="btn" onclick="skipIntermediateArea('${fileName}', '${projectTitle}', '${currentProjectId}')" 
                                        style="background: #f97316; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                                    <span>⏭️</span>
                                    중간어 영역 건너뛰기
                                </button>
                            </div>
                            
                            <!-- 오른쪽 정렬 버튼들 -->
                            <div style="display: flex; gap: 10px;">
                                ${(isSingleFile || isSplitFile) 
                                    ? `<button class="btn btn-warning" onclick="splitIntermediateFile('${fileName}', '${projectTitle}')" 
                                              style="padding: 8px 16px; font-size: 14px;">
                                          <span>✂️</span>
                                          파일 분할
                                      </button>`
                                    : ''
                                }
                                <button class="btn" onclick="createIntermediateWorksbyProject('${fileName}', '${projectTitle}')" 
                                        style="background: #8b5cf6; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                                    <span>🚀</span>
                                    웍스파이 프로젝트 생성
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 중간어 영역 파일 행들을 동적으로 추가 (원본 파일만, 분할하지 않음)
            const intermediateTbody = document.getElementById(`intermediate-tbody-${currentProjectId}`);
            if (intermediateTbody) {
                allFiles.forEach((file, index) => {
                    const row = document.createElement('tr');
                    
                    // 각 셀을 개별적으로 생성
                    const projectNameCell = document.createElement('td');
                    projectNameCell.style.textAlign = 'center';
                    projectNameCell.textContent = ''; // 초기에는 비어있음, 웍스파이 프로젝트 생성 후 채워짐
                    projectNameCell.id = 'intermediate-project-' + index;
                    
                    const fileNameCell = document.createElement('td');
                    fileNameCell.className = 'file-name';
                    fileNameCell.textContent = file;
                    
                    const sourceCell = document.createElement('td');
                    sourceCell.style.textAlign = 'center';
                    sourceCell.textContent = '한글';
                    
                    const targetCell = document.createElement('td');
                    targetCell.style.textAlign = 'center';
                    targetCell.textContent = '영어';
                    
                    const timeCell = document.createElement('td');
                    timeCell.style.textAlign = 'center';
                    timeCell.textContent = '00:45:30';
                    
                    const registerCell = document.createElement('td');
                    registerCell.style.textAlign = 'center';
                    registerCell.id = 'intermediate-register-' + index;
                    registerCell.innerHTML = '<span style="color: #9ca3af;">-</span>';
                    
                    const workerCell = document.createElement('td');
                    workerCell.style.textAlign = 'center';
                    workerCell.style.fontSize = '12px';
                    workerCell.style.color = '#6b7280';
                    workerCell.textContent = '- (대기)';
                    
                    const assignCell = document.createElement('td');
                    assignCell.style.textAlign = 'center';
                    
                    // 첫 번째 파일에만 작업자 배정 버튼 표시 (시나리오 3)
                    if (index === 0) {
                        assignCell.innerHTML = '<button class="btn" onclick="assignNewWorker(\'' + file + '\', \'' + projectTitle + '\')" style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">작업자 배정</button>';
                    } else {
                        assignCell.innerHTML = '<span style="color: #9ca3af;">-</span>';
                    }
                    
                    const toolsCell = document.createElement('td');
                    toolsCell.style.textAlign = 'center';
                    toolsCell.innerHTML = '<div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;"><button class="btn" onclick="executeTranscription(\'' + file + '\')" style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">전사툴 실행</button><button class="btn" onclick="executeReview(\'' + file + '\')" style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">검수툴 실행</button></div>';
                    
                    const outputCell = document.createElement('td');
                    outputCell.style.textAlign = 'center';
                    outputCell.innerHTML = '<button class="btn" onclick="downloadOutput(\'' + file + '\')" style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">산출물 다운로드</button>';
                    
                    const statusCell = document.createElement('td');
                    statusCell.style.textAlign = 'center';
                    statusCell.innerHTML = '<span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">대기</span>';
                    
                    // 모든 셀을 행에 추가
                    row.appendChild(projectNameCell);
                    row.appendChild(fileNameCell);
                    row.appendChild(sourceCell);
                    row.appendChild(targetCell);
                    row.appendChild(timeCell);
                    row.appendChild(registerCell);
                    row.appendChild(workerCell);
                    row.appendChild(assignCell);
                    row.appendChild(toolsCell);
                    row.appendChild(outputCell);
                    row.appendChild(statusCell);
                    
                    intermediateTbody.appendChild(row);
                });
            }
            
            console.log('중간어 영역이 생성되었습니다.');
            
            // 하단 영역을 최하단으로 이동
            ensureBottomSectionsAtEnd();
        }
        
        // 출발어 영역의 모든 웍스파이 등록 완료 여부 확인
        function checkAllRegistrationComplete() {
            console.log('웍스파이 등록 완료 여부 확인 시작');
            
            const detailTbody = document.getElementById('detail-tbody');
            if (!detailTbody) {
                console.log('출발어 영역을 찾을 수 없습니다.');
                return false;
            }
            
            const rows = detailTbody.querySelectorAll('tr');
            console.log('출발어 영역 파일 행 수:', rows.length);
            
            let incompleteFiles = [];
            
            rows.forEach((row, index) => {
                const fileNameCell = row.querySelector('.file-name');
                const registerCell = row.querySelector('td:nth-child(4)'); // 출발어 영역 웍스파이 등록 컬럼
                const button = registerCell ? registerCell.querySelector('button') : null;
                
                if (fileNameCell && button) {
                    const fileName = fileNameCell.textContent.replace('→ ', '').trim();
                    const buttonText = button.textContent.trim();
                    
                    console.log(`파일 ${index + 1}: ${fileName} - 버튼 상태: ${buttonText}`);
                    
                    // 버튼 텍스트가 "등록"인 경우 (등록 확인이 아닌 경우)
                    if (buttonText.includes('등록') && !buttonText.includes('등록 확인')) {
                        incompleteFiles.push(fileName);
                    }
                }
            });
            
            console.log('등록 미완료 파일들:', incompleteFiles);
            
            if (incompleteFiles.length > 0) {
                console.log(`등록이 완료되지 않은 파일 ${incompleteFiles.length}개 발견`);
                return false;
            }
            
            console.log('모든 파일의 웍스파이 등록이 완료되었습니다.');
            return true;
        }
        
        // 중간어 영역 생성 함수 (출발어 영역의 모든 파일 포함)
        function createIntermediateLanguageArea(fileName, projectTitle) {
            console.log('중간어 영역 생성:', fileName, projectTitle);
            
            // 출발어 영역에서 파일 목록 수집 및 시나리오 구분
            const detailTbody = document.getElementById('detail-tbody');
            const allFiles = [];
            let hasTreeStructure = false; // 분할된 파일(트리 구조)이 있는지 확인
            
            if (detailTbody) {
                const rows = detailTbody.querySelectorAll('tr');
                rows.forEach(row => {
                    if (row.classList.contains('tree-parent')) {
                        hasTreeStructure = true; // 시나리오 1: 파일 분할
                        // 분할된 파일의 경우 원본 파일명 추가
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const originalFileName = fileNameCell.textContent.replace('[분할됨]', '').trim();
                            allFiles.push(originalFileName);
                        }
                    } else if (!row.classList.contains('tree-child')) {
                        // tree-parent도 tree-child도 아닌 일반 파일들 (시나리오 2, 3)
                        const fileNameCell = row.querySelector('.file-name') || row.querySelector('td:nth-child(2)');
                        if (fileNameCell) {
                            const currentFileName = fileNameCell.textContent.replace('→ ', '').replace('[분할됨]', '').trim();
                            allFiles.push(currentFileName);
                        }
                    }
                });
            }
            
            console.log('출발어 영역에서 수집된 파일들:', allFiles);
            console.log('트리 구조 존재 여부 (분할 파일):', hasTreeStructure);
            
            // 시나리오 구분
            const isMultipleFiles = allFiles.length > 1 && !hasTreeStructure; // 시나리오 3: 복수 파일 (분할 아님)
            const isSingleFile = allFiles.length === 1 && !hasTreeStructure; // 시나리오 2: 단일 파일
            const isSplitFile = hasTreeStructure; // 시나리오 1: 분할 파일
            
            console.log(`시나리오 구분: 분할파일=${isSplitFile}, 단일파일=${isSingleFile}, 복수파일=${isMultipleFiles}`);
            
            // 출발어 영역 하단에 중간어 영역 추가
            const detailArea = document.getElementById('template-detail-area');
            if (!detailArea) return;
            
            // 중간어 영역이 이미 존재하는지 확인
            let intermediateArea = document.getElementById('intermediate-language-area');
            if (!intermediateArea) {
                intermediateArea = document.createElement('div');
                intermediateArea.id = 'intermediate-language-area';
                intermediateArea.style.cssText = 'margin-top: 20px;';
                detailArea.appendChild(intermediateArea);
            }
            
            // 중간어 영역 내용 생성
            intermediateArea.innerHTML = `
                <div class="work-area-container">
                    <div class="work-area-header">
                        <h2 class="work-area-title">🔄 중간어 영역</h2>
                    </div>
                    <div class="work-area-content">
                        <div style="background: #fff3cd; padding: 15px 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #f59e0b;">🔄 중간어 영역</h3>
                            ${(isSingleFile || isSplitFile) 
                                ? `<button class="btn btn-warning" onclick="splitIntermediateFile('${fileName}', '${projectTitle}')" 
                                          style="padding: 8px 16px; font-size: 14px;">
                                      <span>✂️</span>
                                      파일 분할
                                  </button>`
                                : ''
                            }
                        </div>
                    <table class="file-table" style="table-layout: fixed; width: 100%; margin-bottom: 0;">
                        <thead>
                            <tr>
                                <th style="width: 5%;">프로젝트명</th>
                                <th style="width: 15%;">파일 이름</th>
                                <th style="width: 8%;">출발어</th>
                                <th style="width: 8%;">중간어</th>
                                <th style="width: 9%;">작업 시간</th>
                                <th style="width: 10%; text-align: center;">웍스파이 등록</th>
                                <th style="width: 10%; text-align: center;">작업자(상태)</th>
                                <th style="width: 11%; text-align: center;">새 작업자 배정</th>
                                <th style="width: 13%; text-align: center;">전사툴</th>
                                <th style="width: 11%; text-align: center;">산출물</th>
                                <th style="width: 6%; text-align: center;">진행 상태</th>
                            </tr>
                        </thead>
                        <tbody id="intermediate-tbody">
                            <!-- 중간어 영역 파일들이 동적으로 추가됩니다 -->
                        </tbody>
                        </table>
                        
                        <!-- 중간어 영역 버튼들 (테이블 아래) -->
                        <div style="padding: 15px 20px; border-top: 1px solid #e5e7eb; background: #f8f9fa; display: flex; justify-content: space-between; align-items: center;">
                            <!-- 왼쪽 정렬 버튼 -->
                            <div>
                                <button class="btn" onclick="skipIntermediateAreaLegacy('${fileName}', '${projectTitle}')" 
                                        style="background: #f97316; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                                    <span>⏭️</span>
                                    중간어 영역 건너뛰기
                                </button>
                            </div>
                            
                            <!-- 오른쪽 정렬 버튼들 -->
                            <div style="display: flex; gap: 10px;">
                                ${(isSingleFile || isSplitFile) 
                                    ? `<button class="btn btn-warning" onclick="splitIntermediateFile('${fileName}', '${projectTitle}')" 
                                              style="padding: 8px 16px; font-size: 14px;">
                                          <span>✂️</span>
                                          파일 분할
                                      </button>`
                                    : ''
                                }
                                <button class="btn" onclick="createIntermediateWorksbyProject('${fileName}', '${projectTitle}')" 
                                        style="background: #8b5cf6; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer;">
                                    <span>🚀</span>
                                    웍스파이 프로젝트 생성
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 중간어 영역 파일 행들을 동적으로 추가
            const intermediateTbody = document.getElementById('intermediate-tbody');
            if (intermediateTbody) {
                allFiles.forEach((file, index) => {
                    const row = document.createElement('tr');
                    
                    // 각 셀을 개별적으로 생성
                    const projectNameCell = document.createElement('td');
                    projectNameCell.style.textAlign = 'center';
                    projectNameCell.textContent = ''; // 초기에는 비어있음, 웍스파이 프로젝트 생성 후 채워짐
                    projectNameCell.id = 'intermediate-project-' + index;
                    
                    const fileNameCell = document.createElement('td');
                    fileNameCell.className = 'file-name';
                    fileNameCell.textContent = file;
                    
                    const sourceCell = document.createElement('td');
                    sourceCell.style.textAlign = 'center';
                    sourceCell.textContent = '한글';
                    
                    const targetCell = document.createElement('td');
                    targetCell.style.textAlign = 'center';
                    targetCell.textContent = '영어';
                    
                    const timeCell = document.createElement('td');
                    timeCell.style.textAlign = 'center';
                    timeCell.textContent = '00:45:30';
                    
                    const registerCell = document.createElement('td');
                    registerCell.style.textAlign = 'center';
                    registerCell.id = 'intermediate-register-' + index;
                    registerCell.innerHTML = '<span style="color: #9ca3af;">-</span>';
                    
                    const workerCell = document.createElement('td');
                    workerCell.style.textAlign = 'center';
                    workerCell.style.fontSize = '12px';
                    workerCell.style.color = '#6b7280';
                    workerCell.textContent = '- (대기)';
                    
                    const assignCell = document.createElement('td');
                    assignCell.style.textAlign = 'center';
                    
                    // 첫 번째 파일에만 작업자 배정 버튼 표시 (시나리오 3)
                    if (index === 0) {
                        assignCell.innerHTML = '<button class="btn" onclick="assignNewWorker(\'' + file + '\', \'' + projectTitle + '\')" style="background: #8b5cf6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">작업자 배정</button>';
                    } else {
                        assignCell.innerHTML = '<span style="color: #9ca3af;">-</span>';
                    }
                    
                    const toolsCell = document.createElement('td');
                    toolsCell.style.textAlign = 'center';
                    toolsCell.innerHTML = '<div style="display: flex; gap: 4px; justify-content: center; flex-wrap: nowrap;"><button class="btn" onclick="executeTranscription(\'' + file + '\')" style="background: #3b82f6; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">전사툴 실행</button><button class="btn" onclick="executeReview(\'' + file + '\')" style="background: #10b981; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer;">검수툴 실행</button></div>';
                    
                    const outputCell = document.createElement('td');
                    outputCell.style.textAlign = 'center';
                    outputCell.innerHTML = '<button class="btn" onclick="downloadOutput(\'' + file + '\')" style="background: #f59e0b; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; margin: 0 auto; display: inline-block;">산출물 다운로드</button>';
                    
                    const statusCell = document.createElement('td');
                    statusCell.style.textAlign = 'center';
                    statusCell.innerHTML = '<span class="status-badge" style="background: #e5e7eb; color: #374151; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">대기</span>';
                    
                    // 모든 셀을 행에 추가
                    row.appendChild(projectNameCell);
                    row.appendChild(fileNameCell);
                    row.appendChild(sourceCell);
                    row.appendChild(targetCell);
                    row.appendChild(timeCell);
                    row.appendChild(registerCell);
                    row.appendChild(workerCell);
                    row.appendChild(assignCell);
                    row.appendChild(toolsCell);
                    row.appendChild(outputCell);
                    row.appendChild(statusCell);
                    
                    intermediateTbody.appendChild(row);
                });
            }
            
            console.log('중간어 영역이 생성되었습니다.');
            
            // 하단 영역을 최하단으로 이동
            ensureBottomSectionsAtEnd();
        }
        
        // 파일 세팅 완료 파일에서 선택 시 바로 출발어 영역 열기 (더 이상 사용하지 않음)
        function selectTemplate(projectTitle, files) {
            console.log('selectTemplate 함수 호출됨 - 파일 세팅 완료 파일 영역 제거로 인해 사용하지 않음');
            // 파일 세팅 완료 파일 영역이 제거되어 이 함수는 더 이상 사용하지 않음
        }
        
        
        
    </script>

    <!-- 프로젝트 상세정보 모달 -->
    <div id="projectDetailModal" class="modal-overlay" style="display: none;">
        <div class="modal-container detail-modal" style="max-width: 1000px; width: 95%; max-height: 95vh;">
            <div class="modal-header">
                <h2>📋 프로젝트 상세정보</h2>
                <button class="modal-close" onclick="closeProjectDetailModal()">&times;</button>
            </div>
            
            <div class="detail-content" style="padding: 24px;">
                <!-- 프로젝트 정보 제목 -->
                <div style="margin-bottom: 30px; border-bottom: 2px solid #e5e7eb; padding-bottom: 15px;">
                    <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                        📄 프로젝트 정보
                    </h2>
                </div>
                
                <!-- 프로젝트 정보 내용 -->
                <div style="min-height: 400px;">
                        <div class="detail-section" style="margin-bottom: 30px;">
                            <div class="info-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; align-items: end;">
                                <div class="info-item" style="display: flex; flex-direction: column; gap: 6px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">프로젝트번호</label>
                                    <span id="detailNo" style="font-size: 14px; color: #374151;">PJ202508060001</span>
                                </div>
                                <div class="info-item" style="display: flex; flex-direction: column; gap: 6px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">서비스</label>
                                    <span id="detailService" style="font-size: 14px; color: #374151;">소리바로</span>
                                </div>
                                <div class="info-item" style="display: flex; flex-direction: column; gap: 6px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">등록일</label>
                                    <span id="detailRegDate" style="font-size: 14px; color: #374151;">2025.08.06 09:00</span>
                                </div>
                            </div>
                            
                            <div class="info-item full-width" style="margin-bottom: 15px; grid-column: 1 / -1;">
                                <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">프로젝트명</label>
                                <h3 id="detailTitle" style="margin: 0; font-size: 18px; font-weight: 600; color: #1f2937;">정책위원회 회의록 전사 프로젝트</h3>
                            </div>
                            
                            <!-- 선택된 파일 목록 -->
                            <div class="info-item full-width" style="margin-bottom: 25px; z-index: 1; position: relative; grid-column: 1 / -1;">
                                <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">선택된 파일</label>
                                <div id="detailSelectedFilesBox" style="margin-top: 8px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 10px 12px; min-height: 72px; white-space: pre-line; color: #374151; display: flex; flex-direction: column; justify-content: center;">정책위원회_회의록_음성1.m4a (00:15:30)</div>
                            </div>
                            
                            <div class="project-summary-row" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; align-items: end; position: relative; z-index: 0;">
                                <div class="summary-item" style="flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 86px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">모집기간</label>
                                    <div class="summary-value" id="detailProjectPeriod" style="font-size: 14px; font-weight: 500; color: #1f2937; padding: 4px 0; min-width: 240px;">2025.08.06 11:00 ~ 2025.08.20 11:00</div>
                                </div>
                                <div class="summary-item" style="flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 86px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">모집상태</label>
                                    <div class="summary-value"><span id="detailRecruitStatusBadge" style="display:inline-block; background: #3b82f6; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700; min-width: 86px; text-align: center;">진행중</span></div>
                                </div>
                                <div class="summary-item" style="flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 86px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">작업기간</label>
                                    <div class="summary-value" id="detailWorkPeriod" style="font-size: 14px; font-weight: 500; color: #1f2937; padding: 4px 0; min-width: 240px;">2025.08.21 ~ 2025.09.02</div>
                                </div>
                                <div class="summary-item" style="flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 86px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">작업상태</label>
                                    <div class="summary-value"><span id="detailWorkStatusBadge" style="display:inline-block; background: #3b82f6; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700; min-width: 86px; text-align: center;">진행중</span></div>
                                </div>
                                <div class="summary-item" style="flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 86px; margin-top: 10px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">작업자 수</label>
                                    <div class="summary-value" id="detailWorkerCount" style="font-size: 14px; font-weight: 500; color: #1f2937; padding: 4px 0;">0 / 5명</div>
                                </div>
                                <div class="summary-item" style="flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 86px; margin-top: 10px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">금액</label>
                                    <div class="summary-value" id="detailBudget" style="font-size: 14px; font-weight: 500; color: #1f2937; padding: 4px 0;">500,000원</div>
                                </div>
                                <div class="summary-item" style="flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 86px; margin-top: 10px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">지원자격</label>
                                    <div class="summary-value" id="detailQualification" style="font-size: 14px; font-weight: 500; color: #1f2937; padding: 4px 0;">누구나</div>
                                </div>
                            </div>

                            <div class="info-item full-width" style="margin-bottom: 25px; grid-column: 1 / -1;">
                                <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">프로젝트 설명</label>
                                <div id="detailContent" class="content-box" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px; font-size: 14px; line-height: 1.6; color: #374151;">시급 구함<br>연습합니다.<br>구합니다. 구합니다.</div>
                            </div>
                            
                            <div class="info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div class="info-item" style="display: flex; flex-direction: column; gap: 6px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">썸네일</label>
                                    <div id="detailThumbnail" class="thumbnail-preview" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 20px; text-align: center; color: #6b7280; font-size: 14px;">이미지 없음</div>
                                </div>
                                <div class="info-item" style="display: flex; flex-direction: column; gap: 6px;">
                                    <label style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">첨부파일</label>
                                    <div id="detailAttachments" class="attachments-list" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 20px; text-align: center; color: #6b7280; font-size: 14px;">파일 없음</div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
            
            <!-- 모달 하단 버튼 -->
            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; border-top: 1px solid #e2e8f0; background: white; flex-shrink: 0;">
                <!-- 왼쪽 버튼들 -->
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn-deadline" onclick="completeProject()" style="background: #10b981; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">
                        <span>✅</span>
                        프로젝트 마감
                    </button>
                    <button type="button" class="btn-delete" onclick="deleteProject()" style="background: #ef4444; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">
                        <span>🗑️</span>
                        프로젝트 삭제
                    </button>
                </div>
                
                <!-- 오른쪽 버튼들 -->
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn-edit" onclick="editProjectDetail()" style="background: #3b82f6; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">수정</button>
                    <button type="button" class="btn-secondary" onclick="closeProjectDetailModal()" style="background: #6b7280; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 작업자 관리 모달 -->
    <div id="workerManagementModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="max-width: 1000px; width: 95%; max-height: 95vh;">
            <div class="modal-header">
                <h2>👥 작업자 관리</h2>
                <button class="modal-close" onclick="closeWorkerManagementModal()">&times;</button>
            </div>
            
            <div class="modal-content" style="padding: 24px; min-height: 400px;">
                <div class="detail-section" style="margin-bottom: 30px;">
                    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 class="section-title" style="margin: 0; font-size: 16px; font-weight: 600; color: #374151;">👥 작업자 관리</h3>
                        <div class="applicant-stats" style="display: flex; gap: 20px;">
                            <span class="stat-item" style="font-size: 14px; color: #6b7280;">총 <strong id="totalWorkersModal" style="color: #3b82f6;">5</strong>명</span>
                            <span class="stat-item" style="font-size: 14px; color: #6b7280;">배정 <strong id="assignedCountModal" style="color: #3b82f6;">1</strong>명</span>
                            <span class="stat-item" style="font-size: 14px; color: #6b7280;">미배정 <strong id="excludedCountModal" style="color: #3b82f6;">4</strong>명</span>
                        </div>
                    </div>
                    
                    <div class="applicants-table-wrapper" style="overflow-x: auto; border: 1px solid #e5e7eb; border-radius: 8px;">
                        <table class="applicants-table" style="width: 100%; border-collapse: collapse; background: white;">
                            <thead>
                                <tr>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;"><input type="checkbox" id="selectAllWorkersModal" onchange="toggleAllWorkers(this)"></th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">이름</th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">성별</th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">연락처</th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">생년월일</th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">주소</th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">한글속기자격증</th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">배정일</th>
                                    <th style="background: #f8f9fa; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; white-space: nowrap;">상태</th>
                                </tr>
                            </thead>
                            <tbody id="workersListModal">
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><input type="checkbox" name="workerSelectModal" value="1"></td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">차정훈</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">남성</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">010-1**2-3456</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1990.**.**</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">서울특별시 강남구</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1급</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">2025.08.06</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><span class="applicant-status status-approved" style="padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; white-space: nowrap; background: #dcfce7; color: #166534;">배정</span></td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><input type="checkbox" name="workerSelectModal" value="2"></td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">김민영</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">여성</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">010-2**3-4567</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1988.**.**</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">경기도 안양시</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">2급</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">-</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><span class="applicant-status status-cancelled" style="padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; white-space: nowrap; background: #fef2f2; color: #991b1b;">미배정</span></td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><input type="checkbox" name="workerSelectModal" value="3"></td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">박준호</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">남성</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">010-3**4-5678</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1985.**.**</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">부산광역시 해운대구</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1급</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">-</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><span class="applicant-status status-cancelled" style="padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; white-space: nowrap; background: #fef2f2; color: #991b1b;">미배정</span></td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><input type="checkbox" name="workerSelectModal" value="4"></td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">이수진</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">여성</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">010-4**5-6789</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1992.**.**</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">경상남도 창원시</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">-</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">-</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><span class="applicant-status status-cancelled" style="padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; white-space: nowrap; background: #fef2f2; color: #991b1b;">미배정</span></td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><input type="checkbox" name="workerSelectModal" value="5"></td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">최영수</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">남성</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">010-5**6-7890</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1987.**.**</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">인천광역시 연수구</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">1급</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;">-</td>
                                    <td style="padding: 12px; font-size: 12px; color: #6b7280; text-align: center;"><span class="applicant-status status-cancelled" style="padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; white-space: nowrap; background: #fef2f2; color: #991b1b;">미배정</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 배정/미배정 버튼 -->
                    <div class="batch-actions" style="display: flex; gap: 10px; align-items: center; margin-top: 15px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 8px; color: #6b7280; font-size: 14px;">
                            <span>선택된 작업자:</span>
                            <span id="selectedWorkerCountModal" style="font-weight: 600; color: #374151;">0명</span>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 8px;">
                            <button class="batch-btn btn-approve" onclick="batchUpdateWorkerStatusModal('assigned')" style="background: #10b981; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 13px; cursor: pointer; transition: background-color 0.2s;">
                                ✓ 배정
                            </button>
                            <button class="batch-btn btn-reject" onclick="batchUpdateWorkerStatusModal('unassigned')" style="background: #ef4444; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 13px; cursor: pointer; transition: background-color 0.2s;">
                                ✗ 미배정
                            </button>
                            <button class="batch-btn btn-manual" onclick="openManualWorkerAssignmentModal()" style="background: #3b82f6; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 13px; cursor: pointer; transition: background-color 0.2s;">
                                👤 작업자 수동 배정
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 모달 하단 버튼 -->
            <div class="modal-footer" style="display: flex; justify-content: flex-end; padding: 15px 25px; border-top: 1px solid #e2e8f0; background: white; flex-shrink: 0; gap: 10px;">
                <button type="button" class="btn-secondary" onclick="closeWorkerManagementModal()" style="background: #6b7280; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">닫기</button>
                <button type="button" class="btn-confirm" onclick="confirmWorkersModal()" style="background: #f59e0b; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">확정</button>
            </div>
        </div>
    </div>

    <!-- 세부 요청사항 & 파일공유 섹션 -->
    <div id="bottom-sections-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 25px;">
        <!-- 세부 요청사항 -->
        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 class="section-title">
                <span>📝</span>
                세부 요청사항
            </h2>
            <div style="margin-bottom: 15px;">
                <textarea id="customer-request-share" placeholder="세부 요청사항을 입력하세요..." style="width: 100%; height: 120px; padding: 15px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; line-height: 1.5; resize: none; font-family: inherit; box-sizing: border-box;"></textarea>
            </div>
            
            <div style="display: flex; justify-content: flex-end;">
                <button id="share-request-btn" onclick="shareCustomerRequest()" data-status="idle" style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;">
                    공유
                </button>
            </div>
        </div>

        <!-- 파일공유 -->
        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 class="section-title">
                <span>📁</span>
                파일공유
            </h2>
            
            <div style="margin-bottom: 15px;">
                <p style="color: #6b7280; font-size: 14px; margin: 0;">관리자/검수자/작업자 파일 공유</p>
            </div>
            
            <div style="position: relative;">
                <!-- 파일 목록 영역 -->
                <div style="background: #f8f9fa; border: 1px solid #e5e7eb; border-radius: 8px; min-height: 120px; padding: 15px; padding-bottom: 50px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 600; color: #374151;">파일 이름</span>
                    </div>
                    
                    <!-- 공유 파일 목록 -->
                    <div id="shared-files-list">
                        <div style="display: flex; align-items: center; padding: 6px 0; border-bottom: 1px solid #e5e7eb;">
                            <input type="checkbox" style="margin-right: 18px;">
                            <span style="color: #3b82f6; cursor: pointer; text-decoration: none; font-size: 12px;">소리바로_HWP_템플릿_1번(기본) (1).hwp</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 6px 0; border-bottom: 1px solid #e5e7eb;">
                            <input type="checkbox" style="margin-right: 18px;">
                            <span style="color: #3b82f6; cursor: pointer; text-decoration: none; font-size: 12px;">소리바로_HWP_템플릿_1번(기본) (2).hwp</span>
                        </div>
                    </div>
                </div>
                
                <!-- 버튼 영역 (오른쪽 하단) -->
                <div style="position: absolute; bottom: 15px; right: 15px; display: flex; gap: 8px;">
                    <button onclick="addSharedFile()" style="background: #f59e0b; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;">
                        파일추가
                    </button>
                    <button onclick="deleteSharedFile()" style="background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;">
                        삭제
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 작업 특이사항 섹션 -->
    <div class="workspy-section" id="work-notes-section" style="margin-top: 25px;">
        <h2 class="section-title">
            <span>📝</span>
            작업 특이사항
        </h2>
        
        <div style="position: relative;">
            <textarea id="work-notes" placeholder="작업과 관련된 특이사항을 입력하세요..." style="width: 100%; min-height: 150px; padding: 15px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; line-height: 1.5; resize: vertical; font-family: inherit; box-sizing: border-box;" onchange="markNotesAsModified()"></textarea>
            
            <div style="display: flex; justify-content: flex-end; margin-top: 15px;">
                <button onclick="saveWorkNotes()" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                    저장
                </button>
            </div>
        </div>
    </div>

    <!-- 작업자 수동 배정 모달 -->
    <div id="manualWorkerAssignmentModal" class="modal-overlay" style="display: none; z-index: 1300;">
        <div class="modal-container" style="max-width: 600px; width: 90%; max-height: 90vh;">
            <div class="modal-header" style="background: #5b6bc0; color: white; padding: 20px 24px; border-bottom: none;">
                <h2 style="margin: 0; font-size: 18px; font-weight: 600; color: white;">작업자 수동 배정</h2>
                <button class="modal-close" onclick="closeManualWorkerAssignmentModal()" style="color: white; background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;">&times;</button>
            </div>
            
            <div class="modal-content" style="padding: 24px; min-height: 400px;">
                <!-- 검색 영역 -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <select id="searchOption" style="padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; min-width: 120px; background: white;">
                            <option value="name">이름</option>
                            <option value="email">이메일</option>
                            <option value="phone">전화번호</option>
                        </select>
                        <input type="text" id="searchInput" placeholder="검색어를 입력하세요" 
                               style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;"
                               onkeypress="handleSearchKeypress(event)"
                               onfocus="clearSearchPlaceholder(this)"
                               onblur="restoreSearchPlaceholder(this)">
                        <button onclick="searchWorkers()" style="background: #3b82f6; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; font-weight: 500;">
                            검색
                        </button>
                    </div>
                </div>
                
                <!-- 검색 결과 영역 -->
                <div style="margin-bottom: 20px;">
                    <div style="margin-bottom: 10px; font-weight: 600; color: #374151; font-size: 14px;">
                        검색 결과 <span id="searchResultCount" style="color: #3b82f6;">1</span>명
                    </div>
                    
                    <div id="searchResults" style="border: 1px solid #e5e7eb; border-radius: 8px; background: white; min-height: 300px; max-height: 400px; overflow-y: auto;">
                        <!-- 초기 상태 메시지 -->
                        <div id="noSearchResults" style="padding: 60px 20px; text-align: center; color: #9ca3af; font-size: 14px;">
                            검색어를 입력하고 검색 버튼을 눌러주세요
                        </div>
                        
                        <!-- 검색 결과가 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
            </div>
            
            <!-- 모달 하단 버튼 -->
            <div class="modal-footer" style="display: flex; justify-content: flex-end; padding: 15px 25px; border-top: 1px solid #e2e8f0; background: white; flex-shrink: 0; gap: 10px;">
                <button type="button" onclick="closeManualWorkerAssignmentModal()" style="background: #6b7280; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">취소</button>
                <button type="button" id="assignSelectedWorkerBtn" onclick="assignSelectedWorker()" style="background: #10b981; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;" disabled>
                    선택한 작업자 배정
                </button>
            </div>
        </div>
    </div>

    <!-- 파일추가 모달 (trans-detail.html에서 가져옴) -->
    <div id="fileAddModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="max-width: 600px;">
            <div class="modal-header">
                <h2>📁 의뢰파일 추가</h2>
                <button class="modal-close" onclick="closeFileAddModal()">&times;</button>
            </div>
            
            <form class="modal-form" id="fileAddForm" style="padding: 30px;">
                <!-- 파일 정보 -->
                <div class="form-row">
                    <div class="form-group full-width">
                        <label style="margin-bottom: 15px; font-size: 16px; font-weight: 600; color: #374151;">파일 업로드</label>
                        <div class="file-upload-area" style="height: 350px; display: flex; flex-direction: column; justify-content: center; align-items: center; margin-bottom: 20px; border: 2px dashed #d1d5db; border-radius: 12px; padding: 40px 20px; text-align: center; transition: border-color 0.2s; background: #f9fafb;">
                            <div class="file-upload-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%;">
                                <div class="file-upload-icon" style="margin-bottom: 20px; font-size: 64px; color: #6b7280;">📁</div>
                                <div class="file-upload-text" style="margin-bottom: 30px;">
                                    <p style="margin: 0 0 12px 0; font-size: 18px; font-weight: 500; color: #374151;">파일을 업로드하세요</p>
                                    <p style="margin: 0; font-size: 14px; color: #6b7280; line-height: 1.5;">비디오 또는 오디오 파일을 선택해주세요</p>
                                </div>
                                <button type="button" class="file-upload-btn" onclick="document.getElementById('newFileInput').click()" style="padding: 14px 28px; font-size: 15px; font-weight: 600; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);">파일 선택</button>
                            </div>
                            <div class="file-preview" id="newFilePreview" style="display: none; position: relative; text-align: center; height: 100%; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <div id="newFileInfo" style="text-align: center;">
                                    <div style="font-size: 64px; margin-bottom: 20px; color: #10b981;">✅</div>
                                    <div id="newFileName" style="font-weight: 600; margin-bottom: 12px; font-size: 18px; color: #374151; word-break: break-all; max-width: 400px;">파일명</div>
                                    <div id="newFileSize" style="font-size: 16px; color: #6b7280; font-weight: 500;">파일 크기</div>
                                    <div style="margin-top: 20px;">
                                        <button type="button" onclick="removeNewFile()" style="background: #ef4444; color: white; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.2s;">
                                            🗑️ 파일 제거
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input type="file" id="newFileInput" accept="video/*,audio/*" style="display: none;" onchange="handleNewFileUpload(this)">
                    </div>
                </div>
                
                <div class="modal-footer" style="display: flex; justify-content: flex-end; padding: 15px 25px; border-top: 1px solid #e2e8f0; background: white; flex-shrink: 0; gap: 10px;">
                    <button type="button" class="btn-secondary" onclick="closeFileAddModal()" style="background: #6b7280; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">취소</button>
                    <button type="button" class="btn-save" onclick="addNewFile()" style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.2s;">추가</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 산출물 다운로드 모달 (trans-detail.html에서 가져옴) -->
    <div id="outputDownloadModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="max-width: 1000px; width: 95%;">
            <div class="modal-header">
                <h2>산출물 다운로드</h2>
                <button class="modal-close" onclick="closeOutputDownloadModal()">&times;</button>
            </div>
            
            <div class="modal-form" style="padding: 24px;">
                <!-- 4컬럼 그리드 레이아웃 -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; align-items: stretch;">
                    
                    <!-- TXT 컬럼 -->
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;">
                        <div style="background: #f8f9fa; padding: 12px; text-align: center; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">
                            TXT
                        </div>
                        <div style="padding: 15px; flex: 1; display: flex; flex-direction: column;">
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">빈줄</div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                        <input type="radio" name="txt-blank" value="exclude" checked>
                                        <span style="font-size: 13px; color: #6b7280;">미포함</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                        <input type="radio" name="txt-blank" value="include">
                                        <span style="font-size: 13px; color: #6b7280;">포함</span>
                                    </label>
                                </div>
                            </div>
                            <div style="flex: 1;"></div>
                        </div>
                        <div style="padding: 12px; border-top: 1px solid #e5e7eb;">
                            <button class="btn btn-primary" onclick="downloadFile('txt')" style="width: 100%; padding: 8px; font-size: 13px; display: flex; align-items: center; justify-content: center; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">다운로드</button>
                        </div>
                    </div>

                    <!-- SMI 컬럼 -->
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;">
                        <div style="background: #f8f9fa; padding: 12px; text-align: center; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">
                            SMI
                        </div>
                        <div style="padding: 15px; flex: 1; display: flex; flex-direction: column;">
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">자막위치</div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-position" value="off" checked>
                                        <span style="font-size: 13px; color: #6b7280;">OFF</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-position" value="on">
                                        <span style="font-size: 13px; color: #6b7280;">ON</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">nbsp</div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-nbsp" value="exclude" checked>
                                        <span style="font-size: 13px; color: #6b7280;">미포함</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-nbsp" value="include">
                                        <span style="font-size: 13px; color: #6b7280;">포함</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">인코딩</div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-encoding" value="utf8" checked onchange="toggleSmiTagOptions()">
                                        <span style="font-size: 13px; color: #6b7280;">UTF-8</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-encoding" value="ansi" onchange="toggleSmiTagOptions()">
                                        <span style="font-size: 13px; color: #6b7280;">ANSI</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div id="smi-tag-section" style="margin-bottom: 12px; opacity: 0.5; pointer-events: none;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">
                                    tag <span style="font-size: 11px; color: #9ca3af;">(ANSI 선택시 사용)</span>
                                </div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-tag" value="on" checked disabled>
                                        <span style="font-size: 13px; color: #6b7280;">ON</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="smi-tag" value="off" disabled>
                                        <span style="font-size: 13px; color: #6b7280;">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 12px; border-top: 1px solid #e5e7eb;">
                            <button class="btn btn-primary" onclick="downloadFile('smi')" style="width: 100%; padding: 8px; font-size: 13px; display: flex; align-items: center; justify-content: center; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">다운로드</button>
                        </div>
                    </div>

                    <!-- SRT 컬럼 -->
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;">
                        <div style="background: #f8f9fa; padding: 12px; text-align: center; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">
                            SRT
                        </div>
                        <div style="padding: 15px; flex: 1; display: flex; flex-direction: column;">
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">자막위치</div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="srt-position" value="off" checked>
                                        <span style="font-size: 13px; color: #6b7280;">OFF</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="srt-position" value="on">
                                        <span style="font-size: 13px; color: #6b7280;">ON</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">아웃싱크</div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="srt-sync" value="keep" checked>
                                        <span style="font-size: 13px; color: #6b7280;">유지</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="srt-sync" value="remove">
                                        <span style="font-size: 13px; color: #6b7280;">삭제</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 6px; font-size: 14px;">빈줄</div>
                                <div style="display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="srt-blank" value="include" checked>
                                        <span style="font-size: 13px; color: #6b7280;">포함</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px; margin: 0;">
                                        <input type="radio" name="srt-blank" value="exclude">
                                        <span style="font-size: 13px; color: #6b7280;">미포함</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 12px; border-top: 1px solid #e5e7eb;">
                            <button class="btn btn-primary" onclick="downloadFile('srt')" style="width: 100%; padding: 8px; font-size: 13px; display: flex; align-items: center; justify-content: center; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">다운로드</button>
                        </div>
                    </div>

                    <!-- 다운로드 컬럼 (VTT, Capt, HWP) -->
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;">
                        <div style="background: #f8f9fa; padding: 12px; text-align: center; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">
                            다운로드
                        </div>
                        <div style="padding: 15px; flex: 1; display: flex; flex-direction: column;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                <span style="font-weight: 500; color: #374151; font-size: 14px;">VTT</span>
                                <button class="btn btn-primary" onclick="downloadFile('vtt')" style="padding: 6px 12px; font-size: 13px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">다운로드</button>
                            </div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                <span style="font-weight: 500; color: #374151; font-size: 14px;">Capt</span>
                                <button class="btn btn-primary" onclick="downloadFile('capt')" style="padding: 6px 12px; font-size: 13px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">다운로드</button>
                            </div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                <span style="font-weight: 500; color: #374151; font-size: 14px;">HWP</span>
                                <button class="btn btn-primary" onclick="downloadFile('hwp')" style="padding: 6px 12px; font-size: 13px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">다운로드</button>
                            </div>
                            
                            <div style="flex: 1;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

