<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ê±´ í”„ë¡œì íŠ¸ ì¶”ê°€ - VOD ì‘ì—…ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            padding: 30px;
            min-height: 100vh;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .close-button {
            background: #6b7280;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .close-button:hover {
            background: #4b5563;
        }
        
        /* ê¸°ë³¸ ì •ë³´ ì˜ì—­ */
        .basic-info-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        .basic-info-header {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .basic-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
        }
        
        .basic-info-grid .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .basic-info-grid .form-group input {
            padding: 15px 20px;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            transition: all 0.2s;
            width: 100%;
            box-sizing: border-box;
        }
        
        .basic-info-grid .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        
        .basic-info-grid .form-group label {
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
        }
        
        /* í•„ìˆ˜ ì…ë ¥ í‘œì‹œ */
        .required {
            color: #ef4444;
            font-weight: 700;
            margin-left: 4px;
        }
        
        /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        .upload-header {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f9fafb;
            transition: all 0.2s;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .file-upload-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .file-upload-area.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #6b7280;
        }
        
        .upload-text {
            font-size: 16px;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-select-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-select-btn:hover {
            background: #2563eb;
        }
        
        .register-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .register-btn:hover {
            background: #059669;
        }
        
        /* í•˜ë‹¨ ë²„íŠ¼ë“¤ */
        .bottom-btn {
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */
        .excel-download-btn {
            background: #10b981;
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        .excel-download-btn:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .excel-download-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        /* ì›ìŠ¤íŒŒì´ í”„ë¡œì íŠ¸ ë“±ë¡ ë²„íŠ¼ */
        .workspy-register-btn {
            background: #7c3aed;
            color: white;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        }
        
        .workspy-register-btn:hover {
            background: #6d28d9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
        }
        
        .workspy-register-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        }
        
        /* í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
        .project-list-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        
        .list-header {
            background: #f8f9fa;
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }
        
        .list-info {
            color: #6b7280;
            font-size: 14px;
        }
        
        .project-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .project-table th,
        .project-table td {
            padding: 8px 6px;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-size: 13px;
            position: relative;
        }
        
        .project-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #d1d5db;
        }
        
        .project-table td {
            color: #6b7280;
            min-height: 35px;
        }
        
        /* ì—‘ì…€ ìŠ¤íƒ€ì¼ ì…€ */
        .editable-cell {
            cursor: cell;
            transition: all 0.1s;
            user-select: none;
            border: 1px solid #e5e7eb;
        }
        
        .editable-cell:hover {
            background: #f0f9ff;
            border-color: #93c5fd;
        }
        
        .editable-cell.selected {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            box-shadow: 0 0 0 1px #3b82f6;
        }
        
        .editable-cell.editing {
            background: white;
            border: 2px solid #10b981;
            box-shadow: 0 0 0 1px #10b981;
        }
        
        .editable-cell input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            padding: 4px 8px;
            font-size: 13px;
            color: #374151;
            text-align: center;
            outline: none;
        }
        
        .editable-cell textarea {
            width: 100%;
            min-height: 60px;
            border: none;
            background: transparent;
            padding: 4px 8px;
            font-size: 13px;
            color: #374151;
            text-align: left;
            outline: none;
            resize: vertical;
            font-family: inherit;
            line-height: 1.4;
        }
        
        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-ready {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ë„ì›€ë§ */
        .cell-navigator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #374151;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .cell-navigator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            body {
                padding: 20px;
            }
            
            .cell-navigator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1 class="page-title">
            <span>ğŸ“</span>
            VOD ë‹¤ê±´ í”„ë¡œì íŠ¸ ì¶”ê°€
        </h1>
        <button class="close-button" onclick="closeWindow()">
            <span>âœ•</span>
            ë‹«ê¸°
        </button>
    </div>
    
    <!-- ê¸°ë³¸ ì •ë³´ ì˜ì—­ -->
    <div class="basic-info-section">
        <div class="basic-info-header">
            <span>ğŸ“‹</span>
            ê¸°ë³¸ ì •ë³´
        </div>
        
        <div class="basic-info-grid">
            <div class="form-group">
                <label for="projectTitle">í”„ë¡œì íŠ¸ ì œëª© <span class="required">*</span></label>
                <input type="text" id="projectTitle" placeholder="í”„ë¡œì íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
            <div class="form-group">
                <label for="companyName">ì—…ì²´ëª… <span class="required">*</span></label>
                <select id="companyName" required style="padding: 15px 20px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 16px; background: white; transition: all 0.2s; width: 100%; box-sizing: border-box; cursor: pointer;">
                    <option value="">ì—…ì²´ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ì„œìš¸ëŒ€í•™êµ">ì„œìš¸ëŒ€í•™êµ</option>
                    <option value="ì—°ì„¸ëŒ€í•™êµ">ì—°ì„¸ëŒ€í•™êµ</option>
                    <option value="ê³ ë ¤ëŒ€í•™êµ">ê³ ë ¤ëŒ€í•™êµ</option>
                    <option value="ì„±ê· ê´€ëŒ€í•™êµ">ì„±ê· ê´€ëŒ€í•™êµ</option>
                    <option value="í•œì–‘ëŒ€í•™êµ">í•œì–‘ëŒ€í•™êµ</option>
                    <option value="ì¤‘ì•™ëŒ€í•™êµ">ì¤‘ì•™ëŒ€í•™êµ</option>
                    <option value="ê²½í¬ëŒ€í•™êµ">ê²½í¬ëŒ€í•™êµ</option>
                    <option value="ì´í™”ì—¬ìëŒ€í•™êµ">ì´í™”ì—¬ìëŒ€í•™êµ</option>
                    <option value="ì„œê°•ëŒ€í•™êµ">ì„œê°•ëŒ€í•™êµ</option>
                    <option value="ë™êµ­ëŒ€í•™êµ">ë™êµ­ëŒ€í•™êµ</option>
                    <option value="í™ìµëŒ€í•™êµ">í™ìµëŒ€í•™êµ</option>
                    <option value="ê±´êµ­ëŒ€í•™êµ">ê±´êµ­ëŒ€í•™êµ</option>
                    <option value="êµ­ë¯¼ëŒ€í•™êµ">êµ­ë¯¼ëŒ€í•™êµ</option>
                    <option value="ì„¸ì¢…ëŒ€í•™êµ">ì„¸ì¢…ëŒ€í•™êµ</option>
                    <option value="ë‹¨êµ­ëŒ€í•™êµ">ë‹¨êµ­ëŒ€í•™êµ</option>
                    <option value="ì¹´ì´ìŠ¤íŠ¸">ì¹´ì´ìŠ¤íŠ¸</option>
                    <option value="í¬ìŠ¤í…">í¬ìŠ¤í…</option>
                    <option value="GIST">GIST</option>
                    <option value="UNIST">UNIST</option>
                    <option value="DGIST">DGIST</option>
                    <option value="ë¶€ì‚°ëŒ€í•™êµ">ë¶€ì‚°ëŒ€í•™êµ</option>
                    <option value="ì „ë‚¨ëŒ€í•™êµ">ì „ë‚¨ëŒ€í•™êµ</option>
                    <option value="ê²½ë¶ëŒ€í•™êµ">ê²½ë¶ëŒ€í•™êµ</option>
                    <option value="ì¶©ë‚¨ëŒ€í•™êµ">ì¶©ë‚¨ëŒ€í•™êµ</option>
                    <option value="ì „ë¶ëŒ€í•™êµ">ì „ë¶ëŒ€í•™êµ</option>
                    <option value="ê°•ì›ëŒ€í•™êµ">ê°•ì›ëŒ€í•™êµ</option>
                    <option value="ì œì£¼ëŒ€í•™êµ">ì œì£¼ëŒ€í•™êµ</option>
                    <option value="ì¸í•˜ëŒ€í•™êµ">ì¸í•˜ëŒ€í•™êµ</option>
                    <option value="ì•„ì£¼ëŒ€í•™êµ">ì•„ì£¼ëŒ€í•™êµ</option>
                    <option value="ê°€ì²œëŒ€í•™êµ">ê°€ì²œëŒ€í•™êµ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="clientName">ì˜ë¢°ìëª… <span class="required">*</span></label>
                <input type="text" id="clientName" placeholder="ì˜ë¢°ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
        </div>
    </div>
    
    <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
    <div class="upload-section">
        <div class="upload-header">
            <span>ğŸ“¤</span>
            íŒŒì¼ ì—…ë¡œë“œ
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
            <!-- ì™¼ìª½: ë“œë˜ê·¸ ì—…ë¡œë“œ ì˜ì—­ -->
            <div>
                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()" 
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
            <div class="upload-icon">ğŸ“</div>
            <div class="upload-text">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</div>
        </div>
        
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
                
                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <button class="file-select-btn" onclick="simulateFileSelect()">
                <span>ğŸ“‚</span>
                íŒŒì¼ ì„ íƒ
            </button>
                    
                    <button class="register-btn" onclick="simulateRegisterProjects()">
                <span>âœ…</span>
                ë“±ë¡
            </button>
        </div>
    </div>
    
            <!-- ì˜¤ë¥¸ìª½: ì—…ë¡œë“œëœ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ -->
            <div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb; height: 100%;">
                    <div style="font-weight: 600; color: #374151; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ“‹</span>
                        ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ (<span id="uploadedFileCount">0</span>ê°œ)
                    </div>
                    
                    <div id="uploadedFileList" style="max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; color: #6b7280; padding: 40px 20px; font-style: italic;">
                            ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
    <div class="project-list-section">
        <div class="list-header">
            <h2 class="list-title">í”„ë¡œì íŠ¸ ëª©ë¡</h2>
            <div class="list-info">ì´ <span id="projectCount">0</span>ê±´</div>
        </div>
        
        <div style="overflow-x: auto;">
            <table class="project-table">
                <thead>
                    <tr>
                        <th width="50">NO</th>
                        <th width="120">ì„œë¹„ìŠ¤</th>
                        <th width="200">íŒŒì¼ì´ë¦„</th>
                        <th width="100">ì‘ì—…ì‹œê°„</th>
                        <th width="250">ì œëª©</th>
                        <th width="80">ì§€ì›ìê²©</th>
                        <th width="160">ëª¨ì§‘ê¸°ê°„ ì‹œì‘</th>
                        <th width="160">ëª¨ì§‘ê¸°ê°„ ì¢…ë£Œ</th>
                        <th width="80">ëª¨ì§‘ì¸ì›</th>
                        <th width="120">ì‘ì—…ê¸°ê°„ ì‹œì‘</th>
                        <th width="120">ì‘ì—…ê¸°ê°„ ì¢…ë£Œ</th>
                        <th width="100">ê¸ˆì•¡</th>
                        <th width="250">ë‚´ìš©</th>
                    </tr>
                </thead>
                <tbody id="projectTableBody">
                    <tr>
                        <td colspan="13" style="padding: 40px; color: #6b7280; font-style: italic;">
                            ì—…ë¡œë“œëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ -->
        <div style="padding: 20px 25px; border-top: 1px solid #e5e7eb; background: #f8f9fa; display: flex; justify-content: flex-end; gap: 15px;">
            <button class="bottom-btn excel-download-btn" onclick="downloadProjectsAsExcel()">
                <span>ğŸ“Š</span>
                ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
            </button>
            <button class="bottom-btn workspy-register-btn" onclick="registerToWorkspy()">
                <span>ğŸš€</span>
                ì›ìŠ¤íŒŒì´ í”„ë¡œì íŠ¸ ë“±ë¡
            </button>
        </div>
    </div>
    
    <!-- í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ë„ì›€ë§ -->
    <div id="cellNavigator" class="cell-navigator">
        <div><strong>ì—‘ì…€ ìŠ¤íƒ€ì¼ í¸ì§‘:</strong></div>
        <div>í™”ì‚´í‘œ: ì…€ ì´ë™ | Enter/F2: í¸ì§‘ | Tab: ë‹¤ìŒ ì…€ | Del: ì‚­ì œ</div>
        <div>Shift+í´ë¦­: ë²”ìœ„ì„ íƒ | Ctrl+C: ë³µì‚¬ | Ctrl+V: ë¶™ì—¬ë„£ê¸° | Alt+Enter: ì¤„ë°”ê¿ˆ(ë‚´ìš©)</div>
    </div>

    <script>
        let uploadedProjects = [];
        let currentSelectedCell = null;
        let isEditing = false;
        let selectedRange = [];
        
        // ì°½ ë‹«ê¸°
        function closeWindow() {
            if (confirm('ì°½ì„ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.close();
            }
        }
        
        // íŒŒì¼ ì„ íƒ ì‹œë®¬ë ˆì´ì…˜ (ê¸°íšìš©)
        function simulateFileSelect() {
            // 20ê°œ íŒŒì¼ì´ ì„ íƒëœ ê²ƒì²˜ëŸ¼ ì‹œë®¬ë ˆì´ì…˜
            const mockFileNames = [
                'video_001_lecture.mp4',
                'video_002_seminar.mp4', 
                'video_003_workshop.mp4',
                'video_004_conference.mp4',
                'video_005_presentation.mp4',
                'video_006_training.mp4',
                'video_007_meeting.mp4',
                'video_008_discussion.mp4',
                'video_009_interview.mp4',
                'video_010_tutorial.mp4',
                'video_011_webinar.mp4',
                'video_012_demonstration.mp4',
                'video_013_review.mp4',
                'video_014_analysis.mp4',
                'video_015_summary.mp4',
                'video_016_conclusion.mp4',
                'video_017_overview.mp4',
                'video_018_introduction.mp4',
                'video_019_case_study.mp4',
                'video_020_final_session.mp4'
            ];
            
            // ë“œë˜ê·¸ ì˜ì—­ ìŠ¤íƒ€ì¼ ë³€ê²½
            const uploadArea = document.querySelector('.file-upload-area');
            uploadArea.style.background = '#dcfce7';
            uploadArea.style.borderColor = '#10b981';
            uploadArea.querySelector('.upload-text').textContent = `${mockFileNames.length}ê°œì˜ íŒŒì¼ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`;
            
            // ì „ì—­ ë³€ìˆ˜ì— íŒŒì¼ëª… ì €ì¥
            window.selectedFileNames = mockFileNames;
            
            // íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateUploadedFileList(mockFileNames);
            
            alert(`${mockFileNames.length}ê°œì˜ íŒŒì¼ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì—…ë¡œë“œëœ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateUploadedFileList(fileNames) {
            const fileListContainer = document.getElementById('uploadedFileList');
            const fileCountElement = document.getElementById('uploadedFileCount');
            
            if (!fileNames || fileNames.length === 0) {
                fileListContainer.innerHTML = `
                    <div style="text-align: center; color: #6b7280; padding: 40px 20px; font-style: italic;">
                        ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                fileCountElement.textContent = '0';
                return;
            }
            
            // íŒŒì¼ë³„ ëœë¤ ì‘ì—…ì‹œê°„ ìƒì„± (ê³ ì •ê°’ìœ¼ë¡œ ì €ì¥)
            if (!window.fileWorkTimes) {
                window.fileWorkTimes = {};
            }
            
            const fileListHTML = fileNames.map((fileName, index) => {
                // ê¸°ì¡´ì— ìƒì„±ëœ ì‘ì—…ì‹œê°„ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                if (!window.fileWorkTimes[fileName]) {
                    const workMinutes = Math.floor(Math.random() * 170) + 10;
                    const workHours = Math.floor(workMinutes / 60);
                    const remainingMinutes = workMinutes % 60;
                    window.fileWorkTimes[fileName] = `${String(workHours).padStart(2, '0')}:${String(remainingMinutes).padStart(2, '0')}:00`;
                }
                
                const workTime = window.fileWorkTimes[fileName];
                
                return `
                    <div style="display: flex; align-items: center; padding: 8px 12px; background: white; border-radius: 6px; margin-bottom: 6px; border: 1px solid #e5e7eb;">
                        <div style="width: 30px; text-align: center; font-weight: 600; color: #374151; font-size: 12px;">
                            ${index + 1}
                        </div>
                        <div style="flex: 1; margin: 0 10px; text-align: center;">
                            <div style="font-weight: 500; color: #374151; font-size: 13px; margin-bottom: 2px;">
                                ${fileName}
                            </div>
                        </div>
                        <div style="width: 70px; text-align: center; font-weight: 600; color: #059669; font-size: 12px;">
                            ${workTime.substring(0, 5)}
                        </div>
                        <div style="width: 20px; text-align: center; margin-left: 8px;">
                            <button onclick="removeIndividualFile(${index})" style="background: #ef4444; color: white; border: none; border-radius: 50%; width: 18px; height: 18px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" 
                                    onmouseover="this.style.background='#dc2626'" 
                                    onmouseout="this.style.background='#ef4444'">
                                âœ•
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            fileListContainer.innerHTML = `
                <!-- í—¤ë” -->
                <div style="display: flex; align-items: center; padding: 8px 12px; background: #e5e7eb; border-radius: 6px; margin-bottom: 10px; font-weight: 600; color: #374151; font-size: 12px;">
                    <div style="width: 30px; text-align: center;">NO</div>
                    <div style="flex: 1; margin: 0 10px; text-align: center;">íŒŒì¼ì´ë¦„</div>
                    <div style="width: 70px; text-align: center;">ì‘ì—…ì‹œê°„</div>
                    <div style="width: 20px; text-align: center;"></div>
                </div>
                ${fileListHTML}
            `;
            
            fileCountElement.textContent = fileNames.length;
        }
        
        // ë“±ë¡ ì‹œë®¬ë ˆì´ì…˜ (ê¸°íšìš©)
        function simulateRegisterProjects() {
            // íŒŒì¼ ì„ íƒ ì—¬ë¶€ë§Œ ê²€ì¦
            if (!window.selectedFileNames || window.selectedFileNames.length === 0) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // 20ê°œ í”„ë¡œì íŠ¸ ë°ì´í„° ìƒì„±
            const projects = window.selectedFileNames.map((fileName, index) => {
                const workTime = window.fileWorkTimes[fileName] || '01:00:00';
                
                return {
                    service: 'ì†Œë¦¬ë°”ë¡œ-VOD',
                    fileName: fileName,
                    workTime: workTime,
                    title: `VOD_(ìë§‰) / ì¬íƒ / ${workTime.substring(0, 5)}`,
                    qualification: '',
                    recruitStart: '',
                    recruitEnd: '',
                    recruitCount: '',
                    workStart: '',
                    workEnd: '',
                    amount: '',
                    content: ''
                };
            });
            
            uploadedProjects = projects;
            updateProjectList();
            
            alert(`${projects.length}ê°œì˜ í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì—‘ì…€ì²˜ëŸ¼ ì…€ì„ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
        }
        
        // í”„ë¡œì íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateProjectList() {
            const tbody = document.getElementById('projectTableBody');
            
            if (uploadedProjects.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="13" style="padding: 40px; color: #6b7280; font-style: italic;">
                            ì—…ë¡œë“œëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = uploadedProjects.map((project, index) => {
                    const serviceClass = project.service.includes('VOD') ? 'status-ready' : 'status-pending';
                    return `
                        <tr>
                            <td>${index + 1}</td>
                            <td><span class="status-badge ${serviceClass}">${project.service}</span></td>
                            <td class="editable-cell">${project.fileName}</td>
                            <td class="editable-cell">${project.workTime}</td>
                            <td class="editable-cell">${project.title}</td>
                            <td class="editable-cell">${project.qualification}</td>
                            <td class="editable-cell">${project.recruitStart}</td>
                            <td class="editable-cell">${project.recruitEnd}</td>
                            <td class="editable-cell">${project.recruitCount}</td>
                            <td class="editable-cell">${project.workStart}</td>
                            <td class="editable-cell">${project.workEnd}</td>
                            <td class="editable-cell">${project.amount}</td>
                            <td class="editable-cell">${project.content}</td>
                    </tr>
                    `;
                }).join('');
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡
                setTimeout(() => {
                    document.querySelectorAll('.editable-cell').forEach(cell => {
                        cell.addEventListener('click', function(e) {
                            handleCellClick(this, e);
                        });
                        cell.addEventListener('dblclick', function(e) {
                            e.preventDefault();
                            startEditing(this);
                        });
                    });
                }, 100);
            }
            
            // í”„ë¡œì íŠ¸ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('projectCount').textContent = uploadedProjects.length;
        }
        
        // ì›ìŠ¤íŒŒì´ í”„ë¡œì íŠ¸ ë“±ë¡
        function registerToWorkspy() {
            if (uploadedProjects.length === 0) {
                alert('ë“±ë¡í•  í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê¸°ë³¸ ì •ë³´ ê²€ì¦
            const projectTitle = document.getElementById('projectTitle').value.trim();
            const companyName = document.getElementById('companyName').value;
            const clientName = document.getElementById('clientName').value.trim();
            
            if (!projectTitle) {
                alert('í”„ë¡œì íŠ¸ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('projectTitle').focus();
                return;
            }
            
            if (!companyName) {
                alert('ì—…ì²´ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                document.getElementById('companyName').focus();
                return;
            }
            
            if (!clientName) {
                alert('ì˜ë¢°ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('clientName').focus();
                return;
            }
            
            // ì›ìŠ¤íŒŒì´ ë“±ë¡ í™•ì¸
            if (confirm(`${uploadedProjects.length}ê°œì˜ í”„ë¡œì íŠ¸ë¥¼ ì›ìŠ¤íŒŒì´ì— ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në“±ë¡ í›„ì—ëŠ” ì›ìŠ¤íŒŒì´ í”Œë«í¼ì—ì„œ ì‘ì—…ì ëª¨ì§‘ì´ ì‹œì‘ë©ë‹ˆë‹¤.`)) {
                // ë¶€ëª¨ ì°½ì— í”„ë¡œì íŠ¸ ì¶”ê°€
                addProjectsToParentPage(projectTitle, companyName, clientName);
                
                // ë“±ë¡ ì²˜ë¦¬
                setTimeout(() => {
                    alert(`ğŸ‰ ì„±ê³µ!\n\n${uploadedProjects.length}ê°œì˜ í”„ë¡œì íŠ¸ê°€ ì›ìŠ¤íŒŒì´ì— ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nâ€¢ í”„ë¡œì íŠ¸ ë“±ë¡ ì™„ë£Œ\nâ€¢ ì‘ì—…ì ëª¨ì§‘ ì‹œì‘\nâ€¢ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì§„í–‰ìƒí™© í™•ì¸ ê°€ëŠ¥\nâ€¢ VOD ì‘ì—…ê´€ë¦¬ í˜ì´ì§€ì— í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    
                    // ë“±ë¡ ì™„ë£Œ í›„ ë°ì´í„° ì´ˆê¸°í™”
                    uploadedProjects = [];
                    updateProjectList();
                    
                    // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
                    currentSelectedCell = null;
                    selectedRange = [];
                    
                    // ê¸°ë³¸ ì •ë³´ë„ ì´ˆê¸°í™”
                    document.getElementById('projectTitle').value = '';
                    document.getElementById('companyName').value = '';
                    document.getElementById('clientName').value = '';
                    
                    // íŒŒì¼ ì •ë³´ë„ ì´ˆê¸°í™”
                    removeFile();
                    
                    // ì°½ ë‹«ê¸° ì˜µì…˜
                    setTimeout(() => {
                        if (confirm('ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì°½ì„ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            if (window.opener && !window.opener.closed) {
                                window.opener.focus();
                            }
                            window.close();
                        }
                    }, 500);
                }, 1000);
            }
        }
        
        // ë¶€ëª¨ í˜ì´ì§€ì— í”„ë¡œì íŠ¸ ì¶”ê°€
        function addProjectsToParentPage(projectTitle, companyName, clientName) {
            try {
                const projectsToAdd = uploadedProjects.map((project, index) => {
                    const projectNumber = String(uploadedProjects.length - index).padStart(2, '0');
                    const generatedTitle = `${projectTitle}_${projectNumber}`;
                    
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds() + index).padStart(2, '0');
                    const orderNumber = `${year}${month}${day}${hours}${minutes}${seconds}`;
                    
                    const today = `${year}-${month}-${day} ${hours}:${minutes}`;
                    
                    return {
                        orderNumber: orderNumber,
                        title: generatedTitle,
                        companyName: companyName,
                        clientName: clientName,
                        requestDate: today,
                        workTime: project.workTime,
                        status: 'ì ‘ìˆ˜'
                    };
                });
                
                localStorage.setItem('bulkProjectsData', JSON.stringify(projectsToAdd));
                localStorage.setItem('bulkProjectsAdded', 'true');
                
                if (window.opener && !window.opener.closed) {
                    if (typeof window.opener.checkForBulkProjects === 'function') {
                        window.opener.checkForBulkProjects();
                    }
                    window.opener.focus();
                }
                
            } catch (error) {
                console.error('ë°ì´í„° ì „ë‹¬ ì‹¤íŒ¨:', error);
            }
        }
        
        // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
        function downloadProjectsAsExcel() {
            if (uploadedProjects.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            alert(`ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ\n\n${uploadedProjects.length}ê°œì˜ í”„ë¡œì íŠ¸ ë°ì´í„°ë¥¼ ì—‘ì…€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.`);
        }
        
        // ê°œë³„ íŒŒì¼ ì‚­ì œ
        function removeIndividualFile(index) {
            if (!window.selectedFileNames || window.selectedFileNames.length === 0) return;
            
            window.selectedFileNames.splice(index, 1);
            updateUploadedFileList(window.selectedFileNames);
            
            if (window.selectedFileNames.length === 0) {
                const uploadArea = document.querySelector('.file-upload-area');
                uploadArea.style.background = '#f9fafb';
                uploadArea.style.borderColor = '#d1d5db';
                uploadArea.querySelector('.upload-text').textContent = 'íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”';
                
                uploadedProjects = [];
                updateProjectList();
            }
        }
        
        // ì „ì²´ íŒŒì¼ ì œê±°
        function removeFile() {
            document.getElementById('fileInput').value = '';
            uploadedProjects = [];
            window.selectedFileNames = [];
            window.fileWorkTimes = {};
            
            const uploadArea = document.querySelector('.file-upload-area');
            uploadArea.style.background = '#f9fafb';
            uploadArea.style.borderColor = '#d1d5db';
            uploadArea.querySelector('.upload-text').textContent = 'íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”';
            
            updateUploadedFileList([]);
            updateProjectList();
        }
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì²˜ë¦¬
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }
        
        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }
        
        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            simulateFileSelect();
        }
        
        function handleFileSelect(event) {
            simulateFileSelect();
        }
        
        // ì—‘ì…€ ìŠ¤íƒ€ì¼ í¸ì§‘ ê¸°ëŠ¥ë“¤ (trans-bulk-project-add.htmlê³¼ ë™ì¼)
        function handleCellClick(cell, event) {
            event.preventDefault();
            event.stopPropagation();
            
            if (isEditing) return;
            
            if (event.shiftKey && currentSelectedCell) {
                selectCellRange(currentSelectedCell, cell);
            } else {
                selectSingleCell(cell);
            }
        }
        
        function selectSingleCell(cell) {
            document.querySelectorAll('.editable-cell').forEach(c => {
                c.classList.remove('selected');
            });
            selectedRange = [];
            
            currentSelectedCell = cell;
            cell.classList.add('selected');
            selectedRange = [cell];
            
            showNavigationHelp();
        }
        
        function startEditing(cell) {
            if (isEditing) return;
            
            isEditing = true;
            cell.classList.add('editing');
            cell.classList.remove('selected');
            
            const originalValue = cell.textContent.trim();
            const cellIndex = Array.from(cell.closest('tr').children).indexOf(cell);
            const isContentColumn = cellIndex === 12;
            
            const inputElement = isContentColumn ? document.createElement('textarea') : document.createElement('input');
            
            if (!isContentColumn) {
                inputElement.type = 'text';
            }
            inputElement.value = originalValue;
            
            function finishEditing(save = true) {
                const newValue = save ? inputElement.value.trim() : originalValue;
                
                if (isContentColumn) {
                    cell.innerHTML = newValue.replace(/\n/g, '<br>') || originalValue;
                } else {
                    cell.textContent = newValue || originalValue;
                }
                
                cell.classList.remove('editing');
                cell.classList.add('selected');
                isEditing = false;
                
                if (save && newValue !== originalValue) {
                    updateProjectData(cell, newValue || originalValue);
                }
            }
            
            inputElement.onblur = () => finishEditing(true);
            inputElement.onkeydown = function(e) {
                e.stopPropagation();
                
                if (e.key === 'Enter') {
                    if (e.altKey && isContentColumn) {
                        // Alt + Enter: ì¤„ë°”ê¿ˆ (ë‚´ìš© ì»¬ëŸ¼ë§Œ)
                        const cursorPos = inputElement.selectionStart;
                        const textBefore = inputElement.value.substring(0, cursorPos);
                        const textAfter = inputElement.value.substring(cursorPos);
                        inputElement.value = textBefore + '\n' + textAfter;
                        inputElement.selectionStart = inputElement.selectionEnd = cursorPos + 1;
                    } else {
                        // ì¼ë°˜ Enter: í¸ì§‘ ì™„ë£Œ
                        finishEditing(true);
                        moveToNextCell(cell, 'down');
                    }
                } else if (e.key === 'Escape') {
                    finishEditing(false);
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    finishEditing(true);
                    moveToNextCell(cell, e.shiftKey ? 'left' : 'right');
                }
            };
            
            cell.innerHTML = '';
            cell.appendChild(inputElement);
            inputElement.focus();
            inputElement.select();
        }
        
        function updateProjectData(cell, newValue) {
            const row = cell.closest('tr');
            const rowIndex = Array.from(row.parentElement.children).indexOf(row);
            const cellIndex = Array.from(row.children).indexOf(cell);
            
            if (uploadedProjects[rowIndex]) {
                const fieldMap = {
                    2: 'fileName',
                    3: 'workTime',
                    4: 'title',
                    5: 'qualification',
                    6: 'recruitStart',
                    7: 'recruitEnd',
                    8: 'recruitCount',
                    9: 'workStart',
                    10: 'workEnd',
                    11: 'amount',
                    12: 'content'
                };
                
                const fieldName = fieldMap[cellIndex];
                if (fieldName) {
                    uploadedProjects[rowIndex][fieldName] = newValue;
                    
                    // ì‘ì—…ì‹œê°„ì´ ë³€ê²½ë˜ë©´ ì œëª©ë„ ìë™ ì—…ë°ì´íŠ¸
                    if (fieldName === 'workTime') {
                        // ì‹œ:ë¶„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (HH:MM:SS â†’ HH:MM)
                        const timeForTitle = newValue.includes(':') ? newValue.substring(0, 5) : newValue;
                        const newTitle = `VOD_(ìë§‰) / ì¬íƒ / ${timeForTitle}`;
                        uploadedProjects[rowIndex]['title'] = newTitle;
                        
                        // ì œëª© ì…€ë„ í™”ë©´ì— ì—…ë°ì´íŠ¸
                        const titleCell = row.children[4];
                        if (titleCell) {
                            titleCell.textContent = newTitle;
                        }
                    }
                    
                    // ì²« ë²ˆì§¸ í–‰ì˜ íŠ¹ì • ì»¬ëŸ¼ë“¤ì´ ìˆ˜ì •ë˜ë©´ í•´ë‹¹ ì»¬ëŸ¼ì˜ ëª¨ë“  í–‰ì— ê°™ì€ ê°’ ì ìš©
                    const autoFillColumns = ['qualification', 'recruitStart', 'recruitEnd', 'recruitCount', 'workStart', 'workEnd', 'amount', 'content'];
                    
                    if (rowIndex === 0 && autoFillColumns.includes(fieldName) && newValue.trim() !== '') {
                        // ì²« ë²ˆì§¸ í–‰ì—ì„œ í•´ë‹¹ ì»¬ëŸ¼ì„ ìˆ˜ì •í•œ ê²½ìš°
                        fillColumnWithValue(cellIndex, fieldName, newValue);
                        
                        alert(`"${getColumnName(cellIndex)}" ì»¬ëŸ¼ì˜ ëª¨ë“  í–‰ì´ "${newValue}"ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.`);
                    }
                    
                    console.log(`ì—…ë°ì´íŠ¸ë¨: ${fieldName} = ${newValue}`);
                }
            }
        }
        
        // ì»¬ëŸ¼ ì „ì²´ë¥¼ ê°™ì€ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°
        function fillColumnWithValue(cellIndex, fieldName, value) {
            // ë°ì´í„° ì—…ë°ì´íŠ¸
            uploadedProjects.forEach((project, index) => {
                if (index > 0) { // ì²« ë²ˆì§¸ í–‰ì€ ì´ë¯¸ ìˆ˜ì •ë¨
                    project[fieldName] = value;
                }
            });
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            const table = document.querySelector('.project-table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            
            rows.forEach((row, index) => {
                if (index > 0) { // ì²« ë²ˆì§¸ í–‰ì€ ì´ë¯¸ ìˆ˜ì •ë¨
                    const cell = row.children[cellIndex];
                    if (cell && cell.classList.contains('editable-cell')) {
                        if (fieldName === 'content') {
                            // ë‚´ìš© ì»¬ëŸ¼ì€ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                            cell.innerHTML = value.replace(/\n/g, '<br>');
                        } else {
                            cell.textContent = value;
                        }
                    }
                }
            });
        }
        
        // ì»¬ëŸ¼ëª… ê°€ì ¸ì˜¤ê¸°
        function getColumnName(cellIndex) {
            const columnNames = {
                2: 'íŒŒì¼ì´ë¦„',
                3: 'ì‘ì—…ì‹œê°„',
                4: 'ì œëª©',
                5: 'ì§€ì›ìê²©',
                6: 'ëª¨ì§‘ê¸°ê°„ ì‹œì‘',
                7: 'ëª¨ì§‘ê¸°ê°„ ì¢…ë£Œ',
                8: 'ëª¨ì§‘ì¸ì›',
                9: 'ì‘ì—…ê¸°ê°„ ì‹œì‘',
                10: 'ì‘ì—…ê¸°ê°„ ì¢…ë£Œ',
                11: 'ê¸ˆì•¡',
                12: 'ë‚´ìš©'
            };
            
            return columnNames[cellIndex] || 'ì•Œ ìˆ˜ ì—†ìŒ';
        }
        
        function showNavigationHelp() {
            const navigator = document.getElementById('cellNavigator');
            if (navigator) {
                navigator.classList.add('show');
                setTimeout(() => {
                    navigator.classList.remove('show');
                }, 5000);
            }
        }
        
        // ë²”ìœ„ ì„ íƒ
        function selectCellRange(startCell, endCell) {
            // ëª¨ë“  ì„ íƒ í•´ì œ
            document.querySelectorAll('.editable-cell').forEach(c => {
                c.classList.remove('selected');
            });
            
            const table = startCell.closest('table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            
            const startRow = rows.indexOf(startCell.closest('tr'));
            const endRow = rows.indexOf(endCell.closest('tr'));
            
            const startCells = Array.from(startCell.closest('tr').querySelectorAll('.editable-cell'));
            const endCells = Array.from(endCell.closest('tr').querySelectorAll('.editable-cell'));
            
            const startCol = startCells.indexOf(startCell);
            const endCol = endCells.indexOf(endCell);
            
            selectedRange = [];
            
            // ë²”ìœ„ ì„ íƒ
            for (let r = Math.min(startRow, endRow); r <= Math.max(startRow, endRow); r++) {
                const rowCells = Array.from(rows[r].querySelectorAll('.editable-cell'));
                for (let c = Math.min(startCol, endCol); c <= Math.max(startCol, endCol); c++) {
                    if (rowCells[c]) {
                        rowCells[c].classList.add('selected');
                        selectedRange.push(rowCells[c]);
                    }
                }
            }
            
            currentSelectedCell = endCell;
        }
        
        // ì…€ ì´ë™ (í™”ì‚´í‘œ í‚¤)
        function moveToNextCell(currentCell, direction) {
            const table = currentCell.closest('table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            const currentRow = currentCell.closest('tr');
            const currentRowIndex = rows.indexOf(currentRow);
            const cells = Array.from(currentRow.querySelectorAll('.editable-cell'));
            const currentCellIndex = cells.indexOf(currentCell);
            
            let nextCell = null;
            
            switch(direction) {
                case 'left':
                    if (currentCellIndex > 0) {
                        nextCell = cells[currentCellIndex - 1];
                    }
                    break;
                case 'right':
                    if (currentCellIndex < cells.length - 1) {
                        nextCell = cells[currentCellIndex + 1];
                    }
                    break;
                case 'up':
                    if (currentRowIndex > 0) {
                        const prevRowCells = Array.from(rows[currentRowIndex - 1].querySelectorAll('.editable-cell'));
                        nextCell = prevRowCells[currentCellIndex];
                    }
                    break;
                case 'down':
                    if (currentRowIndex < rows.length - 1) {
                        const nextRowCells = Array.from(rows[currentRowIndex + 1].querySelectorAll('.editable-cell'));
                        nextCell = nextRowCells[currentCellIndex];
                    }
                    break;
            }
            
            if (nextCell) {
                selectSingleCell(nextCell);
                nextCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleKeyboardNavigation(e) {
            if (!currentSelectedCell || isEditing) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'left');
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'right');
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'up');
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'down');
                    break;
                case 'Tab':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, e.shiftKey ? 'left' : 'right');
                    break;
                case 'Enter':
                case 'F2':
                    e.preventDefault();
                    startEditing(currentSelectedCell);
                    break;
                case 'Delete':
                case 'Backspace':
                    e.preventDefault();
                    if (selectedRange.length > 1) {
                        // ë²”ìœ„ ì‚­ì œ
                        selectedRange.forEach(cell => {
                            cell.textContent = '';
                            updateProjectData(cell, '');
                        });
                    } else {
                        currentSelectedCell.textContent = '';
                        updateProjectData(currentSelectedCell, '');
                    }
                    break;
                case 'c':
                case 'C':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        copySelectedCells();
                    }
                    break;
                case 'v':
                case 'V':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        pasteToSelectedCells();
                    }
                    break;
            }
        }
        
        // ë³µì‚¬ ê¸°ëŠ¥
        let clipboardData = [];
        
        function copySelectedCells() {
            clipboardData = selectedRange.map(cell => cell.textContent.trim());
            alert(`${clipboardData.length}ê°œ ì…€ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ë¶™ì—¬ë„£ê¸° ê¸°ëŠ¥
        function pasteToSelectedCells() {
            if (clipboardData.length === 0) {
                alert('ë³µì‚¬ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (selectedRange.length === 1 && clipboardData.length === 1) {
                // ë‹¨ì¼ ì…€ ë¶™ì—¬ë„£ê¸°
                currentSelectedCell.textContent = clipboardData[0];
                updateProjectData(currentSelectedCell, clipboardData[0]);
            } else if (selectedRange.length >= clipboardData.length) {
                // ë²”ìœ„ ë¶™ì—¬ë„£ê¸° - ë³µì‚¬ëœ ë°ì´í„°ë¥¼ ìˆœì„œëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°
                selectedRange.forEach((cell, index) => {
                    const dataIndex = index % clipboardData.length; // ë³µì‚¬ëœ ë°ì´í„° ë°˜ë³µ ì‚¬ìš©
                    if (clipboardData[dataIndex] !== undefined) {
                        cell.textContent = clipboardData[dataIndex];
                        updateProjectData(cell, clipboardData[dataIndex]);
                    }
                });
            } else {
                // ì„ íƒëœ ë²”ìœ„ê°€ ë³µì‚¬ëœ ë°ì´í„°ë³´ë‹¤ ì‘ì€ ê²½ìš°
                selectedRange.forEach((cell, index) => {
                    if (clipboardData[index] !== undefined) {
                        cell.textContent = clipboardData[index];
                        updateProjectData(cell, clipboardData[index]);
                    }
                });
            }
            
            alert(`${Math.min(selectedRange.length, clipboardData.length)}ê°œ ì…€ì— ë°ì´í„°ê°€ ë¶™ì—¬ë„£ì–´ì¡ŒìŠµë‹ˆë‹¤.`);
        }
        
        // ê¸°ì¡´ ë“±ë¡ ë²„íŠ¼
        function registerProjects() {
            registerToWorkspy();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updateProjectList();
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.addEventListener('keydown', handleKeyboardNavigation);
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ì…€ ì„ íƒ í•´ì œ
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.editable-cell') && !isEditing) {
                    if (currentSelectedCell) {
                        document.querySelectorAll('.editable-cell').forEach(c => {
                            c.classList.remove('selected');
                        });
                        currentSelectedCell = null;
                        selectedRange = [];
                        document.getElementById('cellNavigator').classList.remove('show');
                    }
                }
            });
        });
    </script>
</body>
</html>
