<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Project Addition - VOD Work Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            padding: 30px;
            min-height: 100vh;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .close-button {
            background: #6b7280;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .close-button:hover {
            background: #4b5563;
        }
        
        /* Basic Information Area */
        .basic-info-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        .basic-info-header {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .basic-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        .basic-info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        
        .add-button {
            align-self: flex-start;
            padding: 6px 12px;
            background: none;
            border: 1px solid #d1d5db;
            color: #6b7280;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .add-button:hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }
        
        .basic-info-grid .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .basic-info-grid .form-group input {
            padding: 15px 20px;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            transition: all 0.2s;
            width: 100%;
            box-sizing: border-box;
        }
        
        .basic-info-grid .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        
        .basic-info-grid .form-group label,
        .basic-info-row .form-group label {
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
        }
        
        .basic-info-row .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .basic-info-row .form-group > label {
            margin-bottom: 12px;
        }
        
        .section-group {
            margin-top: 0;
        }
        
        .speaker-group {
            margin-top: 0;
        }
        
        .basic-info-row .form-group input {
            padding: 15px 20px;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            transition: all 0.2s;
            width: 100%;
            box-sizing: border-box;
        }
        
        .basic-info-row .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        
        /* Required input indicator */
        .required {
            color: #ef4444;
            font-weight: 700;
            margin-left: 4px;
        }
        
        /* File upload area */
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        .upload-header {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f9fafb;
            transition: all 0.2s;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .file-upload-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .file-upload-area.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #6b7280;
        }
        
        .upload-text {
            font-size: 16px;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-select-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-select-btn:hover {
            background: #2563eb;
        }
        
        .register-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .register-btn:hover {
            background: #059669;
        }
        
        /* Bottom buttons */
        .bottom-btn {
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Excel download button */
        .excel-download-btn {
            background: #10b981;
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        .excel-download-btn:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .excel-download-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        /* Workspy project register button */
        .workspy-register-btn {
            background: #7c3aed;
            color: white;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        }
        
        .workspy-register-btn:hover {
            background: #6d28d9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
        }
        
        .workspy-register-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        }
        
        /* Project list area */
        .project-list-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        
        .list-header {
            background: #f8f9fa;
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }
        
        .list-info {
            color: #6b7280;
            font-size: 14px;
        }
        
        .project-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .project-table th,
        .project-table td {
            padding: 8px 6px;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-size: 13px;
            position: relative;
        }
        
        .project-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #d1d5db;
        }
        
        .project-table td {
            color: #6b7280;
            min-height: 35px;
        }
        
        /* Excel style cells */
        .editable-cell {
            cursor: cell;
            transition: all 0.1s;
            user-select: none;
            border: 1px solid #e5e7eb;
        }
        
        .editable-cell:hover {
            background: #f0f9ff;
            border-color: #93c5fd;
        }
        
        .editable-cell.selected {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            box-shadow: 0 0 0 1px #3b82f6;
        }
        
        .editable-cell.editing {
            background: white;
            border: 2px solid #10b981;
            box-shadow: 0 0 0 1px #10b981;
        }
        
        .editable-cell input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            padding: 4px 8px;
            font-size: 13px;
            color: #374151;
            text-align: center;
            outline: none;
        }
        
        .editable-cell textarea {
            width: 100%;
            min-height: 60px;
            border: none;
            background: transparent;
            padding: 4px 8px;
            font-size: 13px;
            color: #374151;
            text-align: left;
            outline: none;
            resize: vertical;
            font-family: inherit;
            line-height: 1.4;
        }
        
        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-ready {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* Keyboard navigation help */
        .cell-navigator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #374151;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .cell-navigator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 20px;
            }
            
            .cell-navigator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1 class="page-title">
            <span>📁</span>
            Bulk Project Addition
        </h1>
        <button class="close-button" onclick="closeWindow()">
            <span>✕</span>
            Close
        </button>
    </div>
    
    <!-- Basic Information Area -->
    <div class="basic-info-section">
        <div class="basic-info-header">
            <span>📋</span>
            Basic Information
        </div>
        
        <div class="basic-info-grid">
            <div class="form-group">
                <label for="projectTitle">Project Title <span class="required">*</span></label>
                <input type="text" id="projectTitle" placeholder="Enter project title" required>
            </div>
            <div class="form-group">
                <label for="companyName">Company Name <span class="required">*</span></label>
                <select id="companyName" required style="padding: 15px 20px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 16px; background: white; transition: all 0.2s; width: 100%; box-sizing: border-box; cursor: pointer;">
                    <option value="">Select company</option>
                    <option value="Seoul Metropolitan Government">Seoul Metropolitan Government</option>
                    <option value="Busan Metropolitan City">Busan Metropolitan City</option>
                    <option value="Incheon Metropolitan City">Incheon Metropolitan City</option>
                    <option value="Daegu Metropolitan City">Daegu Metropolitan City</option>
                    <option value="Gwangju Metropolitan City">Gwangju Metropolitan City</option>
                    <option value="Daejeon Metropolitan City">Daejeon Metropolitan City</option>
                    <option value="Ulsan Metropolitan City">Ulsan Metropolitan City</option>
                    <option value="Sejong Special City">Sejong Special City</option>
                    <option value="Gyeonggi Province">Gyeonggi Province</option>
                    <option value="Gangwon Province">Gangwon Province</option>
                    <option value="North Chungcheong Province">North Chungcheong Province</option>
                    <option value="South Chungcheong Province">South Chungcheong Province</option>
                    <option value="North Jeolla Province">North Jeolla Province</option>
                    <option value="South Jeolla Province">South Jeolla Province</option>
                    <option value="North Gyeongsang Province">North Gyeongsang Province</option>
                    <option value="South Gyeongsang Province">South Gyeongsang Province</option>
                    <option value="Jeju Special Self-Governing Province">Jeju Special Self-Governing Province</option>
                    <option value="Ministry of Education">Ministry of Education</option>
                    <option value="Ministry of Health and Welfare">Ministry of Health and Welfare</option>
                    <option value="Ministry of Environment">Ministry of Environment</option>
                    <option value="Ministry of Land, Infrastructure and Transport">Ministry of Land, Infrastructure and Transport</option>
                    <option value="Ministry of Culture, Sports and Tourism">Ministry of Culture, Sports and Tourism</option>
                    <option value="Ministry of Agriculture, Food and Rural Affairs">Ministry of Agriculture, Food and Rural Affairs</option>
                    <option value="Ministry of Trade, Industry and Energy">Ministry of Trade, Industry and Energy</option>
                    <option value="Ministry of Employment and Labor">Ministry of Employment and Labor</option>
                    <option value="Ministry of Gender Equality and Family">Ministry of Gender Equality and Family</option>
                    <option value="National Assembly Secretariat">National Assembly Secretariat</option>
                    <option value="Supreme Court">Supreme Court</option>
                    <option value="Constitutional Court">Constitutional Court</option>
                    <option value="National Election Commission">National Election Commission</option>
                </select>
            </div>
            <div class="form-group">
                <label for="clientName">Client Name <span class="required">*</span></label>
                <input type="text" id="clientName" placeholder="Enter client name" required>
            </div>
        </div>
        
        <!-- Second row: Recording date, Recording location -->
        <div class="basic-info-row">
            <div class="form-group">
                <label for="recordDate">Recording Date <span class="required">*</span></label>
                <input type="date" id="recordDate" required>
            </div>
            <div class="form-group">
                <label for="recordLocation">Recording Location</label>
                <input type="text" id="recordLocation" placeholder="Enter recording location">
            </div>
        </div>
        
    </div>
    
    <!-- File Upload Area -->
    <div class="upload-section">
        <div class="upload-header">
            <span>📤</span>
            File Upload
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
            <!-- Left: Drag upload area -->
            <div>
                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()" 
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">Drag files here or click to select</div>
                </div>
                
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
                
                
                <!-- Button area -->
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <button class="file-select-btn" onclick="simulateFileSelect()">
                        <span>📂</span>
                        Select Files
                    </button>
                    
                    <button class="register-btn" onclick="simulateRegisterProjects()">
                        <span>✅</span>
                        Register
                    </button>
                </div>
            </div>
            
            <!-- Right: Uploaded file list -->
            <div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb; height: 100%;">
                    <div style="font-weight: 600; color: #374151; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>📋</span>
                        Uploaded Files (<span id="uploadedFileCount">0</span>)
                    </div>
                    
                    <div id="uploadedFileList" style="max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; color: #6b7280; padding: 40px 20px; font-style: italic;">
                            No uploaded files.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Project List Area -->
    <div class="project-list-section">
        <div class="list-header">
            <h2 class="list-title">Project List</h2>
            <div class="list-info">Total <span id="projectCount">0</span> items</div>
        </div>
        
        <div style="overflow-x: auto;">
            <table class="project-table">
                <thead>
                    <tr>
                        <th width="50">NO</th>
                        <th width="120">Service</th>
                        <th width="200">File Name</th>
                        <th width="100">Work Time</th>
                        <th width="250">Title</th>
                        <th width="80">Qualification</th>
                        <th width="160">Recruitment Start</th>
                        <th width="160">Recruitment End</th>
                        <th width="80">Workers</th>
                        <th width="120">Work Start</th>
                        <th width="120">Work End</th>
                        <th width="100">Amount</th>
                        <th width="250">Description</th>
                    </tr>
                </thead>
                <tbody id="projectTableBody">
                    <tr>
                        <td colspan="13" style="padding: 40px; color: #6b7280; font-style: italic;">
                            No uploaded projects.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Bottom button area -->
        <div style="padding: 20px 25px; border-top: 1px solid #e5e7eb; background: #f8f9fa; display: flex; justify-content: flex-end; gap: 15px;">
            <button class="bottom-btn excel-download-btn" onclick="downloadProjectsAsExcel()">
                <span>📊</span>
                Download Excel
            </button>
            <button class="bottom-btn workspy-register-btn" onclick="registerToWorkspy()">
                <span>🚀</span>
                Register Workspy Project
            </button>
        </div>
    </div>
    
    <!-- Keyboard navigation help -->
    <div id="cellNavigator" class="cell-navigator">
        <div><strong>Excel-style editing:</strong></div>
        <div>Arrow keys: Move cells | Enter/F2: Edit | Tab: Next cell | Del: Delete</div>
        <div>Shift+Click: Range select | Ctrl+C: Copy | Ctrl+V: Paste | Alt+Enter: New line (Description)</div>
    </div>

    <script>
        let uploadedProjects = [];
        let currentSelectedCell = null;
        let isEditing = false;
        let selectedRange = [];
        
        // Close window
        function closeWindow() {
            if (confirm('Do you want to close this window?')) {
                window.close();
            }
        }
        
        // File select simulation (for demo)
        function simulateFileSelect() {
            // Simulate 20 files selected
            const mockFileNames = [
                'meeting_001_policy_committee.m4a',
                'meeting_002_budget_review.m4a', 
                'meeting_003_urban_planning.m4a',
                'meeting_004_education_reform.m4a',
                'meeting_005_health_policy.m4a',
                'meeting_006_environment_protection.m4a',
                'meeting_007_transportation.m4a',
                'meeting_008_welfare_committee.m4a',
                'meeting_009_economic_development.m4a',
                'meeting_010_cultural_affairs.m4a',
                'meeting_011_public_safety.m4a',
                'meeting_012_housing_policy.m4a',
                'meeting_013_technology_innovation.m4a',
                'meeting_014_agriculture_committee.m4a',
                'meeting_015_tourism_development.m4a',
                'meeting_016_energy_policy.m4a',
                'meeting_017_social_welfare.m4a',
                'meeting_018_labor_relations.m4a',
                'meeting_019_foreign_affairs.m4a',
                'meeting_020_legal_affairs.m4a'
            ];
            
            // Change drag area style
            const uploadArea = document.querySelector('.file-upload-area');
            uploadArea.style.background = '#dcfce7';
            uploadArea.style.borderColor = '#10b981';
            uploadArea.querySelector('.upload-text').textContent = `${mockFileNames.length} files selected`;
            
            // Store file names in global variable
            window.selectedFileNames = mockFileNames;
            
            // Update file list
            updateUploadedFileList(mockFileNames);
            
            alert(`${mockFileNames.length} files have been selected.`);
        }
        
        // Remove individual file
        function removeIndividualFile(index) {
            if (!window.selectedFileNames || window.selectedFileNames.length === 0) return;
            
            // Remove file at index
            window.selectedFileNames.splice(index, 1);
            
            // Update file list
            updateUploadedFileList(window.selectedFileNames);
            
            // If all files removed, reset drag area
            if (window.selectedFileNames.length === 0) {
                const uploadArea = document.querySelector('.file-upload-area');
                uploadArea.style.background = '#f9fafb';
                uploadArea.style.borderColor = '#d1d5db';
                uploadArea.querySelector('.upload-text').textContent = 'Drag files here or click to select';
                
                // Also reset project list
                uploadedProjects = [];
                updateProjectList();
            }
        }
        
        // Update uploaded file list
        function updateUploadedFileList(fileNames) {
            const fileListContainer = document.getElementById('uploadedFileList');
            const fileCountElement = document.getElementById('uploadedFileCount');
            
            if (!fileNames || fileNames.length === 0) {
                fileListContainer.innerHTML = `
                    <div style="text-align: center; color: #6b7280; padding: 40px 20px; font-style: italic;">
                        No uploaded files.
                    </div>
                `;
                fileCountElement.textContent = '0';
                return;
            }
            
            // Generate random work times per file (store as fixed values)
            if (!window.fileWorkTimes) {
                window.fileWorkTimes = {};
            }
            
            const fileListHTML = fileNames.map((fileName, index) => {
                // Use existing work time if available, otherwise generate new
                if (!window.fileWorkTimes[fileName]) {
                    const workMinutes = Math.floor(Math.random() * 170) + 10;
                    const workHours = Math.floor(workMinutes / 60);
                    const remainingMinutes = workMinutes % 60;
                    window.fileWorkTimes[fileName] = `${String(workHours).padStart(2, '0')}:${String(remainingMinutes).padStart(2, '0')}:00`;
                }
                
                const workTime = window.fileWorkTimes[fileName];
                
                return `
                    <div style="display: flex; align-items: center; padding: 8px 12px; background: white; border-radius: 6px; margin-bottom: 6px; border: 1px solid #e5e7eb;">
                        <div style="width: 30px; text-align: center; font-weight: 600; color: #374151; font-size: 12px;">
                            ${index + 1}
                        </div>
                        <div style="flex: 1; margin: 0 10px; text-align: center;">
                            <div style="font-weight: 500; color: #374151; font-size: 13px; margin-bottom: 2px;">
                                ${fileName}
                            </div>
                        </div>
                        <div style="width: 70px; text-align: center; font-weight: 600; color: #059669; font-size: 12px;">
                            ${workTime.substring(0, 5)}
                        </div>
                        <div style="width: 20px; text-align: center; margin-left: 8px;">
                            <button onclick="removeIndividualFile(${index})" style="background: #ef4444; color: white; border: none; border-radius: 50%; width: 18px; height: 18px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" 
                                    onmouseover="this.style.background='#dc2626'" 
                                    onmouseout="this.style.background='#ef4444'">
                                ✕
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            fileListContainer.innerHTML = `
                <!-- Header -->
                <div style="display: flex; align-items: center; padding: 8px 12px; background: #e5e7eb; border-radius: 6px; margin-bottom: 10px; font-weight: 600; color: #374151; font-size: 12px;">
                    <div style="width: 30px; text-align: center;">NO</div>
                    <div style="flex: 1; margin: 0 10px; text-align: center;">File Name</div>
                    <div style="width: 70px; text-align: center;">Work Time</div>
                    <div style="width: 20px; text-align: center;"></div>
                </div>
                ${fileListHTML}
            `;
            
            fileCountElement.textContent = fileNames.length;
        }
        
        // Register simulation (for demo)
        function simulateRegisterProjects() {
            // Verify file selection only
            if (!window.selectedFileNames || window.selectedFileNames.length === 0) {
                alert('Please select files first.');
                return;
            }
            
            // Generate 20 project data
            const projects = window.selectedFileNames.map((fileName, index) => {
                // Generate random work time (10~180 minutes)
                const workMinutes = Math.floor(Math.random() * 170) + 10;
                const workHours = Math.floor(workMinutes / 60);
                const remainingMinutes = workMinutes % 60;
                const workTime = `${String(workHours).padStart(2, '0')}:${String(remainingMinutes).padStart(2, '0')}:00`;
                
                return {
                    service: 'Soribaro-VOD',
                    fileName: fileName,
                    workTime: workTime,
                    title: `VOD_(Subtitle) / Remote / ${workTime.substring(0, 5)}`,
                    qualification: '',
                    recruitStart: '',
                    recruitEnd: '',
                    recruitCount: '',
                    workStart: '',
                    workEnd: '',
                    amount: '',
                    content: ''
                };
            });
            
            uploadedProjects = projects;
            updateProjectList();
            
            alert(`${projects.length} projects have been created. You can now edit cells like Excel.`);
        }
        
        // Excel style cell click handling
        function handleCellClick(cell, event) {
            event.preventDefault();
            event.stopPropagation();
            
            if (isEditing) return;
            
            if (event.shiftKey && currentSelectedCell) {
                // Shift + Click: Range select
                selectCellRange(currentSelectedCell, cell);
            } else {
                // Single cell select
                selectSingleCell(cell);
            }
        }
        
        // Single cell selection
        function selectSingleCell(cell) {
            // Deselect all
            document.querySelectorAll('.editable-cell').forEach(c => {
                c.classList.remove('selected');
            });
            selectedRange = [];
            
            // Select current cell
            currentSelectedCell = cell;
            cell.classList.add('selected');
            selectedRange = [cell];
            
            // Show navigation help
            showNavigationHelp();
        }
        
        // Range selection
        function selectCellRange(startCell, endCell) {
            // Deselect all
            document.querySelectorAll('.editable-cell').forEach(c => {
                c.classList.remove('selected');
            });
            
            const table = startCell.closest('table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            
            const startRow = rows.indexOf(startCell.closest('tr'));
            const endRow = rows.indexOf(endCell.closest('tr'));
            
            const startCells = Array.from(startCell.closest('tr').querySelectorAll('.editable-cell'));
            const endCells = Array.from(endCell.closest('tr').querySelectorAll('.editable-cell'));
            
            const startCol = startCells.indexOf(startCell);
            const endCol = endCells.indexOf(endCell);
            
            selectedRange = [];
            
            // Range selection
            for (let r = Math.min(startRow, endRow); r <= Math.max(startRow, endRow); r++) {
                const rowCells = Array.from(rows[r].querySelectorAll('.editable-cell'));
                for (let c = Math.min(startCol, endCol); c <= Math.max(startCol, endCol); c++) {
                    if (rowCells[c]) {
                        rowCells[c].classList.add('selected');
                        selectedRange.push(rowCells[c]);
                    }
                }
            }
            
            currentSelectedCell = endCell;
        }
        
        // Enter edit mode with double click
        function startEditing(cell) {
            if (isEditing) return;
            
            isEditing = true;
            cell.classList.add('editing');
            cell.classList.remove('selected');
            
            const originalValue = cell.textContent.trim();
            const cellIndex = Array.from(cell.closest('tr').children).indexOf(cell);
            const isContentColumn = cellIndex === 12; // Check if Description column
            
            // Use textarea for Description column, input for others
            const inputElement = isContentColumn ? document.createElement('textarea') : document.createElement('input');
            
            if (!isContentColumn) {
                inputElement.type = 'text';
            }
            inputElement.value = originalValue;
            
            // Finish editing handler
            function finishEditing(save = true) {
                const newValue = save ? inputElement.value.trim() : originalValue;
                
                if (isContentColumn) {
                    // Description column maintains line breaks
                    cell.innerHTML = newValue.replace(/\n/g, '<br>') || originalValue;
                } else {
                    cell.textContent = newValue || originalValue;
                }
                
                cell.classList.remove('editing');
                cell.classList.add('selected');
                isEditing = false;
                
                if (save && newValue !== originalValue) {
                    updateProjectData(cell, newValue || originalValue);
                }
            }
            
            // Event listeners
            inputElement.onblur = () => finishEditing(true);
            inputElement.onkeydown = function(e) {
                e.stopPropagation();
                
                if (e.key === 'Enter') {
                    if (e.altKey && isContentColumn) {
                        // Alt + Enter: New line (Description column only)
                        const cursorPos = inputElement.selectionStart;
                        const textBefore = inputElement.value.substring(0, cursorPos);
                        const textAfter = inputElement.value.substring(cursorPos);
                        inputElement.value = textBefore + '\n' + textAfter;
                        inputElement.selectionStart = inputElement.selectionEnd = cursorPos + 1;
                    } else {
                        // Normal Enter: Finish editing
                        finishEditing(true);
                        moveToNextCell(cell, 'down');
                    }
                } else if (e.key === 'Escape') {
                    finishEditing(false);
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    finishEditing(true);
                    moveToNextCell(cell, e.shiftKey ? 'left' : 'right');
                }
            };
            
            cell.innerHTML = '';
            cell.appendChild(inputElement);
            inputElement.focus();
            inputElement.select();
        }
        
        // Move cell (arrow keys)
        function moveToNextCell(currentCell, direction) {
            const table = currentCell.closest('table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            const currentRow = currentCell.closest('tr');
            const currentRowIndex = rows.indexOf(currentRow);
            const cells = Array.from(currentRow.querySelectorAll('.editable-cell'));
            const currentCellIndex = cells.indexOf(currentCell);
            
            let nextCell = null;
            
            switch(direction) {
                case 'left':
                    if (currentCellIndex > 0) {
                        nextCell = cells[currentCellIndex - 1];
                    }
                    break;
                case 'right':
                    if (currentCellIndex < cells.length - 1) {
                        nextCell = cells[currentCellIndex + 1];
                    }
                    break;
                case 'up':
                    if (currentRowIndex > 0) {
                        const prevRowCells = Array.from(rows[currentRowIndex - 1].querySelectorAll('.editable-cell'));
                        nextCell = prevRowCells[currentCellIndex];
                    }
                    break;
                case 'down':
                    if (currentRowIndex < rows.length - 1) {
                        const nextRowCells = Array.from(rows[currentRowIndex + 1].querySelectorAll('.editable-cell'));
                        nextCell = nextRowCells[currentCellIndex];
                    }
                    break;
            }
            
            if (nextCell) {
                selectSingleCell(nextCell);
                nextCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // Show navigation help
        function showNavigationHelp() {
            const navigator = document.getElementById('cellNavigator');
            if (navigator) {
                navigator.classList.add('show');
                
                // Auto hide after 5 seconds
                setTimeout(() => {
                    navigator.classList.remove('show');
                }, 5000);
            }
        }
        
        // Keyboard event handling
        function handleKeyboardNavigation(e) {
            if (!currentSelectedCell || isEditing) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'left');
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'right');
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'up');
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, 'down');
                    break;
                case 'Tab':
                    e.preventDefault();
                    moveToNextCell(currentSelectedCell, e.shiftKey ? 'left' : 'right');
                    break;
                case 'Enter':
                case 'F2':
                    e.preventDefault();
                    startEditing(currentSelectedCell);
                    break;
                case 'Delete':
                case 'Backspace':
                    e.preventDefault();
                    if (selectedRange.length > 1) {
                        // Range delete
                        selectedRange.forEach(cell => {
                            cell.textContent = '';
                            updateProjectData(cell, '');
                        });
                    } else {
                        currentSelectedCell.textContent = '';
                        updateProjectData(currentSelectedCell, '');
                    }
                    break;
                case 'c':
                case 'C':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        copySelectedCells();
                    }
                    break;
                case 'v':
                case 'V':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        pasteToSelectedCells();
                    }
                    break;
            }
        }
        
        // Copy function
        let clipboardData = [];
        
        function copySelectedCells() {
            clipboardData = selectedRange.map(cell => cell.textContent.trim());
            alert(`${clipboardData.length} cells copied.`);
        }
        
        // Paste function
        function pasteToSelectedCells() {
            if (clipboardData.length === 0) {
                alert('No copied data.');
                return;
            }
            
            if (selectedRange.length === 1 && clipboardData.length === 1) {
                // Single cell paste
                currentSelectedCell.textContent = clipboardData[0];
                updateProjectData(currentSelectedCell, clipboardData[0]);
            } else if (selectedRange.length >= clipboardData.length) {
                // Range paste - paste copied data in order
                selectedRange.forEach((cell, index) => {
                    const dataIndex = index % clipboardData.length; // Repeat copied data
                    if (clipboardData[dataIndex] !== undefined) {
                        cell.textContent = clipboardData[dataIndex];
                        updateProjectData(cell, clipboardData[dataIndex]);
                    }
                });
            } else {
                // If selected range is smaller than copied data
                selectedRange.forEach((cell, index) => {
                    if (clipboardData[index] !== undefined) {
                        cell.textContent = clipboardData[index];
                        updateProjectData(cell, clipboardData[index]);
                    }
                });
            }
            
            alert(`Data pasted into ${Math.min(selectedRange.length, clipboardData.length)} cells.`);
        }
        
        // Update project data
        function updateProjectData(cell, newValue) {
            const row = cell.closest('tr');
            const rowIndex = Array.from(row.parentElement.children).indexOf(row);
            const cellIndex = Array.from(row.children).indexOf(cell);
            
            if (uploadedProjects[rowIndex]) {
                const fieldMap = {
                    2: 'fileName',
                    3: 'workTime',
                    4: 'title',
                    5: 'qualification',
                    6: 'recruitStart',
                    7: 'recruitEnd',
                    8: 'recruitCount',
                    9: 'workStart',
                    10: 'workEnd',
                    11: 'amount',
                    12: 'content'
                };
                
                const fieldName = fieldMap[cellIndex];
                if (fieldName) {
                    uploadedProjects[rowIndex][fieldName] = newValue;
                    
                    // Auto-update title when work time changes
                    if (fieldName === 'workTime') {
                        // Convert to HH:MM format (HH:MM:SS → HH:MM)
                        const timeForTitle = newValue.includes(':') ? newValue.substring(0, 5) : newValue;
                        const newTitle = `VOD_(Subtitle) / Remote / ${timeForTitle}`;
                        uploadedProjects[rowIndex]['title'] = newTitle;
                        
                        // Update title cell on screen
                        const titleCell = row.children[4];
                        if (titleCell) {
                            titleCell.textContent = newTitle;
                        }
                    }
                    
                    // If specific columns in first row are modified, apply same value to all rows in that column
                    const autoFillColumns = ['qualification', 'recruitStart', 'recruitEnd', 'recruitCount', 'workStart', 'workEnd', 'amount', 'content'];
                    
                    if (rowIndex === 0 && autoFillColumns.includes(fieldName) && newValue.trim() !== '') {
                        // If column modified in first row
                        fillColumnWithValue(cellIndex, fieldName, newValue);
                        
                        alert(`All rows in "${getColumnName(cellIndex)}" column have been filled with "${newValue}".`);
                    }
                    
                    console.log(`Updated: ${fieldName} = ${newValue}`);
                }
            }
        }
        
        // Fill entire column with same value
        function fillColumnWithValue(cellIndex, fieldName, value) {
            // Update data
            uploadedProjects.forEach((project, index) => {
                if (index > 0) { // First row already modified
                    project[fieldName] = value;
                }
            });
            
            // Update screen
            const table = document.querySelector('.project-table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            
            rows.forEach((row, index) => {
                if (index > 0) { // First row already modified
                    const cell = row.children[cellIndex];
                    if (cell && cell.classList.contains('editable-cell')) {
                        if (fieldName === 'content') {
                            // Description column handles line breaks
                            cell.innerHTML = value.replace(/\n/g, '<br>');
                        } else {
                            cell.textContent = value;
                        }
                    }
                }
            });
        }
        
        // Get column name
        function getColumnName(cellIndex) {
            const columnNames = {
                2: 'File Name',
                3: 'Work Time',
                4: 'Title',
                5: 'Qualification',
                6: 'Recruitment Start',
                7: 'Recruitment End',
                8: 'Workers',
                9: 'Work Start',
                10: 'Work End',
                11: 'Amount',
                12: 'Description'
            };
            
            return columnNames[cellIndex] || 'Unknown';
        }
        
        // Drag and drop handling
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }
        
        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }
        
        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            simulateFileSelect(); // Replace with simulation
        }
        
        // Actual file select handling
        function handleFileSelect(event) {
            simulateFileSelect(); // Replace with simulation
        }
        
        // Remove all files
        function removeFile() {
            document.getElementById('fileInput').value = '';
            uploadedProjects = [];
            window.selectedFileNames = [];
            window.fileWorkTimes = {};
            
            // Restore drag area
            const uploadArea = document.querySelector('.file-upload-area');
            uploadArea.style.background = '#f9fafb';
            uploadArea.style.borderColor = '#d1d5db';
            uploadArea.querySelector('.upload-text').textContent = 'Drag files here or click to select';
            
            // Reset file list
            updateUploadedFileList([]);
            
            updateProjectList();
        }
        
        // Update project list
        function updateProjectList() {
            const tbody = document.getElementById('projectTableBody');
            
            if (uploadedProjects.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12" style="padding: 40px; color: #6b7280; font-style: italic;">
                            No uploaded projects.
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = uploadedProjects.map((project, index) => {
                    const serviceClass = project.service.includes('VOD') ? 'status-ready' : 'status-pending';
                    return `
                        <tr>
                            <td>${index + 1}</td>
                            <td><span class="status-badge ${serviceClass}">${project.service}</span></td>
                            <td class="editable-cell">${project.fileName}</td>
                            <td class="editable-cell">${project.workTime}</td>
                            <td class="editable-cell">${project.title}</td>
                            <td class="editable-cell">${project.qualification}</td>
                            <td class="editable-cell">${project.recruitStart}</td>
                            <td class="editable-cell">${project.recruitEnd}</td>
                            <td class="editable-cell">${project.recruitCount}</td>
                            <td class="editable-cell">${project.workStart}</td>
                            <td class="editable-cell">${project.workEnd}</td>
                            <td class="editable-cell">${project.amount}</td>
                            <td class="editable-cell">${project.content}</td>
                        </tr>
                    `;
                }).join('');
                
                // Re-register event listeners
                setTimeout(() => {
                    document.querySelectorAll('.editable-cell').forEach(cell => {
                        cell.addEventListener('click', function(e) {
                            handleCellClick(this, e);
                        });
                        cell.addEventListener('dblclick', function(e) {
                            e.preventDefault();
                            startEditing(this);
                        });
                    });
                }, 100);
            }
            
            // Update project count
            document.getElementById('projectCount').textContent = uploadedProjects.length;
        }
        
        // Select/deselect all (not used due to checkbox removal)
        function toggleAllProjects() {
            // Not used due to checkbox column removal
        }
        
        // Register Workspy project (new main register button)
        function registerToWorkspy() {
            if (uploadedProjects.length === 0) {
                alert('No projects to register.');
                return;
            }
            
            // Validate basic information
            const projectTitle = document.getElementById('projectTitle').value.trim();
            const companyName = document.getElementById('companyName').value;
            const clientName = document.getElementById('clientName').value.trim();
            
            if (!projectTitle) {
                alert('Please enter project title.');
                document.getElementById('projectTitle').focus();
                return;
            }
            
            if (!companyName) {
                alert('Please select company name.');
                document.getElementById('companyName').focus();
                return;
            }
            
            if (!clientName) {
                alert('Please enter client name.');
                document.getElementById('clientName').focus();
                return;
            }
            
            // Confirm Workspy registration
            if (confirm(`Do you want to register ${uploadedProjects.length} projects to Workspy?\n\nAfter registration, worker recruitment will begin on the Workspy platform.`)) {
                // Add projects to parent page (meeting-management.html)
                addProjectsToParentPage(projectTitle, companyName, clientName);
                
                // Registration handling (simulation)
                setTimeout(() => {
                    alert(`🎉 Success!\n\n${uploadedProjects.length} projects have been successfully registered to Workspy.\n\n• Project registration complete\n• Worker recruitment started\n• Progress can be checked in admin page\n• Items have been added to Meeting Minutes Management page.`);
                    
                    // Reset data after registration
                    uploadedProjects = [];
                    updateProjectList();
                    
                    // Reset selection state
                    currentSelectedCell = null;
                    selectedRange = [];
                    
                    // Reset basic information
                    document.getElementById('projectTitle').value = '';
                    document.getElementById('companyName').value = '';
                    document.getElementById('clientName').value = '';
                    
                    // Reset file information
                    removeFile();
                    
                    // Close window option (after parent window refresh)
                    setTimeout(() => {
                        if (confirm('Registration complete. Do you want to close this window?')) {
                            // Final focus on parent window
                            if (window.opener && !window.opener.closed) {
                                window.opener.focus();
                            }
                            window.close();
                        }
                    }, 500);
                }, 1000);
            }
        }
        
        // Add projects to parent page (meeting-management.html)
        function addProjectsToParentPage(projectTitle, companyName, clientName) {
            try {
                // Use localStorage for data transfer (safer method)
                const projectsToAdd = uploadedProjects.map((project, index) => {
                    // Title format: "ProjectTitle_NO" (from largest number)
                    const projectNumber = String(uploadedProjects.length - index).padStart(2, '0');
                    const generatedTitle = `${projectTitle}_${projectNumber}`;
                    
                    // Generate new order number
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds() + index).padStart(2, '0'); // Different seconds for each
                    const orderNumber = `${year}${month}${day}${hours}${minutes}${seconds}`;
                    
                    // Today's date and time
                    const today = `${year}-${month}-${day} ${hours}:${minutes}`;
                    
                    return {
                        orderNumber: orderNumber,
                        title: generatedTitle,
                        companyName: companyName,
                        clientName: clientName,
                        requestDate: today,
                        workTime: project.workTime,
                        status: 'Received'
                    };
                });
                
                // Save data to localStorage
                localStorage.setItem('bulkProjectsData', JSON.stringify(projectsToAdd));
                localStorage.setItem('bulkProjectsAdded', 'true');
                
                console.log(`Saved ${projectsToAdd.length} project data to localStorage.`);
                
                // Try direct call if parent window exists
                if (window.opener && !window.opener.closed) {
                    try {
                        if (typeof window.opener.addBulkProjectsToTable === 'function') {
                            window.opener.addBulkProjectsToTable(projectsToAdd);
                            window.opener.focus();
                        }
                        
                        // Send refresh signal to parent window
                        if (typeof window.opener.checkForBulkProjects === 'function') {
                            window.opener.checkForBulkProjects();
                        }
                    } catch (e) {
                        console.log('Direct call failed, using localStorage method:', e);
                    }
                }
                
            } catch (error) {
                console.error('Failed to pass data to parent page:', error);
            }
        }
        
        // Excel download function
        function downloadProjectsAsExcel() {
            if (uploadedProjects.length === 0) {
                alert('No projects to download.');
                return;
            }
            
            // Excel download simulation
            const projectData = uploadedProjects.map((project, index) => ({
                NO: index + 1,
                Service: project.service,
                FileName: project.fileName,
                WorkTime: project.workTime,
                Title: project.title,
                Qualification: project.qualification,
                RecruitStart: project.recruitStart,
                RecruitEnd: project.recruitEnd,
                Workers: project.recruitCount,
                WorkStart: project.workStart,
                WorkEnd: project.workEnd,
                Amount: project.amount,
                Description: project.content
            }));
            
            console.log('Excel download data:', projectData);
            
            // In actual implementation, create and download Excel file
            alert(`📊 Excel Download\n\nDownloading ${uploadedProjects.length} project data as Excel file.\n\nFilename: Workspy_Project_List_${new Date().toISOString().split('T')[0]}.xlsx`);
        }
        
        // Original register button (top)
        function registerProjects() {
            // Top register button redirects to bottom main button
            registerToWorkspy();
        }
        
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateProjectList();
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('recordDate').value = today;
            
            // Add keyboard event listener
            document.addEventListener('keydown', handleKeyboardNavigation);
            
            // Deselect cell on external click
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.editable-cell') && !isEditing) {
                    if (currentSelectedCell) {
                        document.querySelectorAll('.editable-cell').forEach(c => {
                            c.classList.remove('selected');
                        });
                        currentSelectedCell = null;
                        selectedRange = [];
                        document.getElementById('cellNavigator').classList.remove('show');
                    }
                }
            });
        });
    </script>
</body>
</html>